<div id="install-app" class="mdc-snackbar">
    <div class="mdc-snackbar__surface" role="status" aria-relevant="additions">
        <div class="mdc-snackbar__label" aria-atomic="false">
            Build your RegEx anywhere, even offline.
        </div>
        <div class="mdc-snackbar__actions" aria-atomic="true">
            <button id="btn-install-app" type="button" class="mdc-button mdc-snackbar__action">
                <div class="mdc-button__ripple"></div>
                <span class="mdc-button__label">Install</span>
            </button>
            <button id="btn-close-install" class="mdc-icon-button mdc-snackbar__dismiss material-icons"
                title="Dismiss">close</button>
        </div>
    </div>
</div>

<!-- <div id="install-app">
    <button id="btn-install-app"></button>
</div> -->

<script>
    // Initialize deferredPrompt for use later to show browser install prompt.
    let deferredPrompt;

    function showInstallPromotion() {
        document.querySelector("#install-app").classList.toggle('mdc-snackbar--opening', true);
        setTimeout(function () {
            document.querySelector("#install-app").classList.toggle('mdc-snackbar--open', true);
            document.querySelector("#install-app").classList.toggle('mdc-snackbar--opening', false);
        }, 100);

    }
    function hideInstallPromotion() {
        document.querySelector("#install-app").classList.toggle('mdc-snackbar--closing', true);
        document.querySelector("#install-app").classList.toggle('mdc-snackbar--open', false);
        setTimeout(function () {
            document.querySelector("#install-app").classList.toggle('mdc-snackbar--closing', false);
        }, 500);
    }

    window.addEventListener('beforeinstallprompt', (e) => {
        // Prevent the mini-infobar from appearing on mobile
        e.preventDefault();
        // Stash the event so it can be triggered later.
        deferredPrompt = e;
        // Update UI notify the user they can install the PWA
        showInstallPromotion();
        // Optionally, send analytics event that PWA install promo was shown.
        console.log(`'beforeinstallprompt' event was fired.`);
    });


    document.querySelector("#btn-install-app").addEventListener('click', async () => {
        // Hide the app provided install promotion
        hideInstallPromotion();
        // Show the install prompt
        deferredPrompt.prompt();
        // Wait for the user to respond to the prompt
        const { outcome } = await deferredPrompt.userChoice;
        // Optionally, send analytics event with outcome of user choice
        console.log(`User response to the install prompt: ${outcome}`);
        // We've used the prompt, and can't use it again, throw it away
        deferredPrompt = null;
    });

    document.querySelector("#btn-close-install").addEventListener('click', _ => {
        hideInstallPromotion();
    })

    window.addEventListener('appinstalled', () => {
        // Hide the app-provided install promotion
        hideInstallPromotion();
        // Clear the deferredPrompt so it can be garbage collected
        deferredPrompt = null;
        // Optionally, send analytics event to indicate successful install
        console.log('PWA was installed');
    });
</script>