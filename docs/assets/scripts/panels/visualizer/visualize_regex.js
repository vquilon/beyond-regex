function RegexVisualizer(t,e,i,r){var h,o=Kit();function u(t,e){if(e=e||"normal",x[t]&&x[t][e])return x[t][e];h.attr({"font-size":t,"font-weight":e});var i=h.getBBox();return x[t]=x[t]||{},x[t][e]={width:i.width/((h.attr("text").length-1)/2),height:i.height/2}}function p(i,t,n){var e,r=[],h=[],a=0,s=t,o=n,u=n;if(!i.length)return w.empty(i,t,n);i.forEach(function(t){t=t.repeat?w.repeat(t,s,n):w[t.type](t,s,n);r.push(t),s+=t.width+16,a+=t.width,o=Math.min(o,t.y),u=Math.max(u,t.y+t.height),h=h.concat(t.items)}),e=u-o,r.reduce(function(t,e){a+=16;t=g(i,t.lineOutX,n,e.lineInX,_fromItem=t,_toItem=e);return h.push(t),e});var c=r[0].lineInX,l=r[r.length-1].lineOutX;return{items:h,width:a,height:e,x:t,y:o,lineInX:c,lineOutX:l}}function v(t,e,i){t.forEach(function(t){t._translate?t._translate(e,i):(t.x+=e,t.y+=i)})}function c(t,e,i,n,r,h){return{type:"group",id:t.id||"",indices:[t.indices[0]+1,t.indices[1]-1],class:`g:${t.type}:${[t.indices[0]+1,t.indices[1]-1].join(";")}`,children:e,transform:`t${i},${n}`,x:i,y:n,width:r,height:h,_translate:function(t,e){this.x+=t,this.y+=e,this.transform=`t${this.x},${this.y}`}}}function k(t,e,i,n,r,h){e=o.toPrint(e);var a=u(d),s=e.length*a.width,a=a.height+12,s=12+s,r={type:"rect",class:`rect:${t.type}:${t.indices.join(";")}`,x:0,y:0,width:s,height:a,stroke:"none",fill:r||"transparent"},h={type:"text",class:`text:${t.type}:${t.indices.join(";")}`,x:s/2,y:a/2,text:e,"font-size":d,"font-family":l,fill:h||"black"},n=c(t,[r,h],i,n-a/2,s,a);return{text:h,rect:r,items:[n],width:s,height:a,x:i,y:n.y,lineInX:i,lineOutX:i+s}}function X(t,e,i,n,r){var h=u(14),a=n.split("\n"),s=a.length*h.height,a=1<a.length?Math.max.apply(Math,a.map(function(t){return t.length})):n.length;return a*=h.width,{label:{type:"text",class:`text:${t.type}:${t.indices.join(";")}`,x:e,y:i-s/2-4,text:n,"font-size":14,"font-family":l,fill:r||"#444"},x:e-a/2,y:i-s-4,width:a,height:4+s}}function g(t,e,i,n,r=null,h=null){let a="linejoint";return null!==r&&(a=`${a}::${r.items.map(t=>t.class).join("_")}`),null!==h&&(a=`${a}::${h.items.map(t=>t.class).join("_")}::`),t.hasOwnProperty("indices")&&(a=`curve:${t.indices.join(";")}`),{type:"path",class:`path:${a}`,x:e,y:i,path:["M",e,i,"H",n],"stroke-linecap":"butt","stroke-linejoin":"round",stroke:"#333","stroke-width":2,_translate:function(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t}}}function y(t,e,i,n,r){var h,a=n<e?-1:1,s=r<i?-1:1,n=Math.abs(i-r)<15?(h=["M",e,i,"C",e+Math.min(Math.abs(n-e)/2,10)*a,i,n-(n-e)/2,r,n,r],function(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t,i[5]+=e,i[6]+=t,i[7]+=e,i[8]+=t,i[9]+=e}):(h=["M",e,i,"Q",e+10*a,i,e+10*a,i+10*s,"V",Math.abs(i-r)<20?i+10*s:r-10*s,"Q",e+10*a,r,e+10*a*2,r,"H",n],function(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t,i[5]+=e,i[6]+=t,i[7]+=e,i[9]+=e,i[11]+=t,i[12]+=e,i[13]+=t,i[14]+=e,i[16]+=t});return{type:"path",class:`path:curve:${t.indices.join(";")}`,path:h,"stroke-linecap":"butt","stroke-linejoin":"round",stroke:"#333","stroke-width":2,_translate:n}}function n(t,e,i,n){n={type:"circle",id:t.id,class:`circle:${t.type}:${t.indices.join(";")}`,fill:n,cx:10,cy:0,r:10,stroke:"none",_translate:function(t,e){this.cx+=t,this.cy+=e}};return container_group=c(t,[n],e,i,20,20),{items:[container_group],width:container_group.width,height:container_group.height,x:e,y:i,lineInX:container_group.x,lineOutX:container_group.x+container_group.width}}function m(t){if(Array.isArray(t)){for(var e=t,i=0;i<e.length;i++)if(!m(e[i]))return!1;return!0}return t.type===EMPTY_NODE||(t.type===GROUP_NODE&&void 0===t.num?m(t.sub):t.type===CHOICE_NODE?m(t.branches):void 0)}function b(t){return!t.chars&&!t.ranges.length&&1===t.classes.length}var l="DejaVu Sans Mono,monospace",d=16,a="#e2e2e2",f=!1,s=10,x={},w={startPoint:function(t,e,i){return n({type:"startPoint",id:"startPoint",indices:[-1,-1]},e,i,$.startRegex)},endPoint:function(t,e,i){return n({type:"endPoint",id:"endPoint",indices:[1/0,1/0]},e,i,$.endRegex)},empty:function(t,e,i){return{items:[g(t,e,i,e+10)],width:10,height:2,x:e,y:i,lineInX:e,lineOutX:e+10}},exact:function(t,e,i){return k(t,t.chars,e,i,"skyblue")},dot:function(t,e,i){i=k(t,"AnyCharExceptNewLine",e,i,"DarkGreen","white");return i.rect.r=10,i.rect.tip="AnyChar except CR LF",i},backref:function(t,e,i){i=k(t,"Backref #"+t.num,e,i,"navy","white");return i.rect.r=8,i},repeat:function(t,e,i){function n(t){return t+(t<2?" time":" times")}function r(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t,i[5]+=e,i[6]+=t,i[7]+=e,i[9]+=e,i[11]+=t,i[12]+=e,i[13]+=t,i[14]+=e,i[16]+=t,i[18]+=t,i[19]+=e,i[20]+=t,i[21]+=e,i[23]+=e,i[25]+=t,i[26]+=e,i[27]+=t,i[28]+=e}if(m(t))return w.empty(t,e,i);var h=t.repeat,a="",s=[];if(h.min===h.max&&0===h.min)return w.empty(t,e,i);var o=w[t.type](t,e,i),u=o.width,c=o.height;if(h.min===h.max&&1===h.min)return o;h.min===h.max?a+=n(h.min):(a+=h.min,isFinite(h.max)?a+=(1<h.max-h.min?" to ":" or ")+n(h.max):a+=" or more times");var l,d,p=10,g=0,y=o.y+o.height-i,f=20+o.width,u=f;return 1!==h.max?(y+=10,c+=10,l={type:"path",class:`path:curve:${t.indices.join(";")}`,path:["M",o.x+10,i,"Q",e,i,e,i+10,"V",i+y-10,"Q",e,i+y,e+10,i+y,"H",e+f-10,"Q",e+f,i+y,e+f,i+y-10,"V",i+10,"Q",e+f,i,o.x+o.width+10,i],_translate:r,stroke:"maroon","stroke-width":2},h.nonGreedy&&(l.stroke="Brown",l["stroke-dasharray"]="-"),s.push(l)):a=!1,0===h.min&&(d=i-o.y+10,p+=10,g=-12,u=f=f+20,c+=10,h={type:"path",class:`path:curve:${t.indices.join(";")}`,path:["M",e,i,"Q",e+10,i,e+10,i-10,"V",i-d+10,"Q",e+10,i-d,e+20,i-d,"H",e+f-20,"Q",e+f-10,i-d,e+f-10,i-d+10,"V",i-10,"Q",e+f-10,i,e+f,i],_translate:r,stroke:h.nonGreedy?"darkgreen":"#333","stroke-width":2},l&&v([l],10,0),s.push(h)),a&&(v([(a=X(t,e+u/2,i,a)).label],0,y+a.height+4),s.push(a.label),c+=4+a.height,(y=(Math.max(a.width,u)-u)/2)&&v(s,y,0),u=Math.max(a.width,u),p+=y),v(o.items,p,0),{items:s=s.concat(o.items),width:u,height:c,x:e,y:o.y+g,lineInX:o.lineInX+p,lineOutX:o.lineOutX+p}},choice:function(h,a,s){if(m(h))return w.empty(h,a,s);var e=0,o=0,t=h.branches.map(function(t){t=p(t,a,s);return e+=t.height,o=Math.max(o,t.width),t});e+=6*(t.length-1)+8;var u=a+(o+=40)/2,c=s-e/2+4,l=a+o,d=[];return t.forEach(function(t){var e=u-t.width/2;v(t.items,e-t.x,c-t.y),d=d.concat(t.items);var i=s+c-t.y,n=y(h,a,s,a+20,i),r=y(h,l,s,a+o-20,i);d.push(n,r),a+20!==e-t.x+t.lineInX&&d.push(g(h,a+20,i,e-t.x+t.lineInX)),t.lineOutX+e-t.x!=a+o-20&&d.push(g(h,t.lineOutX+e-t.x,i,a+o-20)),t.x=e,t.y=c,c+=t.height+6}),{items:d,width:o,height:e,x:a,y:s-e/2,lineInX:a,lineOutX:l}},charset:function(e,i,n){var t,r={d:"Digit",D:"NonDigit",w:"Word",W:"NonWord",s:"WhiteSpace",S:"NonWhiteSpace"},h=e.exclude?"Pink":"Khaki",a=e.exclude?"#C00":"";if(b(e)){if((t=k(e,r[e.classes[0]],i,n,"Green","white")).rect.r=5,e.exclude){var s=X(e,t.x+t.width/2,t.y,"None of:",a);(x=t.items).push(s.label);var o=t.width,u=Math.max(s.width,t.width);return v(x,w=(u-o)/2,0),{items:x,width:u,height:t.height+s.height,x:Math.min(s.x,t.x),y:s.y,lineInX:w+t.x,lineOutX:w+t.x+t.width}}return t}if(!e.chars&&!e.ranges.length&&!e.classes.length)return(t=k(e,"AnyChar",i,n,"green","white")).rect.r=5,t;var c=[],u=0,l=0;e.chars&&((g=k(e,e.chars,i,n,"LightSkyBlue","black")).rect.r=5,c.push(g),u=g.width),e.ranges.forEach(function(t){t=t.split("").join("-");t=k(e,t,i,n,"teal","white");t.rect.r=5,c.push(t),u=Math.max(t.width,u)}),e.classes.forEach(function(t){t=k(e,r[t],i,n,"Green","white");t.rect.r=5,c.push(t),u=Math.max(t.width,u)});var d,p,g=c[0].height,y=[],f=[];for(c.sort(function(t,e){return e.width-t.width}),c.forEach(function(t){(2*t.width+4>u?y:f).push(t)}),c=y;f.length;){if(d=f.pop(),!(p=f.pop())){c.push(d);break}2<d.width-p.width?(c.push(d),f.push(p)):(v(p.items,d.width+4,0),c.push({items:d.items.concat(p.items),width:d.width+p.width+4,height:d.height,x:d.x,y:d.y}),l-=d.height)}u+=12;var l=4*(c.length-1)+c.length*g+12,h={type:"rect",class:`rect:charsetgroup:${e.indices.join(";")}`,x:i,y:n-l/2,r:4,width:u,height:l,stroke:"none",fill:h},m=h.y+6,x=[h];c.forEach(function(t){v(t.items,i-t.x+(u-t.width)/2,m-t.y),x=x.concat(t.items),m+=t.height+4});s=X({type:"charsetgroup",indices:e.indices},h.x+h.width/2,h.y,(e.exclude?"None":"One")+" of:",a);x.push(s.label);var w,o=u;return u=Math.max(s.width,u),v(x,w=(u-o)/2,0),{items:x,width:u,height:l+s.height,x:Math.min(s.x,i),y:s.y,lineInX:w+i,lineOutX:w+i+h.width}},group:function(t,e,i){if(m(t))return w.empty(t,e,i);var n=p(t.sub,0,0),r=c(t,n.items,0,0,n.width,n.height);if(t.num){v([r],10,0);var h=n.width+20,a=n.height+20,s={type:"rect",id:t.id,indices:t.indices,class:`rect:${t.type}:${t.indices.join(";")}`,x:0,y:n.y-10,r:6,width:h,height:a,"stroke-dasharray":".",stroke:"silver","stroke-width":2},o=X(t,s.width/2,s.y-2,`Group ${t.name}#${t.num}`),u=Math.max(o.width,h),h=(u-h)/2,a=c(t,[r,s,o.label],e+h,i,u,a+o.height+4);return{items:[a],width:a.width,height:a.height,x:a.x,y:a.y+o.y,lineInX:e+h+n.lineInX+10,lineOutX:e+h+n.lineOutX+10}}return v([r],e,i),{items:[r],width:r.width,height:r.height,x:e+n.x,y:i+n.y,lineInX:e+n.lineInX,lineOutX:e+n.lineOutX}},assert:function(t,e,i){var n=t.assertionType,r=n.replace("Assert","")+"!";if(h={AssertNonWordBoundary:{bg:"maroon",fg:"white"},AssertWordBoundary:{bg:"purple",fg:"white"},AssertEnd:{bg:"Indigo",fg:"white"},AssertBegin:{bg:"Indigo",fg:"white"}}[n])return k(t,r=f&&("AssertBegin"===n||"AssertEnd"===n)?"Line"+r:r,e,i,h.bg,h.fg);n===AssertLookahead?(a="CornflowerBlue",s="darkgreen",r="Followed by:"):n===AssertNegativeLookahead&&(a="#F63",s="Purple",r="Not followed by:");var h=w.group(t,e,i),n=h.height+16,i=h.width+16,a={type:"rect",class:`rect:${t.type}:${t.indices.join(";")}`,x:e,y:h.y-8,r:6,width:i,height:n,"stroke-dasharray":"-",stroke:a,"stroke-width":2},r=X(t,a.x+i/2,a.y,r,s),s=Math.max(i,r.width),i=(s-i)/2;return v(h.items,8+i,0),i&&v([a,r.label],i,0),{items:h.items.concat([a,r.label]),width:s,height:a.height+r.height,x:e,y:r.y,lineInX:i+h.lineInX+8,lineOutX:i+h.lineOutX+8}}},$={startRegex:"#03a9f4",endRegex:"#ff0058",delimiter:"Indigo",flags:"darkgreen",exact:"#334",dot:"darkblue",backref:"teal",$:"purple","^":"purple","\\b":"#F30","\\B":"#F30","(":"blue",")":"blue","?=":"darkgreen","?!":"red","?:":"grey","[":"navy","]":"navy","|":"blue","{":"maroon",",":"maroon","}":"maroon","*":"maroon","+":"maroon","?":"maroon",repeatNonGreedy:"#F61",defaults:"black",charsetRange:"olive",charsetClass:"navy",charsetExclude:"red",charsetChars:"#534"};return function(t,e,i){var[n,e]=function(t,e){t.clear(),t.setSize(0,0);let i=t.rect(0,0,0,0);i.attr("fill",a),i.attr("stroke",a),function(t){h=t.text(-1e3,-1e3,"XgfTlM|.q\nXgfTlM|.q").attr({"font-family":l,"font-size":d})}(t);t=u(d,"bold");return f=!!~e.indexOf("m"),[i,t]}(i,e);return r.updateProgressBar(10),n=function(t,e,i,n){var r=0,h=0;e=function(t,e,i){return t.unshift({type:"startPoint"}),t.push({type:"endPoint"}),p(t,e,i)}(e.tree,0,0);return h=Math.max(e.height+3*s+i.height,0),r=Math.max(e.width+2*s,0),t.setSize(r,h),n.attr("width",r),n.attr("height",h),v(e.items,s,2*s+i.height-e.y),e}(i,t,e,n),r.updateProgressBar(50),h.remove(),r.updateProgressBar(60),i.addv2(n.items),r.updateProgressBar(100),n}(t,e,i)}