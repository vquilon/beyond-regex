function RegexVisualizer(i,n,r,a,s,h,o){var c,u=Kit();function d(t,e){let i=[],n=(t.forEach(t=>{i.push(t)}),i.forEach(t=>t.remove()),t.rect(0,0,0,0));n.attr("class","backContainer"),c=t.text(-1e3,-1e3,"XgfTlM|.q\nXgfTlM|.q").attr({"font-family":M,"font-size":I});t=y(I,"bold");return O=!!~e.indexOf("m"),[n,t]}function l(t,e,i,n){e=[...e.tree],a=r=0,e.unshift({type:"startPoint"}),e.push({type:"endPoint"});var e=g(e,r,a),r=Math.max(e.height+3*j+i.height,0),a=Math.max(e.width+2*j,0);return t.setSize(a,r),n.attr("width",a),n.attr("height",r),w(e.items,j,2*j+i.height-e.y),e}function p(){c.remove()}function y(t,e){if(e=e||"normal",B[t]&&B[t][e])return B[t][e];c.attr({fill:"transparent","font-size":t,"font-weight":e});var i=c.getBBox();return B[t]=B[t]||{},B[t][e]={width:i.width/((c.attr("text").length-1)/2),height:i.height/2}}function g(i,t,n){var e,r=[],a=[],s=0,h=t,o=n,c=n;if(!i.length)return E.empty(i,t,n);i.forEach(function(t){t=t.repeat?E.repeat(t,h,n):E[t.type](t,h,n);r.push(t),h+=t.width+16,s+=t.width,o=Math.min(o,t.y),c=Math.max(c,t.y+t.height),a=a.concat(t.items)}),e=c-o,r.reduce(function(t,e){s+=16;t=f(i,t.lineOutX,n,e.lineInX,_fromItem=t,_toItem=e);return a.push(t),e});var u=r[0].lineInX,d=r[r.length-1].lineOutX;return{items:a,width:s,height:e,x:t,y:o,lineInX:u,lineOutX:d}}function w(t,e,i){t.forEach(function(t){t._translate?t._translate(e,i):(t.x+=e,t.y+=i)})}function m(t,e,i,n,r,a){return{type:"group",dataset:{id:t.id,indices:t.indices.join(","),type:t.type},class:"group "+t.type,children:e,transform:`t${i},`+n,x:i,y:n,width:r,height:a,_translate:function(t,e){this.x+=t,this.y+=e,this.transform=`t${this.x},`+this.y}}}function v(t,e,i,n,r,a){e=u.toPrint(e);var s=y(I),h=e.length*s.width,s=s.height+12,h=12+h,r={type:"rect",dataset:{id:t.id,indices:t.indices.join(","),type:t.type},class:"rect "+t.type,x:0,y:0,width:h,height:s,stroke:"none",fill:r||"transparent"},e={type:"text",dataset:{id:t.id,indices:t.indices.join(","),type:t.type},class:"text "+t.type,x:h/2,y:s/2,text:e,"font-size":I,"font-family":M,fill:a||"black"},a=m(t,[r,e],i,n-s/2,h,s);return{text:e,rect:r,items:[a],width:h,height:s,x:i,y:a.y,lineInX:i,lineOutX:i+h}}function k(t,e,i,n,r){var a=y(14),s=n.split("\n"),h=s.length*a.height,s=1<s.length?Math.max.apply(Math,s.map(function(t){return t.length})):n.length;return s*=a.width,{label:{type:"text",dataset:{id:t.id,indices:t.indices.join(","),type:t.type},class:`text ${t.type} noBack`,x:e,y:i-h/2-4,text:n,"font-size":14,"font-family":M,fill:r||"#444"},x:e-s/2,y:i-h-4,width:s,height:4+h}}function f(t,e,i,n,r=null,a=null){let s={path:"linejoint",type:t.type};return null!==r&&(s.fromitem=r.items.map(t=>t.dataset.id).join(",")),null!==a&&(s.toitem=a.items.map(t=>t.dataset.id).join(",")),t.hasOwnProperty("indices")&&(s.indices=t.indices.join(","),s.path="any"),{type:"path",dataset:s,class:`path ${t.type} `+s.path,x:e,y:i,path:["M",e,i,"H",n],"stroke-linecap":"butt","stroke-linejoin":"round",stroke:"#333","stroke-width":2,_translate:function(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t}}}function x(t,e,i,n,r){var a,s=n<e?-1:1,h=r<i?-1:1,i=Math.abs(i-r)<15?(a=["M",e,i,"C",e+Math.min(Math.abs(n-e)/2,10)*s,i,n-(n-e)/2,r,n,r],function(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t,i[5]+=e,i[6]+=t,i[7]+=e,i[8]+=t,i[9]+=e}):(a=["M",e,i,"Q",e+10*s,i,e+10*s,i+10*h,"V",Math.abs(i-r)<20?i+10*h:r-10*h,"Q",e+10*s,r,e+10*s*2,r,"H",n],function(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t,i[5]+=e,i[6]+=t,i[7]+=e,i[9]+=e,i[11]+=t,i[12]+=e,i[13]+=t,i[14]+=e,i[16]+=t});return{type:"path",dataset:{id:t.id,indices:t.indices.join(","),type:t.type,path:"curve"},class:"path curve "+t.type,path:a,"stroke-linecap":"butt","stroke-linejoin":"round",stroke:"#333","stroke-width":2,_translate:i}}function _(t,e,i,n){n={type:"circle",dataset:{id:t.id,indices:t.indices.join(","),type:t.type},class:"circle "+t.type,fill:n,cx:10,cy:0,r:10,stroke:"none",_translate:function(t,e){this.cx+=t,this.cy+=e}};return{items:[container_group=m(t,[n],e,i,20,20)],width:container_group.width,height:container_group.height,x:e,y:i,lineInX:container_group.x,lineOutX:container_group.x+container_group.width}}function b(t){if(Array.isArray(t)){for(var e=t,i=0;i<e.length;i++)if(!b(e[i]))return!1;return!0}return t.type===EMPTY_NODE||(t.type===GROUP_NODE&&void 0===t.num?b(t.sub):t.type===CHOICE_NODE?b(t.branches):void 0)}function X(t){return!t.chars&&!t.ranges.length&&1===t.classes.length}var M="VictorMono, monospace",I=16,O=!1,j=10,B={},E={startPoint:function(t,e,i){return _({type:"startPoint",id:"startPoint",indices:[-1,-1]},e,i,P.startRegex)},endPoint:function(t,e,i){return _({type:"endPoint",id:"endPoint",indices:[1/0,1/0]},e,i,P.endRegex)},empty:function(t,e,i){return{items:[f(t,e,i,e+10)],width:10,height:2,x:e,y:i,lineInX:e,lineOutX:e+10}},exact:function(t,e,i){return v(t,t.chars,e,i,"skyblue")},unicode:function(t,e,i){return v(t,t.chars,e,i,"skyblue")},hexadecimal:function(t,e,i){return v(t,t.chars,e,i,"skyblue")},octal:function(t,e,i){return v(t,t.chars,e,i,"skyblue")},comment:function(t,e,i){var n=v(t,t.comment,0,0,"grey","white"),r=m(t,n.items,0,0,n.width,n.height),a=(w([r],10,0),n.width+20),s=n.height+20,h={type:"rect",dataset:{id:t.id,indices:t.indices.join(","),type:t.type},class:"rect "+t.type,x:0,y:n.y-10,r:6,width:a,height:s,"stroke-dasharray":".",stroke:"silver","stroke-width":2},o=k(t,h.width/2,h.y-2,"Comment"),c=Math.max(o.width,a),a=(c-a)/2,t=m(t,[r,h,o.label],e+a,i,c,s+o.height+4);return{items:[t],width:t.width,height:t.height,x:t.x,y:t.y+o.y,lineInX:e+a+n.lineInX+10,lineOutX:e+a+n.lineOutX+10}},dot:function(t,e,i){t=v(t,"AnyCharExceptNewLine",e,i,"DarkGreen","white");return t.rect.r=10,t.rect.tip="AnyChar except CR LF",t},backref:function(t,e,i){t=v(t,"Backref #"+t.num,e,i,"navy","white");return t.rect.r=8,t},repeat:function(t,e,i){function n(t){return t+(t<2?" time":" times")}function r(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t,i[5]+=e,i[6]+=t,i[7]+=e,i[9]+=e,i[11]+=t,i[12]+=e,i[13]+=t,i[14]+=e,i[16]+=t,i[18]+=t,i[19]+=e,i[20]+=t,i[21]+=e,i[23]+=e,i[25]+=t,i[26]+=e,i[27]+=t,i[28]+=e}if(b(t))return E.empty(t,e,i);var a=t.repeat,s="",h=[];if(a.min===a.max&&0===a.min)return E.empty(t,e,i);var o=E[t.type](t,e,i),c=o.width,u=o.height;if(a.min===a.max&&1===a.min)return o;a.min===a.max?s+=n(a.min):(s+=a.min,isFinite(a.max)?s+=(1<a.max-a.min?" to ":" or ")+n(a.max):s+=" or more times");var d,l,p=10,y=0,g=o.y+o.height-i,m=20+o.width,c=m;return 1!==a.max?(g+=10,u+=10,d={type:"path",dataset:{id:t.id,indices:t.indices.join(","),type:t.type,path:"repeat"},class:"path repeat "+t.type,path:["M",o.x+10,i,"Q",e,i,e,i+10,"V",i+g-10,"Q",e,i+g,e+10,i+g,"H",e+m-10,"Q",e+m,i+g,e+m,i+g-10,"V",i+10,"Q",e+m,i,o.x+o.width+10,i],_translate:r,stroke:"maroon","stroke-width":2},a.nonGreedy&&(d.stroke="Brown",d["stroke-dasharray"]="-"),h.push(d)):s=!1,0===a.min&&(l=i-o.y+10,p+=10,y=-12,c=m=m+20,u+=10,l={type:"path",dataset:{id:t.id,indices:t.indices.join(","),type:t.type,path:"repeat"},class:"path repeat "+t.type,path:["M",e,i,"Q",e+10,i,e+10,i-10,"V",i-l+10,"Q",e+10,i-l,e+20,i-l,"H",e+m-20,"Q",e+m-10,i-l,e+m-10,i-l+10,"V",i-10,"Q",e+m-10,i,e+m,i],_translate:r,stroke:a.nonGreedy?"darkgreen":"#333","stroke-width":2},d&&w([d],10,0),h.push(l)),s&&(w([(m=k(t,e+c/2,i,s)).label],0,g+m.height+4),h.push(m.label),u+=4+m.height,(a=(Math.max(m.width,c)-c)/2)&&w(h,a,0),c=Math.max(m.width,c),p+=a),w(o.items,p,0),{items:h=h.concat(o.items),width:c,height:u,x:e,y:o.y+y,lineInX:o.lineInX+p,lineOutX:o.lineOutX+p}},choice:function(a,s,h){if(b(a))return E.empty(a,s,h);var e=0,o=0,t=a.branches.map(function(t){t=g(t,s,h);return e+=t.height,o=Math.max(o,t.width),t}),c=(e+=6*(t.length-1)+8,s+(o+=40)/2),u=h-e/2+4,d=s+o,l=[];return t.forEach(function(t){var e=c-t.width/2,i=(w(t.items,e-t.x,u-t.y),l=l.concat(t.items),h+u-t.y),n=x(a,s,h,s+20,i),r=x(a,d,h,s+o-20,i);l.push(n,r),s+20!==e-t.x+t.lineInX&&l.push(f(a,s+20,i,e-t.x+t.lineInX)),t.lineOutX+e-t.x!=s+o-20&&l.push(f(a,t.lineOutX+e-t.x,i,s+o-20)),t.x=e,t.y=u,u+=t.height+6}),{items:l,width:o,height:e,x:s,y:h-e/2,lineInX:s,lineOutX:d}},charset:function(e,i,n){var r={d:"Digit",D:"NonDigit",w:"Word",W:"NonWord",s:"WhiteSpace",S:"NonWhiteSpace"},t=e.exclude?"Pink":"Khaki",a=e.exclude?"#C00":"";if(X(e))return(p=v(e,r[e.classes[0]],i,n,"Green","white")).rect.r=5,e.exclude?(m=k(e,p.x+p.width/2,p.y,"None of:",a),(g=p.items).push(m.label),f=p.width,c=Math.max(m.width,p.width),w(g,x=(c-f)/2,0),{items:g,width:c,height:p.height+m.height,x:Math.min(m.x,p.x),y:m.y,lineInX:x+p.x,lineOutX:x+p.x+p.width}):p;if(!e.chars&&!e.ranges.length&&!e.classes.length)return(p=v(e,"AnyChar",i,n,"green","white")).rect.r=5,p;var s,h,o=[],c=0,u=0,d=(e.chars&&((p=v(e,e.chars,i,n,"LightSkyBlue","black")).rect.r=5,o.push(p),c=p.width),e.ranges.forEach(function(t){t=t.split("").join("-");t=v(e,t,i,n,"teal","white");t.rect.r=5,o.push(t),c=Math.max(t.width,c)}),e.classes.forEach(function(t){t=v(e,r[t],i,n,"Green","white");t.rect.r=5,o.push(t),c=Math.max(t.width,c)}),p=o[0].height,[]),l=[];for(o.sort(function(t,e){return e.width-t.width}),o.forEach(function(t){(2*t.width+4>c?d:l).push(t)}),o=d;l.length;){if(s=l.pop(),!(h=l.pop())){o.push(s);break}2<s.width-h.width?(o.push(s),l.push(h)):(w(h.items,s.width+4,0),o.push({items:s.items.concat(h.items),width:s.width+h.width+4,height:s.height,x:s.x,y:s.y}),u-=s.height)}c+=12;var u=4*(o.length-1)+o.length*p+12,p={type:"rect",dataset:{id:e.id,indices:e.indices.join(","),type:e.type},class:"rect charsetgroup "+e.type,x:i,y:n-u/2,r:4,width:c,height:u,stroke:"none",fill:t},y=p.y+6,g=[p],t=(o.forEach(function(t){w(t.items,i-t.x+(c-t.width)/2,y-t.y),g=g.concat(t.items),y+=t.height+4}),{type:"charsetgroup",indices:e.indices}),m=k(t,p.x+p.width/2,p.y,(e.exclude?"None":"One")+" of:",a),f=(g.push(m.label),c),x=((c=Math.max(m.width,c))-f)/2;return w(g,x,0),{items:g,width:c,height:u+m.height,x:Math.min(m.x,i),y:m.y,lineInX:x+i,lineOutX:x+i+p.width}},group:function(t,e,i){if(b(t))return E.empty(t,e,i);var n,r,a=g(t.sub,0,0),s=m(t,a.items,0,0,a.width,a.height),h=(w([s],10,0),a.width+20),o=a.height+20,c=(r=t.num?(n={type:"rect",dataset:{id:t.id,indices:t.indices.join(","),type:t.type},class:"rect "+t.type,x:0,y:a.y-10,r:6,width:h,height:o,"stroke-dasharray":".",stroke:"silver","stroke-width":2},k(t,n.width/2,n.y-2,`Group ${t.name}#`+t.num)):(n={type:"rect",dataset:{id:t.id,indices:t.indices.join(","),type:t.type},class:"rect "+t.type,x:0,y:a.y-10,r:6,width:h,height:o,"stroke-dasharray":".",stroke:"silver","stroke-width":2},k(t,n.width/2,n.y-2,"Group Non-Capturing")),Math.max(r.width,h)),h=(c-h)/2,t=m(t,[s,n,r.label],e+h,i,c,o+r.height+4);return{items:[t],width:t.width,height:t.height,x:t.x,y:t.y+r.y,lineInX:e+h+a.lineInX+10,lineOutX:e+h+a.lineOutX+10}},assert:function(t,e,i){var n,r=t.assertionType,a=r.replace("Assert","")+"!";if(s={AssertNonWordBoundary:{bg:"maroon",fg:"white"},AssertWordBoundary:{bg:"purple",fg:"white"},AssertEnd:{bg:"Indigo",fg:"white"},AssertBegin:{bg:"Indigo",fg:"white"}}[r])return v(t,a=!O||"AssertBegin"!==r&&"AssertEnd"!==r?a:"Line"+a,e,i,s.bg,s.fg);r===AssertLookahead?(h="CornflowerBlue",n="darkgreen",a="Followed by:"):r===AssertNegativeLookahead&&(h="#F63",n="Purple",a="Not followed by:");var s=E.group(t,e,i),r=s.height+16,i=s.width+16,r={type:"rect",dataset:{id:t.id,indices:t.indices.join(","),type:t.type},class:"rect "+t.type,x:e,y:s.y-8,r:6,width:i,height:r,"stroke-dasharray":"-",stroke:h,"stroke-width":2},h=k(t,r.x+i/2,r.y,a,n),t=Math.max(i,h.width),a=(t-i)/2;return w(s.items,8+a,0),a&&w([r,h.label],a,0),{items:s.items.concat([r,h.label]),width:t,height:r.height+h.height,x:e,y:h.y,lineInX:a+s.lineInX+8,lineOutX:a+s.lineOutX+8}}},P={startRegex:"#03a9f4",endRegex:"#ff0058",delimiter:"Indigo",flags:"darkgreen",exact:"#334",dot:"darkblue",backref:"teal",$:"purple","^":"purple","\\b":"#F30","\\B":"#F30","(":"blue",")":"blue","?=":"darkgreen","?!":"red","?:":"grey","[":"navy","]":"navy","|":"blue","{":"maroon",",":"maroon","}":"maroon","*":"maroon","+":"maroon","?":"maroon",repeatNonGreedy:"#F61",defaults:"black",charsetRange:"olive",charsetClass:"navy",charsetExclude:"red",charsetChars:"#534"};h.updateProgressBar(0);{o=[[["canvasRaph","regexson_tree","sizeTextItem","regexBoxRect"],(t,e,i,n)=>{e=l(t,e,i,n);return h.updateProgressBar(40),[e,t]},["raphael_items","canvasRaph"]],[[],()=>{p(),h.updateProgressBar(60)},[]],[["canvasRaph","raphael_items"],(t,e)=>(t.addv2(e.items),h.updateProgressBar(80),t),["canvasRaph"]],[["canvasRaph"],t=>{let e=Array.from(t.canvas.childNodes);e.forEach(t=>{t!==a&&s.appendChild(t)}),h.updateProgressBar(100)},[]],[[],o,[]]];class N{constructor(t,e,i){this.callback=t,this.inputs=e,this.outputs=i}run(e){let t=[];for(var i of this.inputs.args_names)t.push(e[i]);n=this.callback;var n,r=function(){var t=Array.prototype.slice.call(arguments)[0];return n.apply(0,t)}(t);if(0!==this.outputs.args_names.length&&(1===this.outputs.args_names.length&&(e[this.outputs.args_names[0]]=r),1<this.outputs.args_names.length))for(let t=0;t<this.outputs.args_names.length;t++)e[this.outputs.args_names[t]]=r[t];return e}}class R{constructor(t){for(var e of t)this[e]=void 0;this.args_names=t}}var[A,C]=d(r,n);let t=Array.from(r.canvas.childNodes),e=(t.forEach(t=>{t!==a&&s.appendChild(t)}),h.updateProgressBar(10),new class{constructor(t,e){this.runtime_vars=e||{},this.execution_plan=this.process_plan(t)}process_plan(t){let e=[];for(var i of t)e.push(new N(i[1],new R(i[0]),new R(i[2])));return e}run(){for(var t of this.execution_plan)this.runtime_vars=t.run(this.runtime_vars)}run_iterative(){var n=this.runtime_vars;for(let t=0;t<this.execution_plan.length;t++)!function(t,e){let i=e[t];window.setTimeout(function(){n=i.run(n)},20*t+500)}(t,this.execution_plan)}run_recursive(){var i=this;window.setTimeout(function t(e){return function(){i.runtime_vars=i.execution_plan[e].run(i.runtime_vars),e<i.execution_plan.length-1&&window.setTimeout(t(e+1),0)}}(0),0)}}(o,{regexBoxRect:A,sizeTextItem:C,canvasRaph:r,regex_flags:n,regexson_tree:i}));return e.run_recursive(),e.runtime_vars.raphael_items}}