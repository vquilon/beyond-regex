function RegexVisualizer(t,e,i,n){var r,o=Kit();function u(t,e){if(e=e||"normal",x[t]&&x[t][e])return x[t][e];r.attr({"font-size":t,"font-weight":e});var i=r.getBBox();return x[t]=x[t]||{},x[t][e]={width:i.width/((r.attr("text").length-1)/2),height:i.height/2}}function p(i,t,n){var e,r=[],h=[],a=0,s=t,o=n,u=n;if(!i.length)return b.empty(i,t,n);i.forEach(function(t){t=t.repeat?b.repeat(t,s,n):b[t.type](t,s,n);r.push(t),s+=t.width+16,a+=t.width,o=Math.min(o,t.y),u=Math.max(u,t.y+t.height),h=h.concat(t.items)}),e=u-o,r.reduce(function(t,e){a+=16;t=g(i,t.lineOutX,n,e.lineInX,_fromItem=t,_toItem=e);return h.push(t),e});var c=r[0].lineInX,l=r[r.length-1].lineOutX;return{items:h,width:a,height:e,x:t,y:o,lineInX:c,lineOutX:l}}function w(t,e,i){t.forEach(function(t){t._translate?t._translate(e,i):(t.x+=e,t.y+=i)})}function c(t,e,i,n,r,h){return{type:"group",id:t.id||"",indices:[t.indices[0]+1,t.indices[1]-1],class:`g:${t.type}:`+[t.indices[0]+1,t.indices[1]-1].join(";"),children:e,transform:`t${i},`+n,x:i,y:n,width:r,height:h,_translate:function(t,e){this.x+=t,this.y+=e,this.transform=`t${this.x},`+this.y}}}function k(t,e,i,n,r,h){e=o.toPrint(e);var a=u(d),s=e.length*a.width,a=a.height+12,s=12+s,r={type:"rect",class:`rect:${t.type}:`+t.indices.join(";"),x:0,y:0,width:s,height:a,stroke:"none",fill:r||"transparent"},e={type:"text",class:`text:${t.type}:`+t.indices.join(";"),x:s/2,y:a/2,text:e,"font-size":d,"font-family":l,fill:h||"black"},h=c(t,[r,e],i,n-a/2,s,a);return{text:e,rect:r,items:[h],width:s,height:a,x:i,y:h.y,lineInX:i,lineOutX:i+s}}function v(t,e,i,n,r){var h=u(14),a=n.split("\n"),s=a.length*h.height,a=1<a.length?Math.max.apply(Math,a.map(function(t){return t.length})):n.length;return a*=h.width,{label:{type:"text",class:`text:${t.type}:`+t.indices.join(";"),x:e,y:i-s/2-4,text:n,"font-size":14,"font-family":l,fill:r||"#444"},x:e-a/2,y:i-s-4,width:a,height:4+s}}function g(t,e,i,n,r=null,h=null){let a="linejoint";return null!==r&&(a=a+"::"+r.items.map(t=>t.class).join("_")),null!==h&&(a=`${a}::${h.items.map(t=>t.class).join("_")}::`),{type:"path",class:"path:"+(a=t.hasOwnProperty("indices")?"curve:"+t.indices.join(";"):a),x:e,y:i,path:["M",e,i,"H",n],"stroke-linecap":"butt","stroke-linejoin":"round",stroke:"#333","stroke-width":2,_translate:function(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t}}}function y(t,e,i,n,r){var h,a=n<e?-1:1,s=r<i?-1:1,i=Math.abs(i-r)<15?(h=["M",e,i,"C",e+Math.min(Math.abs(n-e)/2,10)*a,i,n-(n-e)/2,r,n,r],function(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t,i[5]+=e,i[6]+=t,i[7]+=e,i[8]+=t,i[9]+=e}):(h=["M",e,i,"Q",e+10*a,i,e+10*a,i+10*s,"V",Math.abs(i-r)<20?i+10*s:r-10*s,"Q",e+10*a,r,e+10*a*2,r,"H",n],function(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t,i[5]+=e,i[6]+=t,i[7]+=e,i[9]+=e,i[11]+=t,i[12]+=e,i[13]+=t,i[14]+=e,i[16]+=t});return{type:"path",class:"path:curve:"+t.indices.join(";"),path:h,"stroke-linecap":"butt","stroke-linejoin":"round",stroke:"#333","stroke-width":2,_translate:i}}function h(t,e,i,n){n={type:"circle",id:t.id,class:`circle:${t.type}:`+t.indices.join(";"),fill:n,cx:10,cy:0,r:10,stroke:"none",_translate:function(t,e){this.cx+=t,this.cy+=e}};return{items:[container_group=c(t,[n],e,i,20,20)],width:container_group.width,height:container_group.height,x:e,y:i,lineInX:container_group.x,lineOutX:container_group.x+container_group.width}}function m(t){if(Array.isArray(t)){for(var e=t,i=0;i<e.length;i++)if(!m(e[i]))return!1;return!0}return t.type===EMPTY_NODE||(t.type===GROUP_NODE&&void 0===t.num?m(t.sub):t.type===CHOICE_NODE?m(t.branches):void 0)}function X(t){return!t.chars&&!t.ranges.length&&1===t.classes.length}var l="DejaVu Sans Mono,monospace",d=16,a="#e2e2e2",f=!1,s=10,x={},b={startPoint:function(t,e,i){return h({type:"startPoint",id:"startPoint",indices:[-1,-1]},e,i,M.startRegex)},endPoint:function(t,e,i){return h({type:"endPoint",id:"endPoint",indices:[1/0,1/0]},e,i,M.endRegex)},empty:function(t,e,i){return{items:[g(t,e,i,e+10)],width:10,height:2,x:e,y:i,lineInX:e,lineOutX:e+10}},exact:function(t,e,i){return k(t,t.chars,e,i,"skyblue")},dot:function(t,e,i){t=k(t,"AnyCharExceptNewLine",e,i,"DarkGreen","white");return t.rect.r=10,t.rect.tip="AnyChar except CR LF",t},backref:function(t,e,i){t=k(t,"Backref #"+t.num,e,i,"navy","white");return t.rect.r=8,t},repeat:function(t,e,i){function n(t){return t+(t<2?" time":" times")}function r(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t,i[5]+=e,i[6]+=t,i[7]+=e,i[9]+=e,i[11]+=t,i[12]+=e,i[13]+=t,i[14]+=e,i[16]+=t,i[18]+=t,i[19]+=e,i[20]+=t,i[21]+=e,i[23]+=e,i[25]+=t,i[26]+=e,i[27]+=t,i[28]+=e}if(m(t))return b.empty(t,e,i);var h=t.repeat,a="",s=[];if(h.min===h.max&&0===h.min)return b.empty(t,e,i);var o=b[t.type](t,e,i),u=o.width,c=o.height;if(h.min===h.max&&1===h.min)return o;h.min===h.max?a+=n(h.min):(a+=h.min,isFinite(h.max)?a+=(1<h.max-h.min?" to ":" or ")+n(h.max):a+=" or more times");var l,d,p=10,g=0,y=o.y+o.height-i,f=20+o.width,u=f;return 1!==h.max?(y+=10,c+=10,l={type:"path",class:"path:curve:"+t.indices.join(";"),path:["M",o.x+10,i,"Q",e,i,e,i+10,"V",i+y-10,"Q",e,i+y,e+10,i+y,"H",e+f-10,"Q",e+f,i+y,e+f,i+y-10,"V",i+10,"Q",e+f,i,o.x+o.width+10,i],_translate:r,stroke:"maroon","stroke-width":2},h.nonGreedy&&(l.stroke="Brown",l["stroke-dasharray"]="-"),s.push(l)):a=!1,0===h.min&&(d=i-o.y+10,p+=10,g=-12,u=f=f+20,c+=10,d={type:"path",class:"path:curve:"+t.indices.join(";"),path:["M",e,i,"Q",e+10,i,e+10,i-10,"V",i-d+10,"Q",e+10,i-d,e+20,i-d,"H",e+f-20,"Q",e+f-10,i-d,e+f-10,i-d+10,"V",i-10,"Q",e+f-10,i,e+f,i],_translate:r,stroke:h.nonGreedy?"darkgreen":"#333","stroke-width":2},l&&w([l],10,0),s.push(d)),a&&(w([(f=v(t,e+u/2,i,a)).label],0,y+f.height+4),s.push(f.label),c+=4+f.height,(h=(Math.max(f.width,u)-u)/2)&&w(s,h,0),u=Math.max(f.width,u),p+=h),w(o.items,p,0),{items:s=s.concat(o.items),width:u,height:c,x:e,y:o.y+g,lineInX:o.lineInX+p,lineOutX:o.lineOutX+p}},choice:function(h,a,s){if(m(h))return b.empty(h,a,s);var e=0,o=0,t=h.branches.map(function(t){t=p(t,a,s);return e+=t.height,o=Math.max(o,t.width),t}),u=(e+=6*(t.length-1)+8,a+(o+=40)/2),c=s-e/2+4,l=a+o,d=[];return t.forEach(function(t){var e=u-t.width/2,i=(w(t.items,e-t.x,c-t.y),d=d.concat(t.items),s+c-t.y),n=y(h,a,s,a+20,i),r=y(h,l,s,a+o-20,i);d.push(n,r),a+20!==e-t.x+t.lineInX&&d.push(g(h,a+20,i,e-t.x+t.lineInX)),t.lineOutX+e-t.x!=a+o-20&&d.push(g(h,t.lineOutX+e-t.x,i,a+o-20)),t.x=e,t.y=c,c+=t.height+6}),{items:d,width:o,height:e,x:a,y:s-e/2,lineInX:a,lineOutX:l}},charset:function(e,i,n){var r={d:"Digit",D:"NonDigit",w:"Word",W:"NonWord",s:"WhiteSpace",S:"NonWhiteSpace"},t=e.exclude?"Pink":"Khaki",h=e.exclude?"#C00":"";if(X(e))return(p=k(e,r[e.classes[0]],i,n,"Green","white")).rect.r=5,e.exclude?(f=v(e,p.x+p.width/2,p.y,"None of:",h),(y=p.items).push(f.label),m=p.width,u=Math.max(f.width,p.width),w(y,x=(u-m)/2,0),{items:y,width:u,height:p.height+f.height,x:Math.min(f.x,p.x),y:f.y,lineInX:x+p.x,lineOutX:x+p.x+p.width}):p;if(!e.chars&&!e.ranges.length&&!e.classes.length)return(p=k(e,"AnyChar",i,n,"green","white")).rect.r=5,p;var a,s,o=[],u=0,c=0,l=(e.chars&&((p=k(e,e.chars,i,n,"LightSkyBlue","black")).rect.r=5,o.push(p),u=p.width),e.ranges.forEach(function(t){t=t.split("").join("-");t=k(e,t,i,n,"teal","white");t.rect.r=5,o.push(t),u=Math.max(t.width,u)}),e.classes.forEach(function(t){t=k(e,r[t],i,n,"Green","white");t.rect.r=5,o.push(t),u=Math.max(t.width,u)}),p=o[0].height,[]),d=[];for(o.sort(function(t,e){return e.width-t.width}),o.forEach(function(t){(2*t.width+4>u?l:d).push(t)}),o=l;d.length;){if(a=d.pop(),!(s=d.pop())){o.push(a);break}2<a.width-s.width?(o.push(a),d.push(s)):(w(s.items,a.width+4,0),o.push({items:a.items.concat(s.items),width:a.width+s.width+4,height:a.height,x:a.x,y:a.y}),c-=a.height)}u+=12;var c=4*(o.length-1)+o.length*p+12,p={type:"rect",class:"rect:charsetgroup:"+e.indices.join(";"),x:i,y:n-c/2,r:4,width:u,height:c,stroke:"none",fill:t},g=p.y+6,y=[p],t=(o.forEach(function(t){w(t.items,i-t.x+(u-t.width)/2,g-t.y),y=y.concat(t.items),g+=t.height+4}),{type:"charsetgroup",indices:e.indices}),f=v(t,p.x+p.width/2,p.y,(e.exclude?"None":"One")+" of:",h),m=(y.push(f.label),u),x=((u=Math.max(f.width,u))-m)/2;return w(y,x,0),{items:y,width:u,height:c+f.height,x:Math.min(f.x,i),y:f.y,lineInX:x+i,lineOutX:x+i+p.width}},group:function(t,e,i){if(m(t))return b.empty(t,e,i);var n,r,h,a,s,o=p(t.sub,0,0),u=c(t,o.items,0,0,o.width,o.height);return t.num?(w([u],10,0),n=o.width+20,r=o.height+20,s={type:"rect",id:t.id,indices:t.indices,class:`rect:${t.type}:`+t.indices.join(";"),x:0,y:o.y-10,r:6,width:n,height:r,"stroke-dasharray":".",stroke:"silver","stroke-width":2},h=v(t,s.width/2,s.y-2,`Group ${t.name}#`+t.num),a=Math.max(h.width,n),{items:[s=c(t,[u,s,h.label],e+(t=(a-n)/2),i,a,r+h.height+4)],width:s.width,height:s.height,x:s.x,y:s.y+h.y,lineInX:e+t+o.lineInX+10,lineOutX:e+t+o.lineOutX+10}):(w([u],e,i),{items:[u],width:u.width,height:u.height,x:e+o.x,y:i+o.y,lineInX:e+o.lineInX,lineOutX:e+o.lineOutX})},assert:function(t,e,i){var n,r=t.assertionType,h=r.replace("Assert","")+"!";if(a={AssertNonWordBoundary:{bg:"maroon",fg:"white"},AssertWordBoundary:{bg:"purple",fg:"white"},AssertEnd:{bg:"Indigo",fg:"white"},AssertBegin:{bg:"Indigo",fg:"white"}}[r])return k(t,h=!f||"AssertBegin"!==r&&"AssertEnd"!==r?h:"Line"+h,e,i,a.bg,a.fg);r===AssertLookahead?(s="CornflowerBlue",n="darkgreen",h="Followed by:"):r===AssertNegativeLookahead&&(s="#F63",n="Purple",h="Not followed by:");var a=b.group(t,e,i),r=a.height+16,i=a.width+16,r={type:"rect",class:`rect:${t.type}:`+t.indices.join(";"),x:e,y:a.y-8,r:6,width:i,height:r,"stroke-dasharray":"-",stroke:s,"stroke-width":2},s=v(t,r.x+i/2,r.y,h,n),t=Math.max(i,s.width),h=(t-i)/2;return w(a.items,8+h,0),h&&w([r,s.label],h,0),{items:a.items.concat([r,s.label]),width:t,height:r.height+s.height,x:e,y:s.y,lineInX:h+a.lineInX+8,lineOutX:h+a.lineOutX+8}}},M={startRegex:"#03a9f4",endRegex:"#ff0058",delimiter:"Indigo",flags:"darkgreen",exact:"#334",dot:"darkblue",backref:"teal",$:"purple","^":"purple","\\b":"#F30","\\B":"#F30","(":"blue",")":"blue","?=":"darkgreen","?!":"red","?:":"grey","[":"navy","]":"navy","|":"blue","{":"maroon",",":"maroon","}":"maroon","*":"maroon","+":"maroon","?":"maroon",repeatNonGreedy:"#F61",defaults:"black",charsetRange:"olive",charsetClass:"navy",charsetExclude:"red",charsetChars:"#534"},[e,O]=function(t,e){t.clear(),t.setSize(0,0);let i=t.rect(0,0,0,0),n=(i.attr("fill",a),i.attr("stroke",a),function(t){r=t.text(-1e3,-1e3,"XgfTlM|.q\nXgfTlM|.q").attr({"font-family":l,"font-size":d})}(t),u(d,"bold"));return f=!!~e.indexOf("m"),[i,n]}(i,e=e),t=(n.updateProgressBar(10),function(t,e,i,n){var r=0,h=0;e=function(t,e,i){return t.unshift({type:"startPoint"}),t.push({type:"endPoint"}),p(t,e,i)}([...e.tree],0,0);return h=Math.max(e.height+3*s+i.height,0),r=Math.max(e.width+2*s,0),t.setSize(r,h),n.attr("width",r),n.attr("height",h),w(e.items,s,2*s+i.height-e.y),e}(i,t,O,e));return n.updateProgressBar(50),r.remove(),n.updateProgressBar(60),i.addv2(t.items),n.updateProgressBar(100),t}