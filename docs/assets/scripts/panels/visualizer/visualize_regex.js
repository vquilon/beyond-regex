function RegexVisualizer(i,n,r,a,h,s,o){var u,c=Kit();function l(t,e){if(e=e||"normal",b[t]&&b[t][e])return b[t][e];u.attr({fill:"transparent","font-size":t,"font-weight":e});var i=u.getBBox();return b[t]=b[t]||{},b[t][e]={width:i.width/((u.attr("text").length-1)/2),height:i.height/2}}function p(i,t,n){var e,r=[],a=[],h=0,s=t,o=n,u=n;if(!i.length)return M.empty(i,t,n);i.forEach(function(t){t=t.repeat?M.repeat(t,s,n):M[t.type](t,s,n),r.push(t),s+=t.width+16,h+=t.width,o=Math.min(o,t.y),u=Math.max(u,t.y+t.height),a=a.concat(t.items)}),e=u-o,r.reduce(function(t,e){return h+=16,t=g(i,t.lineOutX,n,e.lineInX,_fromItem=t,_toItem=e),a.push(t),e});var c=r[0].lineInX,l=r[r.length-1].lineOutX;return{items:a,width:h,height:e,x:t,y:o,lineInX:c,lineOutX:l}}function v(t,e,i){t.forEach(function(t){t._translate?t._translate(e,i):(t.x+=e,t.y+=i)})}function d(t,e,i,n,r,a){return{type:"group",id:t.id||"",dataset:{indices:[t.indices[0]+1,t.indices[1]-1].join(",")},class:`g:${t.type}:`+[t.indices[0]+1,t.indices[1]-1].join(";"),children:e,transform:`t${i},`+n,x:i,y:n,width:r,height:a,_translate:function(t,e){this.x+=t,this.y+=e,this.transform=`t${this.x},`+this.y}}}function _(t,e,i,n,r,a){e=c.toPrint(e);var h=l(16),s=e.length*h.width,h=h.height+12,s=12+s,r={type:"rect",class:`rect:${t.type}:`+t.indices.join(";"),x:0,y:0,width:s,height:h,stroke:"none",fill:r||"transparent"};return{text:e={type:"text",class:`text:${t.type}:`+t.indices.join(";"),x:s/2,y:h/2,text:e,"font-size":16,"font-family":x,fill:a||"black"},rect:r,items:[a=d(t,[r,e],i,n-h/2,s,h)],width:s,height:h,x:i,y:a.y,lineInX:i,lineOutX:i+s}}function k(t,e,i,n,r){var a=l(14),h=(s=n.split("\n")).length*a.height,s=1<s.length?Math.max.apply(Math,s.map(function(t){return t.length})):n.length;return s*=a.width,{label:{type:"text",class:`text:${t.type}:`+t.indices.join(";"),x:e,y:i-h/2-4,text:n,"font-size":14,"font-family":x,fill:r||"#444"},x:e-s/2,y:i-h-4,width:s,height:4+h}}function g(t,e,i,n,r=null,a=null){let h="linejoint";return null!==r&&(h=h+"::"+r.items.map(t=>t.class).join("_")),null!==a&&(h=`${h}::${a.items.map(t=>t.class).join("_")}::`),{type:"path",class:"path:"+(h=t.hasOwnProperty("indices")?"any:"+t.indices.join(";"):h),x:e,y:i,path:["M",e,i,"H",n],"stroke-linecap":"butt","stroke-linejoin":"round",stroke:"#333","stroke-width":2,_translate:function(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t}}}function f(t,e,i,n,r){var a,h=n<e?-1:1,s=r<i?-1:1,i=Math.abs(i-r)<15?(a=["M",e,i,"C",e+Math.min(Math.abs(n-e)/2,10)*h,i,n-(n-e)/2,r,n,r],function(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t,i[5]+=e,i[6]+=t,i[7]+=e,i[8]+=t,i[9]+=e}):(a=["M",e,i,"Q",e+10*h,i,e+10*h,i+10*s,"V",Math.abs(i-r)<20?i+10*s:r-10*s,"Q",e+10*h,r,e+10*h*2,r,"H",n],function(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t,i[5]+=e,i[6]+=t,i[7]+=e,i[9]+=e,i[11]+=t,i[12]+=e,i[13]+=t,i[14]+=e,i[16]+=t});return{type:"path",class:"path:curve:"+t.indices.join(";"),path:a,"stroke-linecap":"butt","stroke-linejoin":"round",stroke:"#333","stroke-width":2,_translate:i}}function m(t,e,i,n){return n={type:"circle",id:t.id,class:`circle:${t.type}:`+t.indices.join(";"),fill:n,cx:10,cy:0,r:10,stroke:"none",_translate:function(t,e){this.cx+=t,this.cy+=e}},{items:[container_group=d(t,[n],e,i,20,20)],width:container_group.width,height:container_group.height,x:e,y:i,lineInX:container_group.x,lineOutX:container_group.x+container_group.width}}function y(t){if(Array.isArray(t)){for(var e=t,i=0;i<e.length;i++)if(!y(e[i]))return!1;return!0}return t.type===EMPTY_NODE||(t.type===GROUP_NODE&&void 0===t.num?y(t.sub):t.type===CHOICE_NODE?y(t.branches):void 0)}var x="DejaVu Sans Mono,monospace",w="#e2e2e2",X=!1,b={},M={startPoint:function(t,e,i){return m({type:"startPoint",id:"startPoint",indices:[-1,-1]},e,i,I.startRegex)},endPoint:function(t,e,i){return m({type:"endPoint",id:"endPoint",indices:[1/0,1/0]},e,i,I.endRegex)},empty:function(t,e,i){return{items:[g(t,e,i,e+10)],width:10,height:2,x:e,y:i,lineInX:e,lineOutX:e+10}},exact:function(t,e,i){return _(t,t.chars,e,i,"skyblue")},dot:function(t,e,i){return(t=_(t,"AnyCharExceptNewLine",e,i,"DarkGreen","white")).rect.r=10,t.rect.tip="AnyChar except CR LF",t},backref:function(t,e,i){return(t=_(t,"Backref #"+t.num,e,i,"navy","white")).rect.r=8,t},repeat:function(t,e,i){function n(t){return t+(t<2?" time":" times")}function r(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t,i[5]+=e,i[6]+=t,i[7]+=e,i[9]+=e,i[11]+=t,i[12]+=e,i[13]+=t,i[14]+=e,i[16]+=t,i[18]+=t,i[19]+=e,i[20]+=t,i[21]+=e,i[23]+=e,i[25]+=t,i[26]+=e,i[27]+=t,i[28]+=e}if(y(t))return M.empty(t,e,i);var a=t.repeat,h="",s=[];if(a.min===a.max&&0===a.min)return M.empty(t,e,i);var o=M[t.type](t,e,i),u=o.width,c=o.height;if(a.min===a.max&&1===a.min)return o;a.min===a.max?h+=n(a.min):(h+=a.min,isFinite(a.max)?h+=(1<a.max-a.min?" to ":" or ")+n(a.max):h+=" or more times");var l,d,p=10,g=0,f=o.y+o.height-i,m=20+o.width,u=m;return 1!==a.max?(f+=10,c+=10,l={type:"path",class:"path:repeat:"+t.indices.join(";"),path:["M",o.x+10,i,"Q",e,i,e,i+10,"V",i+f-10,"Q",e,i+f,e+10,i+f,"H",e+m-10,"Q",e+m,i+f,e+m,i+f-10,"V",i+10,"Q",e+m,i,o.x+o.width+10,i],_translate:r,stroke:"maroon","stroke-width":2},a.nonGreedy&&(l.stroke="Brown",l["stroke-dasharray"]="-"),s.push(l)):h=!1,0===a.min&&(d=i-o.y+10,p+=10,g=-12,u=m+=20,c+=10,d={type:"path",class:"path:repeat:"+t.indices.join(";"),path:["M",e,i,"Q",e+10,i,e+10,i-10,"V",i-d+10,"Q",e+10,i-d,e+20,i-d,"H",e+m-20,"Q",e+m-10,i-d,e+m-10,i-d+10,"V",i-10,"Q",e+m-10,i,e+m,i],_translate:r,stroke:a.nonGreedy?"darkgreen":"#333","stroke-width":2},l&&v([l],10,0),s.push(d)),h&&(v([(m=k(t,e+u/2,i,h)).label],0,f+m.height+4),s.push(m.label),c+=4+m.height,(a=(Math.max(m.width,u)-u)/2)&&v(s,a,0),u=Math.max(m.width,u),p+=a),v(o.items,p,0),{items:s=s.concat(o.items),width:u,height:c,x:e,y:o.y+g,lineInX:o.lineInX+p,lineOutX:o.lineOutX+p}},choice:function(a,h,s){if(y(a))return M.empty(a,h,s);var e=0,o=0,t=a.branches.map(function(t){return t=p(t,h,s),e+=t.height,o=Math.max(o,t.width),t}),u=(e+=6*(t.length-1)+8,h+(o+=40)/2),c=s-e/2+4,l=h+o,d=[];return t.forEach(function(t){var e=u-t.width/2,i=(v(t.items,e-t.x,c-t.y),d=d.concat(t.items),s+c-t.y),n=f(a,h,s,h+20,i),r=f(a,l,s,h+o-20,i);d.push(n,r),h+20!==e-t.x+t.lineInX&&d.push(g(a,h+20,i,e-t.x+t.lineInX)),t.lineOutX+e-t.x!=h+o-20&&d.push(g(a,t.lineOutX+e-t.x,i,h+o-20)),t.x=e,t.y=c,c+=t.height+6}),{items:d,width:o,height:e,x:h,y:s-e/2,lineInX:h,lineOutX:l}},charset:function(e,i,n){var t,r={d:"Digit",D:"NonDigit",w:"Word",W:"NonWord",s:"WhiteSpace",S:"NonWhiteSpace"},a=e.exclude?"Pink":"Khaki",h=e.exclude?"#C00":"";if(!(t=e).chars&&!t.ranges.length&&1===t.classes.length)return(g=_(e,r[e.classes[0]],i,n,"Green","white")).rect.r=5,e.exclude?(y=k(e,g.x+g.width/2,g.y,"None of:",h),(m=g.items).push(y.label),x=g.width,c=Math.max(y.width,g.width),v(m,w=(c-x)/2,0),{items:m,width:c,height:g.height+y.height,x:Math.min(y.x,g.x),y:y.y,lineInX:w+g.x,lineOutX:w+g.x+g.width}):g;if(!e.chars&&!e.ranges.length&&!e.classes.length)return(g=_(e,"AnyChar",i,n,"green","white")).rect.r=5,g;var s,o,u=[],c=0,l=0,d=(e.chars&&((g=_(e,e.chars,i,n,"LightSkyBlue","black")).rect.r=5,u.push(g),c=g.width),e.ranges.forEach(function(t){t=t.split("").join("-"),(t=_(e,t,i,n,"teal","white")).rect.r=5,u.push(t),c=Math.max(t.width,c)}),e.classes.forEach(function(t){(t=_(e,r[t],i,n,"Green","white")).rect.r=5,u.push(t),c=Math.max(t.width,c)}),g=u[0].height,[]),p=[];for(u.sort(function(t,e){return e.width-t.width}),u.forEach(function(t){(2*t.width+4>c?d:p).push(t)}),u=d;p.length;){if(s=p.pop(),!(o=p.pop())){u.push(s);break}2<s.width-o.width?(u.push(s),p.push(o)):(v(o.items,s.width+4,0),u.push({items:s.items.concat(o.items),width:s.width+o.width+4,height:s.height,x:s.x,y:s.y}),l-=s.height)}c+=12;var l=4*(u.length-1)+u.length*g+12,g={type:"rect",class:"rect:charsetgroup:"+e.indices.join(";"),x:i,y:n-l/2,r:4,width:c,height:l,stroke:"none",fill:a},f=g.y+6,m=[g],y=k(a=(u.forEach(function(t){v(t.items,i-t.x+(c-t.width)/2,f-t.y),m=m.concat(t.items),f+=t.height+4}),{type:"charsetgroup",indices:e.indices}),g.x+g.width/2,g.y,(e.exclude?"None":"One")+" of:",h),x=(m.push(y.label),c),w=((c=Math.max(y.width,c))-x)/2;return v(m,w,0),{items:m,width:c,height:l+y.height,x:Math.min(y.x,i),y:y.y,lineInX:w+i,lineOutX:w+i+g.width}},group:function(t,e,i){if(y(t))return M.empty(t,e,i);var n,r,a,h,s,o=p(t.sub,0,0),u=d(t,o.items,0,0,o.width,o.height);return t.num?(v([u],10,0),n=o.width+20,r=o.height+20,s={type:"rect",id:t.id,indices:t.indices,class:`rect:${t.type}:`+t.indices.join(";"),x:0,y:o.y-10,r:6,width:n,height:r,"stroke-dasharray":".",stroke:"silver","stroke-width":2},a=k(t,s.width/2,s.y-2,`Group ${t.name}#`+t.num),h=Math.max(a.width,n),{items:[s=d(t,[u,s,a.label],e+(t=(h-n)/2),i,h,r+a.height+4)],width:s.width,height:s.height,x:s.x,y:s.y+a.y,lineInX:e+t+o.lineInX+10,lineOutX:e+t+o.lineOutX+10}):(v([u],e,i),{items:[u],width:u.width,height:u.height,x:e+o.x,y:i+o.y,lineInX:e+o.lineInX,lineOutX:e+o.lineOutX})},assert:function(t,e,i){var n,r=(h=t.assertionType).replace("Assert","")+"!";if(a={AssertNonWordBoundary:{bg:"maroon",fg:"white"},AssertWordBoundary:{bg:"purple",fg:"white"},AssertEnd:{bg:"Indigo",fg:"white"},AssertBegin:{bg:"Indigo",fg:"white"}}[h])return _(t,r=!X||"AssertBegin"!==h&&"AssertEnd"!==h?r:"Line"+r,e,i,a.bg,a.fg);h===AssertLookahead?(s="CornflowerBlue",n="darkgreen",r="Followed by:"):h===AssertNegativeLookahead&&(s="#F63",n="Purple",r="Not followed by:");var a=M.group(t,e,i),h=a.height+16,i=a.width+16,h={type:"rect",class:`rect:${t.type}:`+t.indices.join(";"),x:e,y:a.y-8,r:6,width:i,height:h,"stroke-dasharray":"-",stroke:s,"stroke-width":2},s=k(t,h.x+i/2,h.y,r,n),r=((t=Math.max(i,s.width))-i)/2;return v(a.items,8+r,0),r&&v([h,s.label],r,0),{items:a.items.concat([h,s.label]),width:t,height:h.height+s.height,x:e,y:s.y,lineInX:r+a.lineInX+8,lineOutX:r+a.lineOutX+8}}},I={startRegex:"#03a9f4",endRegex:"#ff0058",delimiter:"Indigo",flags:"darkgreen",exact:"#334",dot:"darkblue",backref:"teal",$:"purple","^":"purple","\\b":"#F30","\\B":"#F30","(":"blue",")":"blue","?=":"darkgreen","?!":"red","?:":"grey","[":"navy","]":"navy","|":"blue","{":"maroon",",":"maroon","}":"maroon","*":"maroon","+":"maroon","?":"maroon",repeatNonGreedy:"#F61",defaults:"black",charsetRange:"olive",charsetClass:"navy",charsetExclude:"red",charsetChars:"#534"};s.updateProgressBar(0);{o=[[["canvasRaph","regexson_tree","sizeTextItem","regexBoxRect"],(t,e,i,n)=>(e=function(t,e,i,n){(e=[...e.tree]).unshift({type:"startPoint"}),e.push({type:"endPoint"});var e=p(e,0,0),r=Math.max(e.height+30+i.height,0),a=Math.max(e.width+20,0);return t.setSize(a,r),n.attr("width",a),n.attr("height",r),v(e.items,10,20+i.height-e.y),e}(t,e,i,n),s.updateProgressBar(40),[e,t]),["raphael_items","canvasRaph"]],[[],()=>{u.remove(),s.updateProgressBar(60)},[]],[["canvasRaph","raphael_items"],(t,e)=>(t.addv2(e.items),s.updateProgressBar(80),t),["canvasRaph"]],[["canvasRaph"],t=>{let e=Array.from(t.canvas.childNodes);e.forEach(t=>{t!==a&&h.appendChild(t)}),s.updateProgressBar(100)},[]],[[],o,[]]];class E{constructor(t,e,i){this.callback=t,this.inputs=e,this.outputs=i}run(e){let t=[];for(var i of this.inputs.args_names)t.push(e[i]);var n,n=this.callback,r=function(){var t=Array.prototype.slice.call(arguments)[0];return n.apply(0,t)}(t);if(0!==this.outputs.args_names.length&&(1===this.outputs.args_names.length&&(e[this.outputs.args_names[0]]=r),1<this.outputs.args_names.length))for(let t=0;t<this.outputs.args_names.length;t++)e[this.outputs.args_names[t]]=r[t];return e}}class P{constructor(t){for(var e of t)this[e]=void 0;this.args_names=t}}var[O,j]=function(t,e){let i=[],n=(t.forEach(t=>{i.push(t)}),i.forEach(t=>t.remove()),t.rect(0,0,0,0));return n.attr("fill",w),n.attr("stroke",w),u=t.text(-1e3,-1e3,"XgfTlM|.q\nXgfTlM|.q").attr({"font-family":x,"font-size":16}),t=l(16,"bold"),X=!!~e.indexOf("m"),[n,t]}(r,n);let t=Array.from(r.canvas.childNodes),e=(t.forEach(t=>{t!==a&&h.appendChild(t)}),s.updateProgressBar(10),new class{constructor(t,e){this.runtime_vars=e||{},this.execution_plan=this.process_plan(t)}process_plan(t){let e=[];for(var i of t)e.push(new E(i[1],new P(i[0]),new P(i[2])));return e}run(){for(var t of this.execution_plan)this.runtime_vars=t.run(this.runtime_vars)}run_iterative(){var n=this.runtime_vars;for(let t=0;t<this.execution_plan.length;t++)!function(t,e){let i=e[t];window.setTimeout(function(){n=i.run(n)},20*t+500)}(t,this.execution_plan)}run_recursive(){var i=this;window.setTimeout(function t(e){return function(){i.runtime_vars=i.execution_plan[e].run(i.runtime_vars),e<i.execution_plan.length-1&&window.setTimeout(t(e+1),0)}}(0),0)}}(o,{regexBoxRect:O,sizeTextItem:j,canvasRaph:r,regex_flags:n,regexson_tree:i}));return e.run_recursive(),e.runtime_vars.raphael_items}}