function RegexVisualizer(t,e,i,n){var r,o=Kit();function c(t,e){if(e=e||"normal",b[t]&&b[t][e])return b[t][e];r.attr({"font-size":t,"font-weight":e});var i=r.getBBox();return b[t]=b[t]||{},b[t][e]={width:i.width/((r.attr("text").length-1)/2),height:i.height/2}}function p(i,t,n){var e,r=[],h=[],a=0,s=t,o=n,c=n;if(!i.length)return M.empty(i,t,n);i.forEach(function(t){t=t.repeat?M.repeat(t,s,n):M[t.type](t,s,n),r.push(t),s+=t.width+16,a+=t.width,o=Math.min(o,t.y),c=Math.max(c,t.y+t.height),h=h.concat(t.items)}),e=c-o,r.reduce(function(t,e){return a+=16,t=g(i,t.lineOutX,n,e.lineInX,_fromItem=t,_toItem=e),h.push(t),e});var u=r[0].lineInX,l=r[r.length-1].lineOutX;return{items:h,width:a,height:e,x:t,y:o,lineInX:u,lineOutX:l}}function k(t,e,i){t.forEach(function(t){t._translate?t._translate(e,i):(t.x+=e,t.y+=i)})}function u(t,e,i,n,r,h){return{type:"group",id:t.id||"",indices:[t.indices[0]+1,t.indices[1]-1],class:`g:${t.type}:`+[t.indices[0]+1,t.indices[1]-1].join(";"),children:e,transform:`t${i},`+n,x:i,y:n,width:r,height:h,_translate:function(t,e){this.x+=t,this.y+=e,this.transform=`t${this.x},`+this.y}}}function v(t,e,i,n,r,h){e=o.toPrint(e);var a=c(16),s=e.length*a.width,a=a.height+12,s=12+s,r={type:"rect",class:`rect:${t.type}:`+t.indices.join(";"),x:0,y:0,width:s,height:a,stroke:"none",fill:r||"transparent"};return{text:e={type:"text",class:`text:${t.type}:`+t.indices.join(";"),x:s/2,y:a/2,text:e,"font-size":16,"font-family":f,fill:h||"black"},rect:r,items:[h=u(t,[r,e],i,n-a/2,s,a)],width:s,height:a,x:i,y:h.y,lineInX:i,lineOutX:i+s}}function X(t,e,i,n,r){var h=c(14),a=(s=n.split("\n")).length*h.height,s=1<s.length?Math.max.apply(Math,s.map(function(t){return t.length})):n.length;return s*=h.width,{label:{type:"text",class:`text:${t.type}:`+t.indices.join(";"),x:e,y:i-a/2-4,text:n,"font-size":14,"font-family":f,fill:r||"#444"},x:e-s/2,y:i-a-4,width:s,height:4+a}}function g(t,e,i,n,r=null,h=null){let a="linejoint";return null!==r&&(a=a+"::"+r.items.map(t=>t.class).join("_")),null!==h&&(a=`${a}::${h.items.map(t=>t.class).join("_")}::`),{type:"path",class:"path:"+(a=t.hasOwnProperty("indices")?"curve:"+t.indices.join(";"):a),x:e,y:i,path:["M",e,i,"H",n],"stroke-linecap":"butt","stroke-linejoin":"round",stroke:"#333","stroke-width":2,_translate:function(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t}}}function y(t,e,i,n,r){var h,a=n<e?-1:1,s=r<i?-1:1,i=Math.abs(i-r)<15?(h=["M",e,i,"C",e+Math.min(Math.abs(n-e)/2,10)*a,i,n-(n-e)/2,r,n,r],function(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t,i[5]+=e,i[6]+=t,i[7]+=e,i[8]+=t,i[9]+=e}):(h=["M",e,i,"Q",e+10*a,i,e+10*a,i+10*s,"V",Math.abs(i-r)<20?i+10*s:r-10*s,"Q",e+10*a,r,e+10*a*2,r,"H",n],function(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t,i[5]+=e,i[6]+=t,i[7]+=e,i[9]+=e,i[11]+=t,i[12]+=e,i[13]+=t,i[14]+=e,i[16]+=t});return{type:"path",class:"path:curve:"+t.indices.join(";"),path:h,"stroke-linecap":"butt","stroke-linejoin":"round",stroke:"#333","stroke-width":2,_translate:i}}function h(t,e,i,n){return n={type:"circle",id:t.id,class:`circle:${t.type}:`+t.indices.join(";"),fill:n,cx:10,cy:0,r:10,stroke:"none",_translate:function(t,e){this.cx+=t,this.cy+=e}},{items:[container_group=u(t,[n],e,i,20,20)],width:container_group.width,height:container_group.height,x:e,y:i,lineInX:container_group.x,lineOutX:container_group.x+container_group.width}}function m(t){if(Array.isArray(t)){for(var e=t,i=0;i<e.length;i++)if(!m(e[i]))return!1;return!0}return t.type===EMPTY_NODE||(t.type===GROUP_NODE&&void 0===t.num?m(t.sub):t.type===CHOICE_NODE?m(t.branches):void 0)}var a,s,l,d,f="DejaVu Sans Mono,monospace",x="#e2e2e2",w=!1,b={},M={startPoint:function(t,e,i){return h({type:"startPoint",id:"startPoint",indices:[-1,-1]},e,i,O.startRegex)},endPoint:function(t,e,i){return h({type:"endPoint",id:"endPoint",indices:[1/0,1/0]},e,i,O.endRegex)},empty:function(t,e,i){return{items:[g(t,e,i,e+10)],width:10,height:2,x:e,y:i,lineInX:e,lineOutX:e+10}},exact:function(t,e,i){return v(t,t.chars,e,i,"skyblue")},dot:function(t,e,i){return(t=v(t,"AnyCharExceptNewLine",e,i,"DarkGreen","white")).rect.r=10,t.rect.tip="AnyChar except CR LF",t},backref:function(t,e,i){return(t=v(t,"Backref #"+t.num,e,i,"navy","white")).rect.r=8,t},repeat:function(t,e,i){function n(t){return t+(t<2?" time":" times")}function r(t,e){var i=this.path;i[1]+=t,i[2]+=e,i[4]+=t,i[5]+=e,i[6]+=t,i[7]+=e,i[9]+=e,i[11]+=t,i[12]+=e,i[13]+=t,i[14]+=e,i[16]+=t,i[18]+=t,i[19]+=e,i[20]+=t,i[21]+=e,i[23]+=e,i[25]+=t,i[26]+=e,i[27]+=t,i[28]+=e}if(m(t))return M.empty(t,e,i);var h=t.repeat,a="",s=[];if(h.min===h.max&&0===h.min)return M.empty(t,e,i);var o=M[t.type](t,e,i),c=o.width,u=o.height;if(h.min===h.max&&1===h.min)return o;h.min===h.max?a+=n(h.min):(a+=h.min,isFinite(h.max)?a+=(1<h.max-h.min?" to ":" or ")+n(h.max):a+=" or more times");var l,d,p=10,g=0,y=o.y+o.height-i,f=20+o.width,c=f;return 1!==h.max?(y+=10,u+=10,l={type:"path",class:"path:curve:"+t.indices.join(";"),path:["M",o.x+10,i,"Q",e,i,e,i+10,"V",i+y-10,"Q",e,i+y,e+10,i+y,"H",e+f-10,"Q",e+f,i+y,e+f,i+y-10,"V",i+10,"Q",e+f,i,o.x+o.width+10,i],_translate:r,stroke:"maroon","stroke-width":2},h.nonGreedy&&(l.stroke="Brown",l["stroke-dasharray"]="-"),s.push(l)):a=!1,0===h.min&&(d=i-o.y+10,p+=10,g=-12,c=f+=20,u+=10,d={type:"path",class:"path:curve:"+t.indices.join(";"),path:["M",e,i,"Q",e+10,i,e+10,i-10,"V",i-d+10,"Q",e+10,i-d,e+20,i-d,"H",e+f-20,"Q",e+f-10,i-d,e+f-10,i-d+10,"V",i-10,"Q",e+f-10,i,e+f,i],_translate:r,stroke:h.nonGreedy?"darkgreen":"#333","stroke-width":2},l&&k([l],10,0),s.push(d)),a&&(k([(f=X(t,e+c/2,i,a)).label],0,y+f.height+4),s.push(f.label),u+=4+f.height,(h=(Math.max(f.width,c)-c)/2)&&k(s,h,0),c=Math.max(f.width,c),p+=h),k(o.items,p,0),{items:s=s.concat(o.items),width:c,height:u,x:e,y:o.y+g,lineInX:o.lineInX+p,lineOutX:o.lineOutX+p}},choice:function(h,a,s){if(m(h))return M.empty(h,a,s);var e=0,o=0,t=h.branches.map(function(t){return t=p(t,a,s),e+=t.height,o=Math.max(o,t.width),t}),c=(e+=6*(t.length-1)+8,a+(o+=40)/2),u=s-e/2+4,l=a+o,d=[];return t.forEach(function(t){var e=c-t.width/2,i=(k(t.items,e-t.x,u-t.y),d=d.concat(t.items),s+u-t.y),n=y(h,a,s,a+20,i),r=y(h,l,s,a+o-20,i);d.push(n,r),a+20!==e-t.x+t.lineInX&&d.push(g(h,a+20,i,e-t.x+t.lineInX)),t.lineOutX+e-t.x!=a+o-20&&d.push(g(h,t.lineOutX+e-t.x,i,a+o-20)),t.x=e,t.y=u,u+=t.height+6}),{items:d,width:o,height:e,x:a,y:s-e/2,lineInX:a,lineOutX:l}},charset:function(e,i,n){var t,r={d:"Digit",D:"NonDigit",w:"Word",W:"NonWord",s:"WhiteSpace",S:"NonWhiteSpace"},h=e.exclude?"Pink":"Khaki",a=e.exclude?"#C00":"";if(!(t=e).chars&&!t.ranges.length&&1===t.classes.length)return(g=v(e,r[e.classes[0]],i,n,"Green","white")).rect.r=5,e.exclude?(m=X(e,g.x+g.width/2,g.y,"None of:",a),(f=g.items).push(m.label),x=g.width,u=Math.max(m.width,g.width),k(f,w=(u-x)/2,0),{items:f,width:u,height:g.height+m.height,x:Math.min(m.x,g.x),y:m.y,lineInX:w+g.x,lineOutX:w+g.x+g.width}):g;if(!e.chars&&!e.ranges.length&&!e.classes.length)return(g=v(e,"AnyChar",i,n,"green","white")).rect.r=5,g;var s,o,c=[],u=0,l=0,d=(e.chars&&((g=v(e,e.chars,i,n,"LightSkyBlue","black")).rect.r=5,c.push(g),u=g.width),e.ranges.forEach(function(t){t=t.split("").join("-"),(t=v(e,t,i,n,"teal","white")).rect.r=5,c.push(t),u=Math.max(t.width,u)}),e.classes.forEach(function(t){(t=v(e,r[t],i,n,"Green","white")).rect.r=5,c.push(t),u=Math.max(t.width,u)}),g=c[0].height,[]),p=[];for(c.sort(function(t,e){return e.width-t.width}),c.forEach(function(t){(2*t.width+4>u?d:p).push(t)}),c=d;p.length;){if(s=p.pop(),!(o=p.pop())){c.push(s);break}2<s.width-o.width?(c.push(s),p.push(o)):(k(o.items,s.width+4,0),c.push({items:s.items.concat(o.items),width:s.width+o.width+4,height:s.height,x:s.x,y:s.y}),l-=s.height)}u+=12;var l=4*(c.length-1)+c.length*g+12,g={type:"rect",class:"rect:charsetgroup:"+e.indices.join(";"),x:i,y:n-l/2,r:4,width:u,height:l,stroke:"none",fill:h},y=g.y+6,f=[g];c.forEach(function(t){k(t.items,i-t.x+(u-t.width)/2,y-t.y),f=f.concat(t.items),y+=t.height+4});var m=X({type:"charsetgroup",indices:e.indices},g.x+g.width/2,g.y,(e.exclude?"None":"One")+" of:",a),x=(f.push(m.label),u),w=((u=Math.max(m.width,u))-x)/2;return k(f,w,0),{items:f,width:u,height:l+m.height,x:Math.min(m.x,i),y:m.y,lineInX:w+i,lineOutX:w+i+g.width}},group:function(t,e,i){if(m(t))return M.empty(t,e,i);var n,r,h,a,s,o=p(t.sub,0,0),c=u(t,o.items,0,0,o.width,o.height);return t.num?(k([c],10,0),n=o.width+20,r=o.height+20,s={type:"rect",id:t.id,indices:t.indices,class:`rect:${t.type}:`+t.indices.join(";"),x:0,y:o.y-10,r:6,width:n,height:r,"stroke-dasharray":".",stroke:"silver","stroke-width":2},h=X(t,s.width/2,s.y-2,`Group ${t.name}#`+t.num),a=Math.max(h.width,n),{items:[s=u(t,[c,s,h.label],e+(t=(a-n)/2),i,a,r+h.height+4)],width:s.width,height:s.height,x:s.x,y:s.y+h.y,lineInX:e+t+o.lineInX+10,lineOutX:e+t+o.lineOutX+10}):(k([c],e,i),{items:[c],width:c.width,height:c.height,x:e+o.x,y:i+o.y,lineInX:e+o.lineInX,lineOutX:e+o.lineOutX})},assert:function(t,e,i){var n,r=(a=t.assertionType).replace("Assert","")+"!";if(h={AssertNonWordBoundary:{bg:"maroon",fg:"white"},AssertWordBoundary:{bg:"purple",fg:"white"},AssertEnd:{bg:"Indigo",fg:"white"},AssertBegin:{bg:"Indigo",fg:"white"}}[a])return v(t,r=!w||"AssertBegin"!==a&&"AssertEnd"!==a?r:"Line"+r,e,i,h.bg,h.fg);a===AssertLookahead?(s="CornflowerBlue",n="darkgreen",r="Followed by:"):a===AssertNegativeLookahead&&(s="#F63",n="Purple",r="Not followed by:");var h=M.group(t,e,i),a=h.height+16,i=h.width+16,a={type:"rect",class:`rect:${t.type}:`+t.indices.join(";"),x:e,y:h.y-8,r:6,width:i,height:a,"stroke-dasharray":"-",stroke:s,"stroke-width":2},s=X(t,a.x+i/2,a.y,r,n),r=((t=Math.max(i,s.width))-i)/2;return k(h.items,8+r,0),r&&k([a,s.label],r,0),{items:h.items.concat([a,s.label]),width:t,height:a.height+s.height,x:e,y:s.y,lineInX:r+h.lineInX+8,lineOutX:r+h.lineOutX+8}}},O={startRegex:"#03a9f4",endRegex:"#ff0058",delimiter:"Indigo",flags:"darkgreen",exact:"#334",dot:"darkblue",backref:"teal",$:"purple","^":"purple","\\b":"#F30","\\B":"#F30","(":"blue",")":"blue","?=":"darkgreen","?!":"red","?:":"grey","[":"navy","]":"navy","|":"blue","{":"maroon",",":"maroon","}":"maroon","*":"maroon","+":"maroon","?":"maroon",repeatNonGreedy:"#F61",defaults:"black",charsetRange:"olive",charsetClass:"navy",charsetExclude:"red",charsetChars:"#534"},[e,I]=function(t,e){t.clear(),t.setSize(0,0);let i=t.rect(0,0,0,0),n=(i.attr("fill",x),i.attr("stroke",x),r=t.text(-1e3,-1e3,"XgfTlM|.q\nXgfTlM|.q").attr({"font-family":f,"font-size":16}),c(16,"bold"));return w=!!~e.indexOf("m"),[i,n]}(i,e),t=(n.updateProgressBar(10),a=i,I=I,e=e,(d=[...(s=t).tree]).unshift({type:"startPoint"}),d.push({type:"endPoint"}),s=p(d,0,0),d=Math.max(s.height+30+I.height,0),l=Math.max(s.width+20,0),a.setSize(l,d),e.attr("width",l),e.attr("height",d),k(s.items,10,20+I.height-s.y),s);return n.updateProgressBar(50),r.remove(),n.updateProgressBar(60),i.addv2(t.items),n.updateProgressBar(100),t}