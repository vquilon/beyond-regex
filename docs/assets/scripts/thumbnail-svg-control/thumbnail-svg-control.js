var ThumbnailSVGControl=function(s){var m,v=!0,d={pan:!1,zoom:!1},u=document.getElementById(s.mainViewId),h=document.getElementById(s.mainSVGId),c=document.getElementById(s.thumbSVGId);const t="scopeContainer",p="control-panel";var g,C,S,L,y,o=!1;s.thumbContainerId;let l=.2,a={pan:{x:0,y:0},zoom:0};var i=[],r=EventTarget.prototype.addEventListener;EventTarget.prototype.addEventListener=function(e,t,n){null==n&&(n=!1),this._addEventListener_original=r,this._addEventListener_original(e,t,n),this.eventListenerList||(this.eventListenerList={},i.push(this)),this.eventListenerList[e]||(this.eventListenerList[e]=[]),this.eventListenerList[e].push({listener:t,options:n})};var I,f,E,b,x,w,e,n,D,Z=EventTarget.prototype.removeEventListener;function z(e,t,n){let i=document.createElement(t);return i.id=n,i.appendChild(e),i}function A(e,t,n,i){return n*(e/i)+t}function N(e,t,n,i){if(d.pan){if(0===n)return e.intervalPanID&&(clearInterval(e.intervalPanID),e.intervalPanID=null),void e.pan(t);e.intervalPanID&&(clearInterval(e.intervalPanID),e.intervalPanID=null);var i=(i=i||60)*(n=n||.5),o=n/i,l=0,a=e.getPan(),r=e.getPan();t.x,a.x,t.y,a.y;e.intervalPanID=setInterval(function(){l+=o,r.x=A(l,a.x,t.x-a.x,n),r.y=A(l,a.y,t.y-a.y,n),l<n?e.pan(r):(clearInterval(e.intervalPanID),e.intervalPanID=null)},o)}else e.pan(t)}function P(e,t,n,i,o=void 0){if(d.zoom){if(0===n)return e.intervalZoomID&&(clearInterval(e.intervalZoomID),e.intervalZoomID=null),void e.zoom(t);e.intervalZoomID&&(clearInterval(e.intervalZoomID),e.intervalZoomID=null);var i=(i=i||60)*(n=n||.5),l=n/i,a=0,r=e.getZoom(),s=r;e.intervalZoomID=setInterval(function(){s=A(a+=l,r,t-r,n),Math.abs(t-r)<.001&&(s=t,e.zoom(s),clearInterval(e.intervalZoomID),e.intervalZoomID=null,o&&o()),a<n?e.zoom(s):(clearInterval(e.intervalZoomID),e.intervalZoomID=null,o&&o())},l)}else e.zoom(t)}EventTarget.prototype.removeEventListener=function(t,e,n){null==n&&(n=!1),this._removeEventListener_original=Z,this._removeEventListener_original(t,e,n),this.eventListenerList||(this.eventListenerList={}),this.eventListenerList[t]||(this.eventListenerList[t]=[]);for(let e=0;e<this.eventListenerList[t].length;e++)if(this.eventListenerList[t][e].listener,this.eventListenerList[t][e].options==n){this.eventListenerList[t].splice(e,1);break}0==this.eventListenerList[t].length&&(delete this.eventListenerList[t],i.splice(i.indexOf(this),1))},EventTarget.prototype.removeAllEventListener=function(){Object.keys(this.eventListenerList).forEach(e=>{for(;0<this.eventListenerList[e].length;){var t=this.eventListenerList[e][0].listener,n=this.eventListenerList[e][0].options;if(this.removeEventListener(e,t,n),!(e in this.eventListenerList))break}})};function $(){var e=V(h);s.onMainViewSVGLoaded&&s.onMainViewSVGLoaded(e);let t=document.createElementNS("http://www.w3.org/2000/svg","g"),n=document.createElementNS("http://www.w3.org/2000/svg","g");t.id="mainSVGContainer",n.id="mainSVGViewPort";let i=[...h.childNodes];return i.forEach(function(e){t.appendChild(e)}),n.appendChild(t),h.appendChild(n),svgPanZoom("#"+s.mainSVGId,{zoomEnabled:!0,controlIconsEnabled:!1,fit:!0,center:!0,beforeZoom:function(e,t){return v=!0},preventMouseEventsDefault:!0,mouseWheelZoomEnabled:!1,zoomScaleSensitivity:l,customEventsHandler:{haltEventListeners:["wheel"],init:function(e){var t="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";D=function(t){let n=L;if(n.isZoomEnabled()){t.preventDefault();var i=t.deltaY||1,o=Date.now()-n.lastMouseWheelEventTime,l=3+Math.max(0,30-o);n.lastMouseWheelEventTime=Date.now();var i=-.3<(i="deltaMode"in t&&0===t.deltaMode&&t.wheelDelta?0===t.deltaY?0:Math.abs(t.wheelDelta)/t.deltaY:i)&&i<.3?i:(0<i?1:-1)*Math.log(Math.abs(i)+10)/l,a=h.getScreenCTM().inverse(),r=h.createSVGPoint(),s=m.getBoundingClientRect(),c=L.getSizes().realZoom,o=(y.getSizes().width,y.getSizes().height,y.getSizes().realZoom),l=h.getBoundingClientRect();let e={x:l.x+l.width/2,y:l.y+l.height/2};this===h?(r.x=t.clientX,r.y=t.clientY,e=r.matrixTransform(a)):this===g&&(l=t.clientX,t=t.clientY,l=l-(s.left+s.width/2),s=(t-(s.top+s.height/2))*c/o,r.x=l*c/o,r.y=s,e=r.matrixTransform(a));i=Math.pow(1+n.zoomScaleSensitivity,-1*i);!function(e,t,n,i,o){if(d.zoom){if(0===i)return e.intervalZoomID&&(clearInterval(e.intervalZoomID),e.intervalZoomID=null),e.zoomAtPoint(e.getZoom()*t,n);e.intervalZoomID&&(clearInterval(e.intervalZoomID),e.intervalZoomID=null);var l,o=(o=o||60)*(i=i||.5),a=i/o,r=0,s=e.getZoom(),c=s*t;e.intervalZoomID=setInterval(function(){l=A(r+=a,s,c-s,i),r<i?e.zoomAtPoint(l,n):(clearInterval(e.intervalZoomID),e.intervalZoomID=null)},a)}else e.zoomAtPointBy(t,n)}(n,i,e,animationTime=.2)}},h.eventListenerList=[],u.eventListenerList=[],e.svgElement.eventListenerList=[],e.svgElement.addEventListener(t,D)},destroy:function(e){L.intervalZoomID&&(clearInterval(L.intervalZoomID),L.intervalZoomID=null),L.intervalPanID&&(clearInterval(L.intervalPanID),L.intervalPanID=null),e.svgElement.removeAllEventListener(),u.removeAllEventListener(),B.unobserve(u),h.removeAllEventListener();let t=document.querySelector("#zoom-in"),n=document.querySelector("#zoom-out"),i=document.querySelector("#zoom-reset");t.removeEventListener("click",E),n.removeEventListener("click",f),i.removeEventListener("click",I)}}})}function M(){var e=V(c);return s.onThumbnailSVGLoaded&&s.onThumbnailSVGLoaded(e),e=svgPanZoom(`#${c.id}`,{zoomEnabled:!0,panEnabled:!1,controlIconsEnabled:!1,dblClickZoomEnabled:!1,preventMouseEventsDefault:!1,customEventsHandler:{init:function(e){var t="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";c.eventListenerList=[],g.eventListenerList=[],g.addEventListener(t,D)},destroy:function(e){y.intervalZoomID&&(clearInterval(y.intervalZoomID),y.intervalZoomID=null),y.intervalPanID&&(clearInterval(y.intervalPanID),y.intervalPanID=null),c.removeAllEventListener(),g.removeAllEventListener(),m.removeAllEventListener()}}}),m=document.getElementById(t),e}var V=function(e){var t=e.contentDocument;return t||"function"==typeof e.getSVGDocument&&(t=e.getSVGDocument()),t};!function(){g=document.getElementById(s.thumbContainerId);var d="http://www.w3.org/2000/svg",e=document.createElementNS(d,"rect");e.id="scope",e.setAttributeNS(null,"x","0"),e.setAttributeNS(null,"y","0"),e.setAttributeNS(null,"height","0"),e.setAttributeNS(null,"width","0"),e.setAttributeNS(null,"fill","#ff00ff"),e.setAttributeNS(null,"fill-opacity","0.4"),e.setAttributeNS(null,"stroke","none");var t=document.createElementNS(d,"line");t.id="line1",t.setAttributeNS(null,"stroke","none"),t.setAttributeNS(null,"x1","0"),t.setAttributeNS(null,"y1","0"),t.setAttributeNS(null,"x2","0"),t.setAttributeNS(null,"y2","0");var n=document.createElementNS(d,"line");n.id="line2",n.setAttributeNS(null,"stroke","none"),n.setAttributeNS(null,"x1","0"),n.setAttributeNS(null,"y1","0"),n.setAttributeNS(null,"x2","0"),n.setAttributeNS(null,"y2","0");var i=document.createElementNS(d,"g");i.appendChild(e),i.appendChild(t),i.appendChild(n);t=document.createElementNS(d,"svg");t.id="scopeContainer",t.classList.add("thumbViewClass"),t.appendChild(i),c=document.createElementNS(d,"svg");let o=document.createElementNS(d,"use");o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#mainSVGContainer"),c.style="",c.id="thumbSVG",c.appendChild(o);n=z(c,newWrapType="div",newWrapId="thumbView");n.classList.add("thumbViewClass");let l=document.createElement("div");l.id="masked",g?(g.appendChild(l),g.appendChild(t)):(g=z(l,newWrapType="div",newWrapId="thumbViewContainer")).appendChild(t),g.appendChild(n);let a=document.createElement("div");a.classList.add("control-zoom");i=function(e,t){let n=document.createElementNS(d,"svg"),i=document.createElementNS(d,"g");n.classList.add("lens"),i.classList.add("main");let o=document.createElementNS(d,"circle"),l=document.createElementNS(d,"clipPath"),a=document.createElementNS(d,"g");o.setAttributeNS(null,"r","100%"),o.setAttributeNS(null,"cx","50%"),o.setAttributeNS(null,"cy","50%"),o.setAttributeNS(null,"style",`clip-path: url(#clip-${t});opacity: 0.6; fill: black;`),l.id=`clip-${t}`,a.classList.add("gradient");let r=document.createElement("div");r.id=t,r.classList.add("icon");let s=document.createElementNS(d,"path");s.setAttributeNS(null,"d",e);let c=document.createElementNS(d,"path");return c.setAttributeNS(null,"d",e),c.style.transform="translate(-35%, -35%) scale(0.06)",c.style.transformOrigin="center",l.appendChild(c),a.appendChild(s),i.appendChild(a),i.style.transform="translate(-35%, -35%) scale(0.06)",i.style.transformOrigin="center",n.appendChild(o),n.appendChild(l),n.appendChild(i),r.appendChild(n),r},t=i("M 420.67 210.335 C 420.67 257.269 405.298 300.613 379.313 335.606 L 502.948 459.241 C 515.017 471.31 515.017 490.879 502.948 502.948 C 490.879 515.017 471.31 515.017 459.241 502.948 L 335.606 379.313 C 300.613 405.298 257.269 420.67 210.335 420.67 C 94.17 420.67 0 326.5 0 210.335 C 0 94.17 94.17 0 210.335 0 C 326.5 0 420.67 94.17 420.67 210.335 Z M 323.979 185.927 L 239.965 185.927 C 237.236 185.927 235.022 183.715 235.022 180.986 L 235.022 96.971 C 235.022 83.325 223.959 72.261 210.312 72.261 C 196.666 72.261 185.602 83.325 185.602 96.971 L 185.602 180.986 C 185.602 183.715 183.39 185.927 180.661 185.927 L 96.646 185.927 C 83 185.927 71.936 196.991 71.936 210.637 C 71.936 224.284 83 235.349 96.646 235.349 L 180.661 235.349 C 183.39 235.349 185.602 237.561 185.602 240.29 L 185.602 324.305 C 185.602 337.951 196.666 349.015 210.312 349.015 C 223.959 349.015 235.022 337.951 235.022 324.305 L 235.022 240.29 C 235.022 237.561 237.236 235.349 239.965 235.349 L 323.979 235.349 C 337.625 235.349 348.69 224.284 348.69 210.637 C 348.69 196.991 337.625 185.927 323.979 185.927 Z","zoom-in"),n=i("M 420.67 210.335 C 420.67 257.269 405.298 300.613 379.313 335.606 L 502.948 459.241 C 515.017 471.31 515.017 490.879 502.948 502.948 C 490.879 515.017 471.31 515.017 459.241 502.948 L 335.606 379.313 C 300.613 405.298 257.269 420.67 210.335 420.67 C 94.17 420.67 0 326.5 0 210.335 C 0 94.17 94.17 0 210.335 0 C 326.5 0 420.67 94.17 420.67 210.335 Z M 323.979 185.927 L 96.646 185.927 C 83 185.927 71.936 196.991 71.936 210.637 C 71.936 224.284 83 235.349 96.646 235.349 L 323.979 235.349 C 337.625 235.349 348.69 224.284 348.69 210.637 C 348.69 196.991 337.625 185.927 323.979 185.927 Z","zoom-out"),i=i("M 420.67 210.335 C 420.67 257.269 405.298 300.613 379.313 335.606 L 502.948 459.241 C 515.017 471.31 515.017 490.879 502.948 502.948 C 490.879 515.017 471.31 515.017 459.241 502.948 L 335.606 379.313 C 300.613 405.298 257.269 420.67 210.335 420.67 C 94.17 420.67 0 326.5 0 210.335 C 0 94.17 94.17 0 210.335 0 C 326.5 0 420.67 94.17 420.67 210.335 Z M 348.273 94.961 C 338.364 94.961 330.333 102.994 330.333 112.902 L 330.333 141.72 C 319.644 123.116 304.763 107.22 286.708 95.246 C 264.036 80.21 237.619 72.261 210.313 72.261 C 191.639 72.261 173.515 75.923 156.445 83.144 C 139.964 90.114 125.167 100.088 112.465 112.791 C 99.763 125.494 89.788 140.291 82.817 156.77 C 75.597 173.842 71.936 191.966 71.936 210.638 C 71.936 229.311 75.597 247.435 82.817 264.506 C 89.788 280.987 99.764 295.783 112.465 308.485 C 125.168 321.188 139.965 331.163 156.445 338.134 C 173.515 345.354 191.64 349.015 210.313 349.015 C 226.259 349.015 241.899 346.322 256.798 341.009 C 271.197 335.874 284.579 328.416 296.574 318.845 C 308.449 309.366 318.628 298.085 326.828 285.314 C 335.181 272.303 341.246 258.105 344.853 243.113 C 347.171 233.48 341.242 223.791 331.608 221.473 C 321.973 219.155 312.285 225.085 309.967 234.719 C 304.682 256.689 291.976 276.605 274.19 290.799 C 265.306 297.891 255.399 303.413 244.747 307.211 C 233.726 311.141 222.141 313.134 210.313 313.134 C 182.936 313.134 157.196 302.472 137.838 283.113 C 118.479 263.754 107.817 238.015 107.817 210.637 C 107.817 183.261 118.479 157.521 137.838 138.163 C 157.197 118.804 182.936 108.142 210.313 108.142 C 230.542 108.142 250.102 114.022 266.876 125.148 C 281.332 134.735 293.04 147.704 301.051 162.925 L 281.223 162.925 C 271.314 162.925 263.282 170.957 263.282 180.865 C 263.282 190.774 271.314 198.806 281.223 198.806 L 348.273 198.806 C 358.182 198.806 366.214 190.774 366.214 180.865 L 366.214 112.902 C 366.214 102.994 358.182 94.961 348.273 94.961 Z","zoom-reset");a.appendChild(t),a.appendChild(n),a.appendChild(i);let r=document.createElement("div");r.classList.add(p),r.appendChild(g),r.appendChild(a),n=u,i=r,n.parentNode.insertBefore(i,n.nextSibling)}(),n=function(e){L=$()},e=function(e){y=M()},h.addEventListener("load",n,!1),c.addEventListener("load",e,!1),L=$(),y=M(),function(e,t){if(!y&&t&&(y=t),(L=!L&&e?e:L)&&y){L.setOnZoom(function(e){y.updateThumbScope()}),L.setOnPan(function(e){y.updateThumbScope()}),L.setZoomScaleSensitivityAux=function(e){L.zoomScaleSensitivity=e,L.setZoomScaleSensitivity(e)};y.updateThumbScope=function(){var e,t,n,i,o,l,a=document.getElementById("scope"),r=document.getElementById("line1"),s=document.getElementById("line2");u=y,t=a,n=r,c=s,i=(e=L).getPan().x,o=e.getPan().y,l=e.getSizes().width,a=e.getSizes().height,r=e.getSizes().realZoom,s=u.getPan().x,e=u.getPan().y,r=u.getSizes().realZoom/r,i=s-i*r,o=e-o*r,l*=r,r*=a,t.setAttribute("x",i),t.setAttribute("y",o),t.setAttribute("width",l),t.setAttribute("height",r),n.setAttribute("x1",1+i),n.setAttribute("y1",1+o),n.setAttribute("x2",1+i+l-2),n.setAttribute("y2",1+o+r-2),c.setAttribute("x1",1+i),c.setAttribute("y1",1+o+r-2),c.setAttribute("x2",1+i+l-2),c.setAttribute("y2",1+o),v&&(r=(n=document.querySelector("#scope").getBoundingClientRect()).x+n.width/2,l=n.y+n.height/2,c=m.getBoundingClientRect(),n=u.getSizes().width,u=u.getSizes().height,C=i-(s+(r-c.left-n/2)),S=o-(e+(l-c.top-u/2)),v=!1);var c=document.querySelector("#scope").getBBox();let d=document.querySelector("#masked");c.x,c.y,c.width,c.height,c.x,c.y,c.width,c.height;var u="linear-gradient(to top,"+` transparent calc(100% - ${c.y}px),`+` white calc(100% - ${c.y}px)`+"),linear-gradient(to bottom,"+` transparent calc(${c.y}px + ${c.height}px),`+` white calc(${c.y}px + ${c.height}px)`+"),linear-gradient(to left,"+` transparent calc(100% - ${c.x}px),`+` white calc(100% - ${c.x}px)`+"),linear-gradient(to right,"+` transparent calc(${c.x}px + ${c.width}px),`+` white calc(${c.x}px + ${c.width}px)`+")",c="polygon(0% 0%, 0% 100%, "+`${c.x}px 100%, `+`${c.x}px ${c.y}px, `+`calc(${c.x}px + ${c.width}px) ${c.y}px, `+`calc(${c.x}px + ${c.width}px) calc(${c.y}px + ${c.height}px), `+`${c.x}px calc(${c.y}px + ${c.height}px), `+`${c.x}px 100%, `+`${c.x}px 100%, `+"100% 100%, 100% 0%)";d.style.clipPath=c,d.style.webkitMask=u,d.style.mask=u},y.updateThumbScope();var i=function(e,t=!1){if(0==e.buttons&&0==e.button||1!=e.buttons)return!1;!function(e,t,n,i,o=!1){var l=m.getBoundingClientRect(),a=(u.getBoundingClientRect(),n.getSizes().width,n.getSizes().height,n.getSizes().realZoom),r=i.getSizes().width,s=i.getSizes().height,c=i.getSizes().realZoom,d=document.querySelector("#scope").getBoundingClientRect(),i=d.x+d.width/2,d=d.y+d.height/2,r=-((e=e||i)-(l.left+r/2-C))*a/c,c=-((t=t||d)-(l.top+s/2-S))*a/c;L.getPan();o?n.intervalPanID||n.pan({x:r,y:c}):N(n,{x:r,y:c},animateTime=.5)}(e.clientX,e.clientY,L,y,t)};x=function(e){e.preventDefault(),i(e,move=!(o=!0))},w=function(e){e.preventDefault(),o=!1},b=function(e){e.preventDefault(),o&&i(e,move=!0)},m.addEventListener("mouseup",w),m.addEventListener("mousedown",x),m.addEventListener("mousemove",b),0;let e=document.querySelector("#zoom-in"),t=document.querySelector("#zoom-out"),n=document.querySelector("#zoom-reset");E=function(e){P(L,L.getZoom()+L.zoomScaleSensitivity)},f=function(e){P(L,L.getZoom()-L.zoomScaleSensitivity)},I=function(e){P(L,a.zoom),N(L,a.pan)},e.addEventListener("click",E),t.addEventListener("click",f),n.addEventListener("click",I)}}(L,y),L.setZoomScaleSensitivityAux(l),s.onMainViewShown&&s.onMainViewShown(mainViewSVGDoc,_main_svg),L.lastMouseWheelEventTime=Date.now(),s.onThumbnailShown&&s.onThumbnailShown(thumbViewSVGDoc,y),P(L,.9*L.getZoom(),animationTime=1,fps=60,callback=function(){a.pan=L.getPan(),a.zoom=L.getZoom()}),y.zoomBy(.9),y.updateThumbScope();var T=!0;const B=new ResizeObserver(e=>{for(var t of e){var n=t.target.getBoundingClientRect(),i=m.getBoundingClientRect();0<n.width&&0<n.height&&t.target===u&&(v=!0,T||(T=!1,L.intervalZoomID&&(clearInterval(L.intervalZoomID),L.intervalZoomID=null),L.intervalPanID&&(clearInterval(L.intervalPanID),L.intervalPanID=null),y.intervalZoomID&&(clearInterval(y.intervalZoomID),y.intervalZoomID=null),y.intervalPanID&&(clearInterval(y.intervalPanID),y.intervalPanID=null)),L.resize(),0<i.width&&0<i.height&&y.updateThumbScope(),i={zoom:L.getZoom(),pan:L.getPan()},L.reset(),L.zoomBy(.8),a.pan=L.getPan(),a.zoom=L.getZoom(),L.zoom(i.zoom),L.pan(i.pan))}});return B.observe(u),[L,y,function(){L.destroy(),delete L,y.destroy(),delete y,u.parentElement.getElementsByClassName(p)[0].remove()}]};