var DOMPhysicsBox2D=function(n){var e=1,t=document.getElementById(n.debug_DOM_id),a={};a.width=t.getBoundingClientRect().width,a.height=document.documentElement.scrollHeight,a.centerX=a.width/2,a.centerY=a.height/2,a.offsetX=a.width/2,a.offsetY=a.height/2;var i,o,d,r,s,w,f=32,b=null,l=null,h=!0,c=0,u=0,x=n.debug,m=!1,y=!1,g={x:0,y:0},p={x:0,y:0},_={x:0,y:0},B={x:a.offsetX,y:a.offsetY},D={x:a.centerX,y:a.centerY},C=null,E=9,S=[],v=[],L={RECTANGLE_ROUNDED:"rectangle_rounded",RECTANGLE:"rectangle",PILL:"pill",ELLIPSE:"ellipse"};function R(e,t){for(var o=1,n=0;n<t;n++)o*=10;return Math.round(e*o)/o}function A(e){return{x:(e.x-B.x)/f,y:(e.y-(d.height-B.y))/f}}function V(e,t,o=!1){e=e.getBoundingClientRect(),g=o&&1==t.touches.length?{x:t.touches[0].clientX-e.left,y:a.height-(t.touches[0].clientY-e.top)}:{x:t.clientX-e.left,y:a.height-(t.clientY-e.top)},_=A(g)}function F(e,t){var o=A(D),n=e.get_x()-o.x,o=e.get_y()-o.y,t=t?1:.25;B.x-=R(t*n*f,0),B.y+=R(t*o*f,0)}function M(e,t,o=!1){p=g,V(e,t,o),y&&n.keyListeners?(B.x+=g.x-p.x,B.y-=g.y-p.y):m&&null!=l&&(t.preventDefault(),l.SetTarget(new window.Box2D.b2Vec2(_.x,_.y)))}function G(e,t,o=!1){V(e,t,o),m||null==l&&((t=new window.Box2D.b2AABB).set_lowerBound(new b2Vec2(_.x-.001,_.y-.001)),t.set_upperBound(new b2Vec2(_.x+.001,_.y+.001)),w.m_fixture=null,w.m_point=new window.Box2D.b2Vec2(_.x,_.y),b.QueryAABB(w,t),w.m_fixture&&(o=w.m_fixture.GetBody(),(t=new window.Box2D.b2MouseJointDef).set_bodyA(i),t.set_bodyB(o),t.set_target(new window.Box2D.b2Vec2(_.x,_.y)),t.set_maxForce(1e3*o.GetMass()),t.set_collideConnected(!0),l=window.Box2D.castObject(b.CreateJoint(t),window.Box2D.b2MouseJoint),o.SetAwake(!0))),m=!0}function k(e,t,o=!1){m=!1,V(e,t,o),null!=l&&(b.DestroyJoint(l),l=null)}function P(e,t){83==t.keyCode?X():88==t.keyCode?function(){var e=A(D);f*=1.1;var t=A(D);B.x+=(t.x-e.x)*f,B.y-=(t.y-e.y)*f}():90==t.keyCode?function(){var e=A(D);f/=1.1;var t=A(D);B.x+=(t.x-e.x)*f,B.y-=(t.y-e.y)*f}():37==t.keyCode?B.x+=32:39==t.keyCode?B.x-=32:38==t.keyCode?B.y+=32:40==t.keyCode?B.y-=32:16==t.keyCode&&(y=!0),C&&C.onKeyDown&&C.onKeyDown(e,t)}function T(){i=b.CreateBody(new window.Box2D.b2BodyDef);let e=new window.Box2D.b2BodyDef;e.restitution=1,o=b.CreateBody(e);var t=new window.Box2D.b2EdgeShape;worldWidth=a.width/f,worldHeight=a.height/f,t.Set(new window.Box2D.b2Vec2(-worldWidth/2,-worldHeight/2),new window.Box2D.b2Vec2(worldWidth/2,-worldHeight/2)),o.CreateFixture(t,0),t.Set(new window.Box2D.b2Vec2(-worldWidth/2,worldHeight/2),new window.Box2D.b2Vec2(worldWidth/2,worldHeight/2)),o.CreateFixture(t,0),t.Set(new window.Box2D.b2Vec2(-worldWidth/2,worldHeight/2),new window.Box2D.b2Vec2(-worldWidth/2,-worldHeight/2)),o.CreateFixture(t,0),t.Set(new window.Box2D.b2Vec2(worldWidth/2,worldHeight/2),new window.Box2D.b2Vec2(worldWidth/2,-worldHeight/2)),o.CreateFixture(t,0)}function z(e,t,o,n,i){let d=new window.Box2D.b2BodyDef;d.set_type(Module.b2_dynamicBody),d.set_position(new window.Box2D.b2Vec2(e/f,t/f));let r=b.CreateBody(d);var s=Math.min(o,n)/2,w=.99*Math.min(o,n)/2,a=i.topLeft>=s?w:i.topLeft,l=i.topRight>=s?w:i.topRight,h=i.bottomLeft>=s?w:i.bottomLeft,c=i.bottomRight>=s?w:i.bottomRight,u=o/2/f,x=n/2/f,m=a/f,y=l/f,g=h/f,t=u-m,s=x-m,w=u-y,i=x-y,o=u-g,n=x-g,a=u-(e=c/f),l=x-e,h=new window.Box2D.b2PolygonShape;return(c=new window.Box2D.b2FixtureDef).set_density(3),c.set_friction(.3),c.set_restitution(.3),h.SetAsBox(u,x-Math.min(g,e)),c.set_shape(h),r.CreateFixture(c),h.SetAsBox(u-Math.min(y,e),x),c.set_shape(h),r.CreateFixture(c),(h=new window.Box2D.b2CircleShape).set_m_p(new window.Box2D.b2Vec2(-t,s)),h.set_m_radius(m),c.set_shape(h),r.CreateFixture(c),h.set_m_p(new window.Box2D.b2Vec2(w,i)),h.set_m_radius(y),c.set_shape(h),r.CreateFixture(c),h.set_m_p(new window.Box2D.b2Vec2(-o,-n)),h.set_m_radius(g),c.set_shape(h),r.CreateFixture(c),h.set_m_p(new window.Box2D.b2Vec2(a,-l)),h.set_m_radius(e),c.set_shape(h),r.CreateFixture(c),r}function O(e,t,o,n){var i=new window.Box2D.b2PolygonShape,d=new window.Box2D.b2FixtureDef;return d.set_density(3),d.set_friction(.3),d.set_restitution(.3),i.SetAsBox(o/2/f,n/2/f),d.set_shape(i),(i=new window.Box2D.b2BodyDef).set_type(Module.b2_dynamicBody),i.set_position(new window.Box2D.b2Vec2(e/f,t/f)),(i=b.CreateBody(i)).CreateFixture(d),i}function N(e,t,o,n,i){let d=new window.Box2D.b2BodyDef;d.set_type(Module.b2_dynamicBody),d.set_position(new window.Box2D.b2Vec2(e/f,t/f));let r=b.CreateBody(d);var s=Math.min(o,n),w=s===o&&o!==n,e=.99*s/2;s/=2;let a,l;l="object"!=typeof i?a=i:(a=Math.max(i.topLeft,i.bottomLeft),Math.max(i.bottomRight,i.bottomRight)),t=a>=s?e:a,i=s<=l?e:l,s=o/2/f,e=n/2/f,o=t/f,n=i/f;let h,c;return c=w?(h=e-o,e-n):(h=s-o,s-n),t=new window.Box2D.b2PolygonShape,(i=new window.Box2D.b2FixtureDef).set_density(3),i.set_friction(.3),i.set_restitution(.3),w?t.SetAsBox(s,e-o):t.SetAsBox(s-o,e),i.set_shape(t),r.CreateFixture(i),t=new window.Box2D.b2CircleShape,w?t.set_m_p(new window.Box2D.b2Vec2(0,-h)):t.set_m_p(new window.Box2D.b2Vec2(-h,0)),t.set_m_radius(o),i.set_shape(t),r.CreateFixture(i),w?t.set_m_p(new window.Box2D.b2Vec2(0,c)):t.set_m_p(new window.Box2D.b2Vec2(c,0)),t.set_m_radius(n),i.set_shape(t),r.CreateFixture(i),r}function H(t){try{var o=parseFloat(t.replace(/%|[cm]m|in|p[xtc]|r?em|v(?:[hw]|min|max)|ch|ex/g,""));let e=t.match(/%|[cm]m|in|p[xtc]|r?em|v(?:[hw]|min|max)|ch|ex/g);return e=e&&e[0],[o,e]}catch(e){return 0}}function Z(o,n){var i=new b2Vec2(0,0),d=function(o){var n=window.getComputedStyle(o),i=o.getBoundingClientRect();if(0!==i.width&&0!==i.height){var o={topLeft:(d=function(e,t,o){let n=e.split(" "),i=[];return n.length<=1&&(""===n[0]&&(n[0]="0"),n[1]=n[0]),[n[0],i[0]]=H(n[0]),[n[1],i[1]]=H(n[1]),[Math.max(n[0],n[1]),i[0]]})(n.borderTopLeftRadius),topRight:d(n.borderTopRightRadius),bottomLeft:d(n.borderBottomLeftRadius),bottomRight:d(n.borderBottomRightRadius)},d=Object.values(o).map((e,t,o)=>e[0]).reduce((e,t)=>e+t)/Object.values(o).length;let e={topLeft:o.topLeft[1],topRight:o.topRight[1],bottomLeft:o.bottomLeft[1],bottomRight:o.bottomRight[1]};o={topLeft:o.topLeft[0],topRight:o.topRight[0],bottomLeft:o.bottomLeft[0],bottomRight:o.bottomRight[0]};let t=n.lineHeight;return t.indexOf("px")&&(t=parseFloat(t.slice(0,t.indexOf("px"))),0===t||isNaN(t)||(t+=i.height/2),isNaN(t)&&(t=0)),{coordinates:{x:i.left+window.scrollX-a.width/2+i.width/2,y:-i.top-window.scrollY+a.height/2+i.height/2-t},boundings:i,borderRadiusAvg:d,borderRadius:o,borderUnits:e,borderDifferentUnits:Object.values(e).join("")!==e.topLeft.repeat(4)}}}(o);if(void 0!==d){var r=d.coordinates,s=d.boundings,w=d.borderRadius;o.style.height=`${s.height}px`,o.style.width=`${s.width}px`,o.style.lineHeight=`${s.height}px`,o.style.position="absolute",o.style.margin="0",o.style.padding="0",o.style.inset="0",o.style.boxShadow="none",o.style.transition="none";let e,t;return d.borderDifferentUnits?(e=z(r.x,r.y,s.width,s.height,w),t=L.RECTANGLE_ROUNDED):"%"===d.borderUnits.topLeft&&50<=d.borderRadiusAvg?(e=N(r.x,r.y,s.width,s.height,d.borderRadiusAvg/100*Math.min(s.width,s.height)),t=L.PILL):d.borderRadiusAvg>=Math.min(s.width,s.height)&&(e=N(r.x,r.y,s.width,s.height,w),t=L.PILL),0===Object.values(w).reduce((e,t)=>e[0]+t[0])?(e=O(r.x,r.y,s.width,s.height),t=L.RECTANGLE):void 0===e&&(e=z(r.x,r.y,s.width,s.height,w),t=L.RECTANGLE_ROUNDED),e.SetLinearVelocity(i),e.SetAwake(1),e.SetActive(1),n.randomForce&&(n=new b2Vec2(0,500-Math.floor(1e3*Math.random())),e.ApplyForce(n)),{type:t,origCoordinates:{x:s.x,y:s.y},coordinates:r,domElement:o,domSizes:{width:s.width,height:s.height,borderRadius:w},box:e}}}function W(){var e,t,o,n,i;for(i of S)e=i.box.GetPosition(),t=-i.box.GetAngle(),i.domElement.getBoundingClientRect(),o=i.domSizes.width,n=i.domSizes.height,o=a.width/2+e.get_x()*f-o/2,n=-(-a.height/2+e.get_y()*f+n/2),i.domElement.style.transform="translate("+o+"px, "+n+"px) rotate("+t+"rad)"}function X(){var e,t;W(),b.Step(1/60,E,E),n.debug&&(r.fillStyle="rgba(0,0,0, 0.8)",r.fillRect(0,0,d.width,d.height),r.save(),r.translate(B.x,B.y),r.scale(1,-1),r.scale(f,f),r.lineWidth=1,r.lineWidth/=f,drawAxes(r),r.fillStyle="rgb(255,255,0)",b.DrawDebugData(),null!=l&&(e=l.GetAnchorB(),t=l.GetTarget(),r.strokeStyle="rgb(204,204,204)",r.beginPath(),r.moveTo(e.get_x(),e.get_y()),r.lineTo(t.get_x(),t.get_y()),r.stroke()),r.restore()),x&&(t=Date.now(),b.Step(1/60,E,E),t=Date.now()-t,c=c*(59/60)+1/60*t,20<++u&&(u=0))}function Y(){h&&requestAnimFrame(Y),X()}function U(){(h=!h)&&Y()}function q(){using(window.Box2D,"b2.+"),n.debug||(t.style.display="none"),(d=document.createElement("canvas")).width=a.width,d.height=a.height,d.oncontextmenu=function(){return!1},d.onselectstart=function(){return!1},t.appendChild(d),r=d.getContext("2d"),B.x=a.width/2,B.y=a.height/2,controlZone=document.documentElement,controlZone.addEventListener("mousemove",function(e){M(controlZone,e,touch=!1)},!1),controlZone.addEventListener("mousedown",function(e){G(controlZone,e,touch=!1)},!1),controlZone.addEventListener("mouseup",function(e){k(controlZone,e,touch=!1)},!1),window.addEventListener("touchmove",function(e){M(controlZone,e,touch=!0)},{passive:!1}),window.addEventListener("touchstart",function(e){G(controlZone,e,touch=!0)},!1),window.addEventListener("touchend",function(e){k(controlZone,e),touch=!0},!1),n.keyListeners&&(controlZone.addEventListener("keydown",function(e){P(controlZone,e)},!1),controlZone.addEventListener("keyup",function(e){var t=controlZone;16==e.keyCode&&(y=!1),80==e.keyCode&&U(),C&&C.onKeyUp&&C.onKeyUp(t,e)},!1)),(s=getCanvasDebugDraw(r)).SetFlags(e),(w=new window.Box2D.JSQueryCallback).ReportFixture=function(e){return(e=window.Box2D.wrapPointer(e,b2Fixture)).GetBody().GetType()!=window.Box2D.b2_dynamicBody||!e.TestPoint(this.m_point)||(this.m_fixture=e,!1)},F(new b2Vec2(0,0),!0),null!=b&&window.Box2D.destroy(b),(b=new window.Box2D.b2World(new window.Box2D.b2Vec2(0,-0))).SetDebugDraw(s),T(),document.querySelectorAll(`.${n.rigid_DOM_class}`).forEach(function(e,t,o){e=Z(e,{}),S.push(e)}),Y(),n.initPause&&U()}return window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){e()},window.Box2D||(window.Box2D=(void 0!==window.Box2D?window.Box2D:null)||window.Module),window.Box2D().then(function(e){window.Box2D=e,window.Module=window.Box2D,"complete"===document.readyState?q():window.onload=q}),[function(){S.forEach(function(e){e.lastVel={x:e.box.GetLinearVelocity().get_x(),y:e.box.GetLinearVelocity().get_y(),angular:e.box.GetAngularVelocity()},e.box.SetAwake(0),e.box.SetActive(0),e.coordinates={x:e.box.GetPosition().get_x()*f,y:e.box.GetPosition().get_y()*f},e.angle=e.box.GetAngle(),b.DestroyBody(e.box),v.push(e)}),S=[],a.width=window.innerWidth,d.height=0,d.style.height="0",a.height=document.documentElement.scrollHeight,d.width=a.width,d.height=a.height,d.style.height="",a.centerX=a.width/2,a.centerY=a.height/2,a.offsetX=a.width/2,a.offsetY=a.height/2,B={x:a.offsetX,y:a.offsetY},D={x:a.centerX,y:a.centerY},i&&(b.DestroyBody(i),i=void 0),o&&(b.DestroyBody(o),o=void 0),T(),F(new b2Vec2(0,0),!0),v.forEach(function(e){let t;if(e.type===L.RECTANGLE_ROUNDED)t=z(e.coordinates.x,e.coordinates.y,e.domSizes.width,e.domSizes.height,e.domSizes.borderRadius);else if(e.type===L.RECTANGLE)t=O(e.coordinates.x,e.coordinates.y,e.domSizes.width,e.domSizes.height);else if(e.type===L.PILL)t=N(e.coordinates.x,e.coordinates.y,e.domSizes.width,e.domSizes.height,e.domSizes.borderRadius);else{if(e.type!==L.ELLIPSE)return;t=function(e,t){let o=new window.Box2D.b2BodyDef;o.set_type(Module.b2_dynamicBody),o.set_position(new window.Box2D.b2Vec2(e/f,t/f));let n=b.CreateBody(o);return(e=new window.Box2D.b2FixtureDef).set_density(3),e.set_friction(.3),e.set_restitution(.3),(t=new window.Box2D.b2CircleShape).set_m_p(new window.Box2D.b2Vec2(-offsetLeftX,0)),t.set_m_radius(b2LeftRadius),e.set_shape(t),n.CreateFixture(e),t.set_m_p(new window.Box2D.b2Vec2(offsetRightX,0)),t.set_m_radius(b2RightRadius),e.set_shape(t),n.CreateFixture(e),n}(e.coordinates.x,e.coordinates.y,(e.domSizes.width,e.domSizes.height))}t.SetAwake(1),t.SetActive(1),t.SetLinearVelocity(new b2Vec2(e.lastVel.x,e.lastVel.y)),t.SetAngularVelocity(e.lastVel.angular),S.push({type:e.type,origCoordinates:e.origCoordinates,coordinates:e.coordinates,domElement:e.domElement,domSizes:e.domSizes,box:t})}),v=[]},function(e,t){e.classList.add(n.rigid_DOM_class),t=Z(e,t),W(),S.push(t)},function(){U(),S.forEach(function(w){b.DestroyBody(w.box),w.domElement.style.transition="all 0.5s",window.setTimeout(function(){w.domElement.style.margin="",w.domElement.style.padding="",w.domElement.style.boxShadow=""},200),window.setTimeout(function(){let e=a.width/2+w.box.GetPosition().get_x()*f-w.domSizes.width/2,t=-(-a.height/2+w.box.GetPosition().get_y()*f+w.domSizes.height/2);var o=Math.max(w.origCoordinates.x,w.origCoordinates.y,e,t);let n=0,i=0,d=10;function r(){e<=0&&(e+=d),0<=e&&(e-=d),t<=0&&(t+=d),0<=t&&(t-=d),n<=w.origCoordinates.x&&(n+=d),n>=w.origCoordinates.x&&(n-=d),i<=w.origCoordinates.y&&(i+=d),i>=w.origCoordinates.y&&(i-=d),w.domElement.style.left=`${n}px`,w.domElement.style.top=`${i}px`,w.domElement.style.transform=`translate(${e}px, ${t}px)`}let s=100;for(let e=0;e<=o;e+=d)window.setTimeout(r,s+=10);window.setTimeout(function(){w.domElement.style.transform="",w.domElement.style.left="",w.domElement.style.top="",w.domElement.style.inset="",w.domElement.style.position="",w.domElement.style.height="",w.domElement.style.width="",w.domElement.style.lineHeight="",w.domElement.style.transition=""},s+=200)},400),w.domElement.classList.remove(n.rigid_DOM_class)}),S=[]},function(){U()}]};