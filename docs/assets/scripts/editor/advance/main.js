function EditorAdvance(e={}){let h=[{date:Date.now(),zActions:1,name:"init"}],p=0,y=[],u=[],l=e.$containerEditor,f=l.querySelector(".input-carets"),v=l.querySelector(".input-selects"),m=e.$inputRegex,x=e.$syntaxRegex,w=f.parentElement,n=l.querySelector("#editor-input"),C=void 0,t=(e.debugInputClass&&((C=document.createElement("div")).classList.add(e.debugInputClass),w.appendChild(C)),{});const s=()=>{f.timeoutBlink&&clearTimeout(f.timeoutBlink),f.classList.remove("blink"),f.timeoutBlink=window.setTimeout(()=>{f.classList.add("blink")},500)};const i=()=>{let e=window.getComputedStyle(document.documentElement),t=e.getPropertyValue("--font-size");return parseFloat(t.substring(0,t.length-2))};const g=e=>{if(e.hasOwnProperty("charWidth")&&e.charWidth)return e.charWidth;let t=document.createElement("span");t.innerText="0",t.style.opacity="0",e.appendChild(t);var n=t.getBoundingClientRect().width;return t.remove(),e.charWidth=n},c=(e=0)=>(0===e&&(e=i()),t.hasOwnProperty(e)||(t[e]=g(x)),t[e]),S=(e=0)=>{0===e&&(e=i());let t=window.getComputedStyle(document.documentElement);return e*parseFloat(t.getPropertyValue("--line-height-ratio"))},B=(n,r,e=!1)=>{var o=Array.from(f.children);let i;for(let t=0;t<o.length;t++){let e=o[t];if(parseInt(e.style.getPropertyValue("--pos-char"))===n&&parseInt(e.style.getPropertyValue("--pos-line"))===r){i=e;break}}return!i||e?((i=document.createElement("span")).classList.add("caret"),f.appendChild(i)):(f.removeChild(i),i=void 0),i};const K=e=>{var t,n=S(),r=m.getBoundingClientRect();v.innerHTML="";for(t of e)($caretSelection=document.createElement("span")).classList.add("caret-selection"),$caretSelection.style.setProperty("--pos-x",t.x-r.x),$caretSelection.style.setProperty("--pos-y",t.y-r.y),$caretSelection.style.setProperty("--size-width",t.width),$caretSelection.style.setProperty("--size-height",n),v.append($caretSelection)};const r=(n,r,o=void 0)=>{var i=n,a=r;if(0===n&&0===r){let e=document.createRange(),t=window.getSelection();t.removeAllRanges(),e.setStart(o,n),e.setEnd(o,r),t.addRange(e)}else{n=Math.min(o.innerText.length,n),r=Math.min(o.innerText.length,r);var[l,n]=A(n,o),[s,r]=A(r,o);n=Math.min(o.innerText.length,n),r=Math.min(o.innerText.length,r);let e=document.createRange(),t=window.getSelection();t.removeAllRanges(),a<i?(e.setStart(s,r),e.setEnd(l,n),e.collapse(!1),t.addRange(e),t.extend(s,r)):(e.setStart(l,n),e.setEnd(s,r),t.addRange(e))}},N=(e,t)=>{r(e,t,$toNode=x)},Z=(e,t,n)=>{n&&(n=e,e=t,t=n),r(e,t,$toNode=m)},d=(e,t,n,r)=>{var[e,t,n]=D(e,t,n,r);return Z(e,t,n),[e,t]},A=(t,e)=>{if(3===e.nodeType)return[e,t];var n=e.childNodes;let r=0,o=0,i=void 0;for(let e=0;e<n.length;e++){if(i=n[e],t<=(o+=i.textContent.length)){if(t-r>i.childNodes.length)return A(t-r,i);break}r+=i.textContent.length}return[i,t-r]},P=e=>{let t=0,n=0,r=!1;if("TEXTAREA"===e.nodeName)t=e.selectionStart,n=e.selectionEnd,r="backward"===e.selectionDirection;else if(void 0!==window.getSelection){const i=window.getSelection();if(0!==i.rangeCount){var o=i.anchorNode.compareDocumentPosition(i.focusNode);r=!1,(!o&&i.anchorOffset>i.focusOffset||o===Node.DOCUMENT_POSITION_PRECEDING)&&(r=!0);const a=i.getRangeAt(0),l=a.cloneRange(),s=(l.selectNodeContents(e),l.setEnd(a.startContainer,a.startOffset),t=l.toString().length,a.cloneRange());s.selectNodeContents(e),s.setEnd(a.endContainer,a.endOffset),n=s.toString().length}}return r?[n,t]:[t,n]},b=()=>{return Array.from(f.children)},R=()=>{var e=window.getSelection().getRangeAt(0).getClientRects();let t={x:0,y:0,width:1,height:S()};return t=0===e.length?(a=>{let l={x:0,y:0,width:1,height:S()},e=false;if(a.nodeName==="TEXTAREA"){prePosition=a.selectionStart;postPosition=a.selectionEnd;e=a.selectionDirection==="backward"}else{const t=typeof window.getSelection!=="undefined";if(t){const s=window.getSelection();if(s.rangeCount!==0){const d=s.getRangeAt(0);let[e,t]=P(a);let[n,r]=A(e,a);let[o,i]=A(t,a);d.setStart(n,r);d.setEnd(o,i);l=d.getClientRects()[0]}}}return{x:l.x,y:l.y,width:l.width,height:l.height}})(m):{x:e[0].x,y:e[0].y,width:e[0].width,height:e[0].height}},D=(e,t,n,r)=>{var[e,t,n,r]=k({x:e,y:t},{x:n,y:r}),[e,t]=E(e,t,n,r);return[e,t,t<e]};const E=(t,e,n,r)=>{0===u.length&&T();var o=c();let i=0,a=0;for(let e=0;e<u.length;e++){var l=u[e],l=parseInt((l.width+2)/o);e<t&&(i+=l),e<n&&(a+=l)}return i+=e,a+=r,[i,a]},H=(e,t)=>{0===u.length&&T();var n=c();let r=0,o=Math.min(e,m.innerText.length),i=0,a=Math.min(t,m.innerText.length),l=!0,s=!0;for(let e=0;e<u.length;e++){var d=u[e],d=parseInt((d.width+2)/n);o>d&&l?(o-=d,r++):l=!1,a>d&&s?(a-=d,i++):s=!1}return[r,o,i,a]},L=(e,t)=>{var n=i(),r=S(n),n=c(n),o=m.getBoundingClientRect();return caretPosX=n*t+o.x,caretPosY=r*e+o.y,[caretPosX,caretPosY]},k=(e,t)=>{var n=g(x),r=S(),o=m.getBoundingClientRect();let i=parseInt((e.y-o.y)/r),a=parseInt((t.y-o.y)/r),l=e,s=t,d=!1;i===a&&e.x>t.x&&(s=e,l=t,d=!0),i>a&&(s=e,l=t,r=i,i=a,a=r,d=!0);e=i,t=a;return[e,Math.round((l.x-o.x)/n),t,Math.round((s.x-o.x)/n),d]};const T=()=>{var e,t,n,r,o=m.getBoundingClientRect();let i=window.getSelection(),a=void 0,l=(1<=i.rangeCount&&(a=i.getRangeAt(0)),i.selectAllChildren(x),Array.from(i.getRangeAt(0).getClientRects())),s=(i.removeAllRanges(),a&&i.addRange(a),l=l.sort((e,t)=>e.y-t.y),u=[],window.newLines={},0===l.length&&l.push({bottom:o.bottom,height:o.height,left:o.left,right:o.left,top:o.top,width:0,x:o.x,y:o.y}),l[0].y),d={bottom:0,height:0,left:1/0,right:0,top:1/0,width:0,x:1/0,y:0};for(e in l){e=parseInt(e);var g=l[e];g.y>s&&(s=g.y,d.width=d.right-d.left,d.height=d.bottom-d.top,u.push(d),d={bottom:0,height:0,left:1/0,right:0,top:1/0,width:0,x:1/0,y:0}),d={bottom:Math.max(g.bottom,d.bottom),left:Math.min(g.left,d.left),right:Math.max(g.right,d.right),top:Math.min(g.top,d.top),x:Math.min(g.x,d.x),y:Math.max(g.y,d.y)},e>=l.length-1&&(d.width=d.right-d.left,d.height=d.bottom-d.top,u.push(d))}for(t of u)t.y-=o.y,t.x-=o.x,t.top-=o.top,t.bottom=t.height+t.top,t.left-=o.left,t.right=t.width+t.left;if("\n\n"===m.textContent.slice(-2)&&(n=u[u.length-1],r=u[0],u.push({bottom:n.bottom+r.top+n.height,height:n.height,left:n.left,right:n.left,top:n.bottom+r.top,width:0,x:n.x,y:n.bottom+r.top})),void 0!==C){C.innerHTML="";for(var c of u){let e=document.createElement("span");e.style.width=c.width+"px",e.style.height=c.height+"px",e.style.left=c.left+"px",e.style.top=c.top+"px",e.style.position="absolute",e.style.background="#0000ff1f",e.classList.add("boxSel"),C.appendChild(e)}}},M=(e,t=!1)=>{0===u.length&&T();let n;for(var r in u){r=u[r];e>=r.y&&(n=r)}return n&&(n=Object.keys(n).reduce((e,t)=>(e[t]=n[t],e),{}),t&&(t=m.getBoundingClientRect(),n.y+=t.y,n.x+=t.x,n.top+=t.top,n.bottom+=t.top,n.left+=t.left,n.right+=t.left)),n},I=()=>(0===u.length&&T(),u.length-1),F=(e,t)=>{var n=g(x),r=S(),o=I();let i=o<e?o:e;i=Math.max(i,0);r=M(i*r+r/2);if(!r)return[t,1/0,e];e=Math.round((r.x+r.width)/n);let a=Math.min(t,e);return t!==1/0&&e<t&&i!=o&&(i+=1,a=0),[i,a,e]},V=(e,{$caret:t=void 0,ctrlKey:n=!1,wheelKey:r=!1,dragStyle:o=!1,resetFirst:i=!1})=>{var a,l=m.getBoundingClientRect(),l=(e={x:e.x-l.x,y:e.y-l.y},M(e.y));return void 0!==l&&(e={x:Math.min(e.x,l.x+l.width),y:l.y+l.height/2},l=g(x),a=S(),a=parseInt(e.y/a),l=Math.round(e.x/l),t=$(a,l,{$caret:t,ctrlKey:n,wheelKey:r,dragStyle:o,resetFirst:i})),[e,t]},$=(t,n,{$caret:r=void 0,ctrlKey:o=!1,dragStyle:i=!1,resetFirst:e=!1})=>{var a,l=void 0===r;let s=void 0,d=void 0;if(void 0===r){let e=b();if(0===e.length||o&&!i||i)r=B(n,t,i);else{r=e.pop();for(var g of e)f.removeChild(g);s=t,d=n}}return void 0!==r&&(o=parseInt(r.style.getPropertyValue("--pos-char"))||n,a=parseInt(r.style.getPropertyValue("--pos-line"))||t,s=l||e?t:s,d=l||e?n:d,l=a===t?n:o,z(r,t,n,s,d,l),i||X()),r},X=()=>{var e,t=Array.from(f.children),n=S();let r=[];v.innerHTML="";for(e of t){var o=parseInt(e.style.getPropertyValue("--fpos-line")),i=parseInt(e.style.getPropertyValue("--pos-line")),[a,l]=L(o,parseInt(e.style.getPropertyValue("--fpos-char"))),[s,d]=L(i,parseInt(e.style.getPropertyValue("--pos-char")));if(i!==o){let e=!1;i<o&&(e=!0);var g=M(o*n+n/2,absolutePos=!0),c=M(i*n+n/2,absolutePos=!0);if(g&&c&&(e?(r.push({top:l,bottom:l+n,height:n,width:a-g.left,left:g.left,right:a,x:g.left,y:l}),r.push({bottom:c.bottom,top:c.top,height:n,width:c.right-s,left:s,right:c.right,x:s,y:c.y})):(r.push({top:g.top,bottom:g.bottom,height:n,width:g.right-a,left:a,right:g.right,x:a,y:g.y}),r.push({top:c.top,bottom:c.bottom,height:n,width:s-c.left,left:c.left,right:s,x:c.x,y:c.y}))),0<Math.abs(i-o))for(let e=Math.min(o,i)+1;e<Math.max(o,i);e++){var h=M(e*n+n/2,absolutePos=!0);h&&r.push(h)}}else if(a!==s){let e=s<a?!0:!1;r.push({top:d,bottom:d+n,height:n,width:Math.abs(s-a),left:e?s:a,right:e?a:s,x:e?s:a,y:d})}}K(r)},z=(e,t,n,r,o,i)=>{e.style.setProperty("--pos-line",t),e.style.setProperty("--pos-char",n),void 0!==r&&e.style.setProperty("--fpos-line",r),void 0!==o&&e.style.setProperty("--fpos-char",o),e.style.setProperty("--max-pos-char",i)},O=e=>{var t=parseInt(e.style.getPropertyValue("--pos-char")),n=parseInt(e.style.getPropertyValue("--pos-line")),r=parseFloat(e.style.getPropertyValue("--fpos-char")),e=parseFloat(e.style.getPropertyValue("--fpos-line")),o=m.getBoundingClientRect(),i=g(x),a=S();return[{x:r*i+o.x,y:e*a+o.y},{x:t*i+o.x,y:n*a+o.y}]};const o=(e,t)=>{var n=Array.from(v.children);let r;var o=m.getBoundingClientRect();for(r of n){var i=parseFloat(r.style.getPropertyValue("--pos-x"))+o.x,a=parseFloat(r.style.getPropertyValue("--pos-y"))+o.y,l=parseFloat(r.style.getPropertyValue("--size-width")),s=parseFloat(r.style.getPropertyValue("--size-height"));if(i<e&&e<i+l&&a<t&&t<a+s)return[r,{sx:i,sy:a,ex:i+l,ey:a+s}]}return[void 0,{sx:0,sy:0,ex:0,ey:0}]},Y=(e,t)=>{m.internalDrag&&!getSelection().isCollapsed&&U(m.ownerDocument,"delete",{keepZAction:!1});var n=m.dragCaret.getBoundingClientRect(),[n,r]=(d(n.x,n.y,n.x,n.y),U(m.ownerDocument,"insertHTML",{value:e,nameZAction:"DroppedElement"}),u=[],P(m)),n=(N(n-e.length,r),R()),e=(f.contains(m.dragCaret)&&f.removeChild(m.dragCaret),m.dragging=!1,m.dragCaret=void 0,m.internalDrag=!1,m.textSelection={sx:0,sy:0,ex:0,ey:0},V({x:n.x,y:n.y+n.height/2},{}),Array.from(f.children).slice(-1)[0]);V({x:n.x+n.width,y:n.y+n.height/2},{$caret:e}),w.focus()},W=e=>{var t=x.getBoundingClientRect(),e=e.target.getBoundingClientRect();e.left>=t.left&&e.right<=t.right&&e.top>=t.top&&e.bottom<=t.bottom&&(m.dragging||(m.selecting=!1,f.innerHTML="",v.innerHTML="",m.dragging=!0,m.internalDrag=!0),w.focus())},q=e=>{e.preventDefault(),m.dragCaretPos={x:e.clientX,y:e.clientY};let[t,n]=V(m.dragCaretPos,{$caret:m.dragCaret,ctrlKey:!1,dragStyle:!0});m.dragCaretPos=t,n.classList.add("drag"),m.dragCaret=n},j=e=>{var t=x.getBoundingClientRect(),e=e.target.getBoundingClientRect();e.left>=t.left&&e.right<=t.right&&e.top>=t.top&&e.bottom<=t.bottom||(w.blur(),m.dragging&&m.dragCaret&&(f.contains(m.dragCaret)&&f.removeChild(m.dragCaret),m.dragging=!1,m.dragCaret=void 0,m.internalDrag=!1))},_=e=>{f.innerHTML="",v.innerHTML="";for(var t of e){var[n,r,o,i]=H(t.startOffset,t.endOffset),n=$(n,r,{ctrlKey:!0});t.startOffset!==t.endOffset&&$(o,i,{$caret:n,ctrlKey:!0})}},G=(t,{showUI:n=!1,value:r=null})=>{if(0<p){var e=h[p].caretsOffset;for(let e=0;e<h[p].zActions;e++)t.execCommand("undo",n,r);--p,_(e)}},J=(t,{showUI:n=!1,value:r=null})=>{if(p<h.length-1){p+=1;for(let e=0;e<h[p].zActions;e++)t.execCommand("redo",n,r);var e=h[p].caretsOffset;_(e)}},U=(n,r,{showUI:o=!1,value:e=null,keepZAction:t=!0,nameZAction:i=""})=>{if("undo"===r)return G(n,{showUI:o,value:e});if("redo"===r)return J(n,{showUI:o,value:e});if(n.execCommand(r,o,e),""===i&&(i=r),t){var l;let e=[];for(l of b()){var[s,d]=O(l),[s,d,g,c]=k(s,d),[s,d]=E(s,d,g,c);e.push({startOffset:s,endOffset:d})}n=[...y,{commandName:r}],o=(y=[],p+=1,h[0]);let t=0;1e4<=h.length&&(t=1),a=[o,...h.slice(t+1,p)],p=h.length,h.push({comands:n,date:Date.now(),zActions:n.length,name:i,caretsOffset:e})}else y.push({commandName:r})},Q=(e,t,n,{showUI:r=!1,value:o=null,keepZAction:i=!0,nameZAction:a=""})=>{var l=t.ownerDocument;let s=t.ownerDocument.defaultView,d=s.getSelection(),g=new Range;[t,e]=A(e,t),g.setStart(t,e),g.setEnd(t,e),d.removeAllRanges(),d.addRange(g),U(l,n,{showUI:r,value:o,keepZAction:i,nameZAction:a})},ee=(e,{pressedEvent:o=!1})=>{u=[];e.target;if(["Shift","Alt"].includes(e.key))e.preventDefault();else if(o){if("Enter"===e.key)return U(m.ownerDocument,"insertText",{value:"\n"}),!0;if(1===e.key.length)return U(m.ownerDocument,"insertText",{value:e.key}),!0}else{if("Tab"===e.key){e.preventDefault();var[o,i]=P(m);if(e.shiftKey)if(o===i)"\t"===m.innerText[o-1]&&U(m.ownerDocument,"delete",{});else{let e=[];var a,l,s=m.innerText.slice(0,Math.min(o,i)).lastIndexOf("\n");0<s&&"\t"===m.innerText[s-1]&&e.push(s);let t=m.innerText.slice(Math.min(o,i),Math.max(o,i)),n=0;for(a of t.split("\n"))""!==a?("\t"===a[1]&&e.push(n),n+=a):n+=1;let r=0;for(l of e)r<e.length?Q(l,m,"delete",{keepZAction:!1}):Q(l,m,"delete",{nameZAction:"outdent multiple lines"}),r+=1}else o===i&&U(m.ownerDocument,"insertHTML",{value:"\t"});return!0}if("Backspace"===e.key)return U(m.ownerDocument,"delete",{}),!0;if("Delete"===e.key)return U(m.ownerDocument,"forwardDelete",{}),!0}return!1},te=i=>{var a;i.preventDefault();for(a of b()){let o=parseInt(a.style.getPropertyValue("--max-pos-char"));var l=parseInt(a.style.getPropertyValue("--pos-char")),s=parseInt(a.style.getPropertyValue("--pos-line"));if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(i.key)){let e={ArrowLeft:(e,t)=>(--e<0&&(e=1/0,--t),[e,t]),ArrowRight:(e,t)=>[e+1,t],ArrowUp:(e,t)=>[e=Math.max(e,o),t-1],ArrowDown:(e,t)=>[e=Math.max(e,o),t+1]};var[d,g]=e[i.key](l,s);let[t,n,r]=F(g,d);r===1/0&&(n=l,t=s),o=["ArrowLeft","ArrowRight"].includes(i.key)?n:o;g=i.shiftKey?void 0:t,d=i.shiftKey?void 0:n;z(a,t,n,g,d,o)}else["End","Home","PageUp","PageDown"].includes(i.key)}X()},ne=e=>{"Z"===e.key.toUpperCase()&&(u=[],e.preventDefault(),(e.shiftKey?J:G)(m.ownerDocument,{}))},re=e=>{var t,n,r,o;if("A"===e.key.toUpperCase()&&(e.preventDefault(),[n,r,o]=F(I(),1/0),t=$(0,0,{}),$(n,r,{$caret:t})),"C"===e.key.toUpperCase()){let r,o=[];for(r of Array.from(f.children)){var[i,a]=O(r);let[e,t,n]=D(i.x,i.y,a.x,a.y);n&&(i=e,e=t,t=i);a=m.innerText.slice(e,t);o.push(a)}0!==o.length?(m.copiedText=o,navigator.clipboard.writeText(o.join("\n"))):console.error("Something was wrong")}"V"===e.key.toUpperCase()&&(u=[],v.innerHTML="",(async()=>{m.focus();let o=await navigator.clipboard.readText();var e=b();o=o.split("\n").length<e.length||o.split("\n").length>e.length?Array(e.length).fill(o):[o];for(let r=0;r<e.length;r++){var i=e[r],[i,a]=O(i),[i,a,l,s]=k(i,a),[i,a]=E(i,a,l,s);{l=void 0;s=void 0;d=void 0;var[i,a,d,g,{showUI:c=!1,value:h=null,keepZAction:p=!0,nameZAction:y=""}]=[i,a,m,"insertHTML",{value:o[r]}];l=d.ownerDocument;let e=d.ownerDocument.defaultView,t=e.getSelection(),n=new Range;[s,i]=A(i,d),[d,a]=A(a,d),n.setStart(s,i),n.setEnd(d,a),t.removeAllRanges(),t.addRange(n),U(l,g,{showUI:c,value:h,keepZAction:p,nameZAction:y})}}w.focus()})())},oe=(t,e,{pressedEvent:n=!1})=>{if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","End","Home","PageUp","PageDown"].includes(t.key))e!==m&&(s(),te(t));else if(t.ctrlKey&&!n)l!==m&&re(t),ne(t);else if(!["Shift","CapsLock"].includes(t.key)&&e!==m){s(),w.editing=!0;b();for(let e=0;e<Array.from(f.children).length;e++){var r=Array.from(f.children)[e],[o,i]=O(r),o=(d(o.x,o.y,i.x,i.y),ee(t,{pressedEvent:n}));o&&(t.preventDefault(),i=R(),V(i,{$caret:r,resetFirst:!0}))}}e!==m&&(window.getSelection().removeAllRanges(),w.focus(),w.editing=!1)};{x.addEventListener("mousedown",e=>{m.dragging&&(f.contains(m.dragCaret)&&f.removeChild(m.dragCaret),m.dragging=!1,m.dragCaret=void 0,m.internalDrag=!1,m.textSelection={sx:0,sy:0,ex:0,ey:0});let[t,n]=o(e.clientX,e.clientY);var r;void 0!==t?(r=parseFloat(t.style.getPropertyValue("--size-height")),m.textSelection={sx:n.sx,sy:n.sy+r/2,ex:n.ex,ey:n.ey-r/2},m.selecting=!1,m.internalDrag=!0,m.initSelecting=!0):(s(),m.initSelecting=!0,V({x:e.clientX,y:e.clientY},{$caret:void 0,ctrlKey:e.ctrlKey}))},!0),x.addEventListener("mousemove",n=>{if(m.initSelecting&&!m.internalDrag&&(m.initSelecting=!1,m.selecting=!0),m.selecting&&(e=f.lastChild,V({x:n.clientX,y:n.clientY},{$caret:e,wheelKey:2===n.which})),(m.internalDrag||m.dragging)&&1===n.which){var[e]=o(n.clientX,n.clientY);if(void 0===e){m.dragCaretPos={x:n.clientX,y:n.clientY};let[e,t]=V(m.dragCaretPos,{$caret:m.dragCaret,ctrlKey:!1,dragStyle:!0});m.dragCaretPos=e,t.classList.add("drag"),m.dragCaret=t}else f.contains(m.dragCaret)&&f.removeChild(m.dragCaret),m.dragging=!0,m.dragCaret=void 0,m.initSelecting=!1}},!0),x.addEventListener("mouseup",e=>{var t,n;m.selecting=!1,m.dragging?([n,t]=o(e.clientX,e.clientY),void 0===n?(v.innerHTML="",window.getSelection().removeAllRanges(),d(m.textSelection.sx,m.textSelection.sy,m.textSelection.ex,m.textSelection.ey),n=window.getSelection().toString(),Y(n)):(m.dragging=!1,m.dragCaret=void 0,m.internalDrag=!1,m.textSelection={sx:0,sy:0,ex:0,ey:0})):!e.ctrlKey&&m.initSelecting?(m.initSelecting=!1,m.internalDrag=!1,s(),V({x:e.clientX,y:e.clientY},{$caret:void 0})):m.initSelecting=!1},!0),x.addEventListener("dragstart",function(e){e.preventDefault()},!1),w.addEventListener("mouseleave",e=>{m.dragging&&j(e)},!1),x.addEventListener("dragover",q,!1),x.addEventListener("dragenter",W,!1),x.addEventListener("dragleave",j,!1),x.addEventListener("drop",function(e){e.preventDefault();e=e.dataTransfer.getData("Text");m.internalDrag&&(v.innerHTML="",window.getSelection().removeAllRanges(),d(m.textSelection.sx,m.textSelection.sy,m.textSelection.ex,m.textSelection.ey)),Y(e)},!1),w.addEventListener("blur",e=>{w.editing||(f.timeoutBlink&&clearTimeout(f.timeoutBlink),f.classList.remove("blink"),f.classList.add("nofocus"),v.classList.add("nofocus"))}),w.addEventListener("focus",e=>{f.classList.remove("nofocus"),v.classList.remove("nofocus"),s()}),m.addEventListener("change",e=>{u=[]}),w.addEventListener("keypress",e=>{oe(e,e.target,{pressedEvent:!0})}),w.addEventListener("keydown",e=>{oe(e,e.target,{})}),document.addEventListener("keydown",e=>{!e.ctrlKey||"Z"!==e.key.toUpperCase()&&"Y"!==e.key.toUpperCase()||e.preventDefault()});const ie=new ResizeObserver(e=>{u=[]});ie.observe(n)}}