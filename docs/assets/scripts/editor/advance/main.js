function EditorAdvance(e={}){let h=[{date:Date.now(),zActions:1,name:"init"}],p=0,y=[],u=[],l=e.$containerEditor,c=l.querySelector(".input-carets"),f=l.querySelector(".input-selects"),v=e.$inputRegex,m=e.$syntaxRegex,s=c.parentElement,t=l.querySelector("#editor-input"),x=void 0;e.debugInputClass&&(x=document.createElement("div"),x.classList.add(e.debugInputClass),s.appendChild(x));let r={};const d=()=>{c.timeoutBlink&&clearTimeout(c.timeoutBlink),c.classList.remove("blink"),c.timeoutBlink=window.setTimeout(()=>{c.classList.add("blink")},500)},i=()=>{let e=window.getComputedStyle(document.documentElement),t=e.getPropertyValue("--font-size");return parseFloat(t.substring(0,t.length-2))},w=e=>{if(e.hasOwnProperty("charWidth")&&e.charWidth)return e.charWidth;let t=document.createElement("span");t.innerText="0",t.style.opacity="0",e.appendChild(t);var r=t.getBoundingClientRect().width;return t.remove(),e.charWidth=r},g=(e=0)=>(0===e&&(e=i()),r.hasOwnProperty(e)||(r[e]=w(m)),r[e]),C=(e=0)=>{0===e&&(e=i());let t=window.getComputedStyle(document.documentElement);return e*parseFloat(t.getPropertyValue("--line-height-ratio"))},S=(r,n,e=!1)=>{var o=Array.from(c.children);let a;for(let t=0;t<o.length;t++){let e=o[t];if(parseInt(e.style.getPropertyValue("--pos-char"))===r&&parseInt(e.style.getPropertyValue("--pos-line"))===n){a=e;break}}return!a||e?(a=document.createElement("span"),a.classList.add("caret"),c.appendChild(a)):(c.removeChild(a),a=void 0),a},A=(r,n,o=void 0)=>{var a=r,i=n;if(0===r&&0===n){let e=document.createRange(),t=window.getSelection();t.removeAllRanges(),e.setStart(o,r),e.setEnd(o,n),t.addRange(e)}else{r=Math.min(o.innerText.length,r),n=Math.min(o.innerText.length,n);var[l,r]=b(r,o),[s,n]=b(n,o);r=Math.min(o.innerText.length,r),n=Math.min(o.innerText.length,n);let e=document.createRange(),t=window.getSelection();t.removeAllRanges(),i<a?(e.setStart(s,n),e.setEnd(l,r),e.collapse(!1),t.addRange(e),t.extend(s,n)):(e.setStart(l,r),e.setEnd(s,n),t.addRange(e))}},P=(e,t,r,n)=>{var[t,r,n]=L(e,t,r,n),o=t;return e=r,n&&(o=e,e=n=t),A(o,e,$toNode=v),[t,r]},b=(t,e)=>{if(3===e.nodeType)return[e,t];var r=e.childNodes;let n=0,o=0,a=void 0;for(let e=0;e<r.length;e++){if(a=r[e],o+=a.textContent.length,t<=o){if(t-n>a.childNodes.length)return b(t-n,a);break}n+=a.textContent.length}return[a,t-n]},R=e=>{let t=0,r=0,n=!1;if("TEXTAREA"===e.nodeName)t=e.selectionStart,r=e.selectionEnd,n="backward"===e.selectionDirection;else if(void 0!==window.getSelection){const a=window.getSelection();if(0!==a.rangeCount){var o=a.anchorNode.compareDocumentPosition(a.focusNode);n=!1,(!o&&a.anchorOffset>a.focusOffset||o===Node.DOCUMENT_POSITION_PRECEDING)&&(n=!0);const i=a.getRangeAt(0),l=i.cloneRange();l.selectNodeContents(e),l.setEnd(i.startContainer,i.startOffset),t=l.toString().length;const s=i.cloneRange();s.selectNodeContents(e),s.setEnd(i.endContainer,i.endOffset),r=s.toString().length}}return n?[r,t]:[t,r]},D=()=>Array.from(c.children),E=()=>{var e=window.getSelection().getRangeAt(0).getClientRects();return C(),0===e.length?(e=>{let t={x:0,y:0,width:1,height:C()};if("TEXTAREA"===e.nodeName)prePosition=e.selectionStart,postPosition=e.selectionEnd,e.selectionDirection;else if(void 0!==window.getSelection){const a=window.getSelection();if(0!==a.rangeCount){const i=a.getRangeAt(0);var[r,n]=R(e),[o,r]=b(r,e),[n,e]=b(n,e);i.setStart(o,r),i.setEnd(n,e),t=i.getClientRects()[0]}}return{x:t.x,y:t.y,width:t.width,height:t.height}})(v):{x:e[0].x,y:e[0].y,width:e[0].width,height:e[0].height}},L=(e,t,r,n)=>{var[e,t,r,n]=I({x:e,y:t},{x:r,y:n}),[r,n]=k(e,t,r,n);return[r,n,n<r]},k=(t,e,r,n)=>{0===u.length&&V();var o=g();let a=0,i=0;for(let e=0;e<u.length;e++){var l=u[e],l=parseInt((l.width+2)/o);e<t&&(a+=l),e<r&&(i+=l)}return a+=e,i+=n,[a,i]},T=(e,t)=>{0===u.length&&V();var r=g();let n=0,o=Math.min(e,v.innerText.length),a=0,i=Math.min(t,v.innerText.length),l=!0,s=!0;for(let e=0;e<u.length;e++){var d=u[e],d=parseInt((d.width+2)/r);o>d&&l?(o-=d,n++):l=!1,i>d&&s?(i-=d,a++):s=!1}return[n,o,a,i]},M=(e,t)=>{var r=i(),n=C(r),o=g(r),r=v.getBoundingClientRect();return caretPosX=o*t+r.x,caretPosY=n*e+r.y,[caretPosX,caretPosY]},I=(e,t)=>{var r=w(m),n=C(),o=v.getBoundingClientRect();let a=parseInt((e.y-o.y)/n),i=parseInt((t.y-o.y)/n),l=e,s=t,d=!1;a===i&&e.x>t.x&&(s=e,l=t,d=!0),a>i&&(s=e,l=t,g=a,a=i,i=g,d=!0);var t=a,g=i;return[t,Math.round((l.x-o.x)/r),g,Math.round((s.x-o.x)/r),d]},V=()=>{var e,t,r,n=v.getBoundingClientRect();let o=window.getSelection(),a=void 0;1<=o.rangeCount&&(a=o.getRangeAt(0)),o.selectAllChildren(m);let i=Array.from(o.getRangeAt(0).getClientRects());o.removeAllRanges(),a&&o.addRange(a),i=i.sort((e,t)=>e.y-t.y),u=[],window.newLines={},0===i.length&&i.push({bottom:n.bottom,height:n.height,left:n.left,right:n.left,top:n.top,width:0,x:n.x,y:n.y});let l=i[0].y,s={bottom:0,height:0,left:1/0,right:0,top:1/0,width:0,x:1/0,y:0};for(d in i){var d=parseInt(d),g=i[d];g.y>l&&(l=g.y,s.width=s.right-s.left,s.height=s.bottom-s.top,u.push(s),s={bottom:0,height:0,left:1/0,right:0,top:1/0,width:0,x:1/0,y:0}),s={bottom:Math.max(g.bottom,s.bottom),left:Math.min(g.left,s.left),right:Math.max(g.right,s.right),top:Math.min(g.top,s.top),x:Math.min(g.x,s.x),y:Math.max(g.y,s.y)},d>=i.length-1&&(s.width=s.right-s.left,s.height=s.bottom-s.top,u.push(s))}for(e of u)e.y-=n.y,e.x-=n.x,e.top-=n.top,e.bottom=e.height+e.top,e.left-=n.left,e.right=e.width+e.left;if("\n\n"===v.textContent.slice(-2)&&(t=u[u.length-1],r=u[0],u.push({bottom:t.bottom+r.top+t.height,height:t.height,left:t.left,right:t.left,top:t.bottom+r.top,width:0,x:t.x,y:t.bottom+r.top})),void 0!==x){x.innerHTML="";for(var c of u){let e=document.createElement("span");e.style.width=`${c.width}px`,e.style.height=`${c.height}px`,e.style.left=`${c.left}px`,e.style.top=`${c.top}px`,e.style.position="absolute",e.style.background="#0000ff1f",e.classList.add("boxSel"),x.appendChild(e)}}},$=(e,t=!1)=>{0===u.length&&V();let r;for(var n in u)e>=(n=u[n]).y&&(r=n);return r&&(r=Object.keys(r).reduce((e,t)=>(e[t]=r[t],e),{}),t&&(t=v.getBoundingClientRect(),r.y+=t.y,r.x+=t.x,r.top+=t.top,r.bottom+=t.top,r.left+=t.left,r.right+=t.left)),r},O=()=>(0===u.length&&V(),u.length-1),U=(e,t)=>{var r=w(m),n=C(),o=O();let a=o<e?o:e;if(a=Math.max(a,0),!(n=$(a*n+n/2)))return[t,1/0,e];r=Math.round((n.x+n.width)/r);let i=Math.min(t,r);return t!==1/0&&r<t&&a!=o&&(a+=1,i=0),[a,i,r]},B=(e,{$caret:t=void 0,ctrlKey:r=!1,wheelKey:n=!1,dragStyle:o=!1,resetFirst:a=!1})=>{var i=v.getBoundingClientRect();e={x:e.x-i.x,y:e.y-i.y};var l=$(e.y);return void 0!==l&&(e={x:Math.min(e.x,l.x+l.width),y:l.y+l.height/2},i=w(m),l=C(),l=parseInt(e.y/l),i=Math.round(e.x/i),t=K(l,i,{$caret:t,ctrlKey:r,wheelKey:n,dragStyle:o,resetFirst:a})),[e,t]},K=(t,r,{$caret:n=void 0,ctrlKey:o=!1,dragStyle:a=!1,resetFirst:e=!1})=>{var i,l=void 0===n;let s=void 0,d=void 0;if(void 0===n){let e=D();if(0===e.length||o&&!a||a)n=S(r,t,a);else{n=e.pop();for(var g of e)c.removeChild(g);s=t,d=r}}return void 0!==n&&(i=parseInt(n.style.getPropertyValue("--pos-char"))||r,o=parseInt(n.style.getPropertyValue("--pos-line"))||t,s=l||e?t:s,d=l||e?r:d,i=o===t?r:i,N(n,t,r,s,d,i),a||F()),n},F=()=>{var e,t=D(),r=C();let n=[];f.innerHTML="";for(e of t){var o=parseInt(e.style.getPropertyValue("--fpos-line")),a=parseInt(e.style.getPropertyValue("--pos-line")),[i,l]=M(o,parseInt(e.style.getPropertyValue("--fpos-char"))),[s,d]=M(a,parseInt(e.style.getPropertyValue("--pos-char")));if(a!==o){let e=!1;a<o&&(e=!0);var g=$(o*r+r/2,absolutePos=!0),c=$(a*r+r/2,absolutePos=!0);if(g&&c&&(e?(n.push({top:l,bottom:l+r,height:r,width:i-g.left,left:g.left,right:i,x:g.left,y:l}),n.push({bottom:c.bottom,top:c.top,height:r,width:c.right-s,left:s,right:c.right,x:s,y:c.y})):(n.push({top:g.top,bottom:g.bottom,height:r,width:g.right-i,left:i,right:g.right,x:i,y:g.y}),n.push({top:c.top,bottom:c.bottom,height:r,width:s-c.left,left:c.left,right:s,x:c.x,y:c.y}))),0<Math.abs(a-o))for(let e=Math.min(o,a)+1;e<Math.max(o,a);e++){var h=$(e*r+r/2,absolutePos=!0);h&&n.push(h)}}else i!==s&&(c=s<i,n.push({top:d,bottom:d+r,height:r,width:Math.abs(s-i),left:c?s:i,right:c?i:s,x:c?s:i,y:d}))}(e=>{var t,r=C(),n=v.getBoundingClientRect();f.innerHTML="";for(t of e)$caretSelection=document.createElement("span"),$caretSelection.classList.add("caret-selection"),$caretSelection.style.setProperty("--pos-x",t.x-n.x),$caretSelection.style.setProperty("--pos-y",t.y-n.y),$caretSelection.style.setProperty("--size-width",t.width),$caretSelection.style.setProperty("--size-height",r),f.append($caretSelection)})(n)},N=(e,t,r,n,o,a)=>{e.style.setProperty("--pos-line",t),e.style.setProperty("--pos-char",r),void 0!==n&&e.style.setProperty("--fpos-line",n),void 0!==o&&e.style.setProperty("--fpos-char",o),e.style.setProperty("--max-pos-char",a);var n=n||parseFloat(e.style.getPropertyValue("--fpos-line")),o=o||parseFloat(e.style.getPropertyValue("--fpos-char")),t=t,r=r,[t,r]=k(n,o,t,r);e.style.setProperty("--offset-start",t),e.style.setProperty("--offset-end",r)},Z=e=>{var t=parseInt(e.style.getPropertyValue("--pos-char")),r=parseInt(e.style.getPropertyValue("--pos-line")),n=parseFloat(e.style.getPropertyValue("--fpos-char")),o=parseFloat(e.style.getPropertyValue("--fpos-line")),a=v.getBoundingClientRect(),i=w(m),e=C();return[{x:n*i+a.x,y:o*e+a.y},{x:t*i+a.x,y:r*e+a.y}]},o=(e,t)=>{var r=Array.from(f.children);let n;var o=v.getBoundingClientRect();for(n of r){var a=parseFloat(n.style.getPropertyValue("--pos-x"))+o.x,i=parseFloat(n.style.getPropertyValue("--pos-y"))+o.y,l=parseFloat(n.style.getPropertyValue("--size-width")),s=parseFloat(n.style.getPropertyValue("--size-height"));if(a<e&&e<a+l&&i<t&&t<i+s)return[n,{sx:a,sy:i,ex:a+l,ey:i+s}]}return[void 0,{sx:0,sy:0,ex:0,ey:0}]},n=(e,t)=>{v.internalDrag&&!getSelection().isCollapsed&&j(v.ownerDocument,"delete",{keepZAction:!1});var r=v.dragCaret.getBoundingClientRect();P(r.x,r.y,r.x,r.y),j(v.ownerDocument,"insertHTML",{value:e,nameZAction:"DroppedElement"}),u=[];var[n,r]=R(v),o=n-e.length,n=r;A(o,n,$toNode=m),e=E(),c.contains(v.dragCaret)&&c.removeChild(v.dragCaret),v.dragging=!1,v.dragCaret=void 0,v.internalDrag=!1,v.textSelection={sx:0,sy:0,ex:0,ey:0},B({x:e.x,y:e.y+e.height/2},{}),r=Array.from(c.children).slice(-1)[0],B({x:e.x+e.width,y:e.y+e.height/2},{$caret:r}),s.focus()},H=e=>{var t=m.getBoundingClientRect();(e=e.target.getBoundingClientRect()).left>=t.left&&e.right<=t.right&&e.top>=t.top&&e.bottom<=t.bottom&&(v.dragging||(v.selecting=!1,c.innerHTML="",f.innerHTML="",v.dragging=!0,v.internalDrag=!0),s.focus())},X=e=>{e.preventDefault(),v.dragCaretPos={x:e.clientX,y:e.clientY};let[t,r]=B(v.dragCaretPos,{$caret:v.dragCaret,ctrlKey:!1,dragStyle:!0});v.dragCaretPos=t,r.classList.add("drag"),v.dragCaret=r},z=e=>{var t=m.getBoundingClientRect();(e=e.target.getBoundingClientRect()).left>=t.left&&e.right<=t.right&&e.top>=t.top&&e.bottom<=t.bottom||(s.blur(),v.dragging&&v.dragCaret&&(c.contains(v.dragCaret)&&c.removeChild(v.dragCaret),v.dragging=!1,v.dragCaret=void 0,v.internalDrag=!1))},Y=e=>{c.innerHTML="",f.innerHTML="";for(var t of e){var[r,n,o,a]=T(t.startOffset,t.endOffset),n=K(r,n,{ctrlKey:!0});t.startOffset!==t.endOffset&&K(o,a,{$caret:n,ctrlKey:!0})}},W=(t,{showUI:r=!1,value:n=null})=>{if(0<p){var e=h[p].caretsOffset;for(let e=0;e<h[p].zActions;e++)t.execCommand("undo",r,n);--p,Y(e)}},q=(t,{showUI:r=!1,value:n=null})=>{if(p<h.length-1){p+=1;for(let e=0;e<h[p].zActions;e++)t.execCommand("redo",r,n);var e=h[p].caretsOffset;Y(e)}},j=(e,r,{showUI:t=!1,value:n=null,keepZAction:o=!0,nameZAction:i=""})=>{if("undo"===r)return W(e,{showUI:t,value:n});if("redo"===r)return q(e,{showUI:t,value:n});if(e.execCommand(r,t,n),""===i&&(i=r),o){var l;let e=[];for(l of D()){var[s,d]=Z(l),[g,c,s,d]=I(s,d),[s,d]=k(g,c,s,d);e.push({startOffset:s,endOffset:d})}n=[...y,{commandName:r}],y=[],p+=1,o=h[0];let t=0;1e4<=h.length&&(t=1),a=[o,...h.slice(t+1,p)],p=h.length,h.push({comands:n,date:Date.now(),zActions:n.length,name:i,caretsOffset:e})}else y.push({commandName:r})},_=(e,t,r,{showUI:n=!1,value:o=null,keepZAction:a=!0,nameZAction:i=""})=>{var l=t.ownerDocument;let s=t.ownerDocument.defaultView,d=s.getSelection(),g=new Range;[t,e]=b(e,t),g.setStart(t,e),g.setEnd(t,e),d.removeAllRanges(),d.addRange(g),j(l,r,{showUI:n,value:o,keepZAction:a,nameZAction:i})},G=e=>{var t,r,n,o;if("A"===e.key.toUpperCase()&&(e.preventDefault(),[r,n,o]=U(O(),1/0),t=K(0,0,{}),K(r,n,{$caret:t})),"C"===e.key.toUpperCase()){let n,o=[];for(n of Array.from(c.children)){var[a,i]=Z(n);let[e,t,r]=L(a.x,a.y,i.x,i.y);r&&(l=e,e=t,t=l);var l=v.innerText.slice(e,t);o.push(l)}0!==o.length?(v.copiedText=o,navigator.clipboard.writeText(o.join("\n"))):console.error("Something was wrong")}"V"===e.key.toUpperCase()&&(u=[],f.innerHTML="",(async()=>{v.focus();let t=await navigator.clipboard.readText();var r=D();t=t.split("\n").length<r.length||t.split("\n").length>r.length?Array(r.length).fill(t):[t];for(let e=0;e<r.length;e++){var n=r[e],[o,a]=Z(n),[i,n,o,a]=I(o,a),[o,a]=k(i,n,o,a);((e,t,r,{showUI:n=!1,value:o=null,keepZAction:a=!0,nameZAction:i=""})=>{var l,s=r.ownerDocument;let d=r.ownerDocument.defaultView,g=d.getSelection(),c=new Range;[l,e]=b(e,r),[r,t]=b(t,r),c.setStart(l,e),c.setEnd(r,t),g.removeAllRanges(),g.addRange(c),j(s,"insertText",{showUI:n,value:o,keepZAction:a,nameZAction:i})})(o,a,v,{value:t[e]})}s.focus()})())},J=(t,e,{pressedEvent:r=!1})=>{if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","End","Home","PageUp","PageDown"].includes(t.key))e!==v&&(d(),(a=>{var i;a.preventDefault();for(i of D()){let o=parseInt(i.style.getPropertyValue("--max-pos-char"));var l=parseInt(i.style.getPropertyValue("--pos-char")),s=parseInt(i.style.getPropertyValue("--pos-line"));if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(a.key)){let e={ArrowLeft:(e,t)=>(--e<0&&(e=1/0,--t),[e,t]),ArrowRight:(e,t)=>[e+1,t],ArrowUp:(e,t)=>[e=Math.max(e,o),t-1],ArrowDown:(e,t)=>[e=Math.max(e,o),t+1]};var[d,g]=e[a.key](l,s);let[t,r,n]=U(g,d);n===1/0&&(r=l,t=s),o=["ArrowLeft","ArrowRight"].includes(a.key)?r:o,l=a.shiftKey?void 0:t,s=a.shiftKey?void 0:r,N(i,t,r,l,s,o)}else["End","Home","PageUp","PageDown"].includes(a.key)}F()})(t));else if(t.ctrlKey&&!r)l!==v&&G(t),"Z"===(i=t).key.toUpperCase()&&(u=[],i.preventDefault(),(i.shiftKey?q:W)(v.ownerDocument,{}));else if(!["Shift","CapsLock"].includes(t.key)&&e!==v){d(),s.editing=!0,D();for(let e=0;e<Array.from(c.children).length;e++){var n=Array.from(c.children)[e],[o,a]=Z(n);P(o.x,o.y,a.x,a.y),((e,{pressedEvent:o=!1})=>{if(u=[],e.target,["Shift","Alt"].includes(e.key))return e.preventDefault(),!1;if(o){if("Enter"===e.key)return j(v.ownerDocument,"insertText",{value:"\n"}),!0;if(1===e.key.length)return j(v.ownerDocument,"insertText",{value:e.key}),!0}else{if("Tab"===e.key){e.preventDefault();var a,i,[l,s]=R(v);if(e.shiftKey)if(l===s)"\t"===v.innerText[l-1]&&j(v.ownerDocument,"delete",{});else{let e=[];0<(o=v.innerText.slice(0,Math.min(l,s)).lastIndexOf("\n"))&&"\t"===v.innerText[o-1]&&e.push(o);let t=v.innerText.slice(Math.min(l,s),Math.max(l,s)),r=0;for(a of t.split("\n"))""!==a?("\t"===a[1]&&e.push(r),r+=a):r+=1;let n=0;for(i of e)n<e.length?_(i,v,"delete",{keepZAction:!1}):_(i,v,"delete",{nameZAction:"outdent multiple lines"}),n+=1}else l===s&&j(v.ownerDocument,"insertHTML",{value:"\t"});return!0}if("Backspace"===e.key)return j(v.ownerDocument,"delete",{}),!0;if("Delete"===e.key)return j(v.ownerDocument,"forwardDelete",{}),!0}return!1})(t,{pressedEvent:r})&&(t.preventDefault(),a=E(),B(a,{$caret:n,resetFirst:!0}))}}var i;e!==v&&(window.getSelection().removeAllRanges(),s.focus(),s.editing=!1)};(()=>{m.addEventListener("mousedown",e=>{v.dragging&&(c.contains(v.dragCaret)&&c.removeChild(v.dragCaret),v.dragging=!1,v.dragCaret=void 0,v.internalDrag=!1,v.textSelection={sx:0,sy:0,ex:0,ey:0});let[t,r]=o(e.clientX,e.clientY);var n;void 0!==t?(n=parseFloat(t.style.getPropertyValue("--size-height")),v.textSelection={sx:r.sx,sy:r.sy+n/2,ex:r.ex,ey:r.ey-n/2},v.selecting=!1,v.internalDrag=!0,v.initSelecting=!0):(d(),v.initSelecting=!0,B({x:e.clientX,y:e.clientY},{$caret:void 0,ctrlKey:e.ctrlKey}))},!0),m.addEventListener("mousemove",r=>{if(0!==r.which){if(v.initSelecting&&!v.internalDrag&&(v.initSelecting=!1,v.selecting=!0),v.selecting&&(e=c.lastChild,B({x:r.clientX,y:r.clientY},{$caret:e,wheelKey:2===r.which})),(v.internalDrag||v.dragging)&&1===r.which){var[e]=o(r.clientX,r.clientY);if(void 0===e){v.dragCaretPos={x:r.clientX,y:r.clientY};let[e,t]=B(v.dragCaretPos,{$caret:v.dragCaret,ctrlKey:!1,dragStyle:!0});v.dragCaretPos=e,t.classList.add("drag"),v.dragCaret=t}else c.contains(v.dragCaret)&&c.removeChild(v.dragCaret),v.dragging=!0,v.dragCaret=void 0,v.initSelecting=!1}}else v.selecting=!1},!0),m.addEventListener("mouseup",e=>{var t,r;v.selecting=!1,v.dragging?([r,t]=o(e.clientX,e.clientY),void 0===r?(f.innerHTML="",window.getSelection().removeAllRanges(),P(v.textSelection.sx,v.textSelection.sy,v.textSelection.ex,v.textSelection.ey),r=window.getSelection().toString(),n(r)):(v.dragging=!1,v.dragCaret=void 0,v.internalDrag=!1,v.textSelection={sx:0,sy:0,ex:0,ey:0})):!e.ctrlKey&&v.initSelecting?(v.initSelecting=!1,v.internalDrag=!1,d(),B({x:e.clientX,y:e.clientY},{$caret:void 0})):v.initSelecting=!1},!0),m.addEventListener("dragstart",function(e){e.preventDefault()},!1),s.addEventListener("mouseleave",e=>{v.dragging&&z(e)},!1),m.addEventListener("dragover",X,!1),m.addEventListener("dragenter",H,!1),m.addEventListener("dragleave",z,!1),m.addEventListener("drop",function(e){e.preventDefault(),e=e.dataTransfer.getData("Text"),v.internalDrag&&(f.innerHTML="",window.getSelection().removeAllRanges(),P(v.textSelection.sx,v.textSelection.sy,v.textSelection.ex,v.textSelection.ey)),n(e)},!1),s.addEventListener("blur",e=>{s.editing||(c.timeoutBlink&&clearTimeout(c.timeoutBlink),c.classList.remove("blink"),c.classList.add("nofocus"),f.classList.add("nofocus"))}),s.addEventListener("focus",e=>{c.classList.remove("nofocus"),f.classList.remove("nofocus"),d()}),v.addEventListener("change",e=>{u=[]}),s.addEventListener("keypress",e=>{J(e,e.target,{pressedEvent:!0})}),s.addEventListener("keydown",e=>{J(e,e.target,{})}),document.addEventListener("keydown",e=>{e.ctrlKey&&("Z"!==e.key.toUpperCase()&&"Y"!==e.key.toUpperCase()||e.preventDefault())});const e=new ResizeObserver(e=>{u=[],V(),(()=>{var e;for(e of D()){var[t,r]=(o=e,[parseFloat(o.style.getPropertyValue("--offset-start")),parseFloat(o.style.getPropertyValue("--offset-end"))]),[n,o,t,r]=T(t,r);N(e,t,r,n,o,r)}F()})()});e.observe(t)})()}
