function EditorSyntaxis(e={}){let s=e.$containerEditor,g=e.$inputRegex,c=e.$syntaxRegex;e=RegexHighlighter(g,c);{const u=(t,e)=>{var n=e.childNodes;let r=0,o=0;for(let e=0;e<n.length;e++){var a=n[e];if(t<=(o+=a.textContent.length))return[a,t-r];r+=a.textContent.length}},y=t=>{let n=0,r=0,o=!1;if("TEXTAREA"===t.nodeName)n=t.selectionStart,r=t.selectionEnd,o="backward"===t.selectionDirection;else{var a=void 0!==window.getSelection;if(a)if(0!==window.getSelection().rangeCount){let e=getSelection();a=e.anchorNode.compareDocumentPosition(e.focusNode);o=!1,(!a&&e.anchorOffset>e.focusOffset||a===Node.DOCUMENT_POSITION_PRECEDING)&&(o=!0);const i=window.getSelection().getRangeAt(0),l=i.cloneRange(),d=(l.selectNodeContents(t),l.setEnd(i.startContainer,i.startOffset),n=l.toString().length,i.cloneRange());d.selectNodeContents(t),d.setEnd(i.endContainer,i.endOffset),r=d.toString().length}}return o?[r,n]:[n,r]},n=()=>{let e=window.getComputedStyle(document.documentElement),t=e.getPropertyValue("--font-size");return parseFloat(t.substring(0,t.length-2))},i=(e=0)=>{0===e&&(e=n());let t=window.getComputedStyle(document.documentElement);return e*parseFloat(t.getPropertyValue("--line-height-ratio"))},p=(e,t)=>{let n=document.querySelector(".input-carets");return($caret=document.createElement("span")).classList.add("caret"),$caret.style.setProperty("--pos-char",e),$caret.style.setProperty("--pos-line",t),g.lastCaret=$caret,n.appendChild($caret),g.lastCaret},o=(n,r,o=void 0)=>{if(0===n&&0===r){let e=document.createRange(),t=window.getSelection();t.removeAllRanges(),e.setStart(o,n),e.setEnd(o,r),t.addRange(e)}else{n=Math.min(o.innerText.length,n),r=Math.min(o.innerText.length,r);var[a,n]=u(n,o),[i,r]=u(r,o);n=Math.min(o.innerText.length,n),r=Math.min(o.innerText.length,r);let e=document.createRange(),t=window.getSelection();t.removeAllRanges(),r<n?(e.setStart(i,r),e.setEnd(a,n),e.collapse(!1),t.addRange(e),t.extend(i,r)):(e.setStart(a,n),e.setEnd(i,r),t.addRange(e))}},a=(e,t)=>{o(e,t,$toNode=g)},f=(e,t,n,r,o)=>{var[e,t]=((e,t,n,r,o)=>{let a=document,i,l,d=null;var s;return void 0!==a.caretPositionFromPoint?(i=a.caretPositionFromPoint(e,t),l=a.caretPositionFromPoint(n,r),(d=a.createRange()).setStart(i.offsetNode,i.offset),d.setEnd(l.offsetNode,l.offset)):void 0!==a.caretRangeFromPoint&&(i=a.caretRangeFromPoint(e,t),l=a.caretRangeFromPoint(n,r),(d=a.createRange()).setStart(i.startContainer,i.startOffset),d.setEnd(l.startContainer,l.startOffset)),null!==d&&void 0!==window.getSelection?((s=window.getSelection()).removeAllRanges(),s.addRange(d)):void 0!==a.body.createTextRange&&((d=a.body.createTextRange()).moveToPoint(e,t),(s=d.duplicate()).moveToPoint(n,r),d.setEndPoint("EndToEnd",s),d.select()),y(o)})(e,t,n,r,o);a(e,t)},l=e=>{let t=document.createElement("span");t.innerText="0",t.style.opacity="0",e.appendChild(t);e=t.getBoundingClientRect().width;return t.remove(),e},t=(s.querySelector(".input").addEventListener("blur",e=>{s.querySelector(".input").editing||(s.querySelector(".input").querySelector(".input-carets").innerHTML="",g.lastCaret=void 0)}),(t,n=!1)=>{var r=(e=>{if(window.hasOwnProperty("selRects")||(window.selRects=[]),0===window.selRects.length){let e=window.getSelection(),t=(e.selectAllChildren(c),Array.from(e.getRangeAt(0).getClientRects()));e.removeAllRanges(),t=t.sort((e,t)=>e.y-t.y),window.selRects=t}let t;for(var n in window.selRects){n=window.selRects[n];e>=n.y&&(t=n)}return t})(t.y);if(void 0!==r){t={x:Math.min(t.x,r.x+r.width),y:r.y+r.width/2};var r=l(c),o=i(),a=g.getBoundingClientRect(),o=parseInt((t.y-a.y)/o),a=Math.round((t.x-a.x)/r);let e;n?void 0===g.dragCaret?(e=p(a,o),g.dragCaret=e):e=g.dragCaret:void 0===g.lastCaret?(e=p(a,o),g.lastCaret=e):e=g.lastCaret,e.style.setProperty("--pos-char",a),e.style.setProperty("--pos-line",o)}return t}),r=(c.addEventListener("mousedown",e=>{g.selecting=!0,g.firstCaretPos={x:e.clientX,y:e.clientY},g.firstCaretPos=t(g.firstCaretPos)},!0),c.addEventListener("mousemove",e=>{g.hasOwnProperty("selecting")||(g.selecting=!1),g.selecting&&(g.lastCaretPos={x:e.clientX,y:e.clientY},g.lastCaretPos=t(g.lastCaretPos))},!0),c.addEventListener("mouseup",e=>{g.selecting=!1},!0),c.addEventListener("dragstart",function(e){g.selecting=!1,g.dragging=!0},!1),c.addEventListener("dragover",function(e){e.preventDefault(),g.hasOwnProperty("dragging")||(g.dragging=!1),g.dragging&&(g.dragCaretPos={x:e.clientX,y:e.clientY},g.dragCaretPos=t(g.dragCaretPos,dragStyle=!0),g.dragCaret.classList.add("drag"))},!1),c.addEventListener("dragenter",function(e){var t=c.getBoundingClientRect(),e=e.target.getBoundingClientRect();e.left>=t.left&&e.right<=t.right&&e.top>=t.top&&e.bottom<=t.bottom&&!g.dragging&&(g.dragging=!0)},!1),s.addEventListener("dragleave",function(e){var t=c.getBoundingClientRect(),e=e.target.getBoundingClientRect();e.left>=t.left&&e.right<=t.right&&e.top>=t.top&&e.bottom<=t.bottom||g.dragging&&g.dragCaret&&(g.dragging=!1,s.querySelector(".input").querySelector(".input-carets").removeChild(g.dragCaret),g.dragCaret=void 0)},!1),c.addEventListener("drop",function(e){e.preventDefault();var t,n,e=e.dataTransfer.getData("Text"),r=g.dragCaret.getBoundingClientRect(),[r,e]=(f(r.x,r.y,r.x,r.y,c),document.execCommand("insertHTML",!1,e),y(g));r=r,e=e,o(r,e,$toNode=c),g.lastCaretPos={x:(r=window.getSelection().getRangeAt(0).getClientRects()).x,y:r.y},e=g.lastCaretPos,r=l(c),t=i(),n=g.getBoundingClientRect(),t=parseInt((e.y-n.y)/t),e=Math.round((e.x-n.x)/r),p(e,t),s.querySelector(".input").querySelector(".input-carets").removeChild(g.dragCaret),g.dragCaret=void 0},!1),(e,t)=>{window.selRects=[];if(t!==g){s.querySelector(".input").editing=!0;$inputCarets=s.querySelector(".input").querySelector(".input-carets");var n,r=Array.from($inputCarets.querySelectorAll(".caret"));for(n in r){let e=r[n];var o=parseInt(e.style.getPropertyValue("--pos-char")),a=parseInt(e.style.getPropertyValue("--pos-line")),i=e.getBoundingClientRect();f(i.x,i.y,i.x,i.y,c),p(o,a)}}if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","End","Home","PageUp","PageDown"].includes(e.key))t!==g&&e.preventDefault();else if(e.target,e.keyCode,9===e.keyCode){e.preventDefault();var[l,d]=y(g);if(e.shiftKey){let e=g.innerText.slice(0,l);if(-1!==e.lastIndexOf("\t")){let e=g.ownerDocument.defaultView,t=e.getSelection(),n=t.getRangeAt(0),[r,o]=u(o,g);n.setStart(r,o),n.setEnd(r,o+1),t.removeAllRanges(),t.addRange(n),document.execCommand("delete",!1,null)}}else if(l===d){let e=g.ownerDocument.defaultView,t=e.getSelection();t.getRangeAt(0);document.execCommand("insertHTML",!1,"\t")}}t!==g&&(window.getSelection().removeAllRanges(),s.querySelector(".input").focus(),s.querySelector(".input").editing=!1)});s.querySelector(".input").addEventListener("keydown",e=>{r(e,c)})}return{onInput:e.onInput}}