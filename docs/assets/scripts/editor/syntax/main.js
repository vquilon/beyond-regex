function EditorSyntaxis(e={}){let s=[{date:Date.now(),zActions:1,name:"init"}],d=0,C=e.$containerEditor,y=C.querySelector(".input-carets"),i=C.querySelector(".input-selects"),A=e.$inputRegex,b=e.$syntaxRegex,E=y.parentElement,t=C.querySelector("#editor-input");var n=RegexHighlighter(A,b);let g=void 0,a=(e.hasOwnProperty("debugInputClass")&&((g=document.createElement("div")).classList.add(e.debugInputClass),E.appendChild(g)),{});{const S=()=>{y.classList.remove("blink"),y.timeoutBlink&&clearTimeout(y.timeoutBlink),y.timeoutBlink=window.setTimeout(()=>{y.classList.add("blink")},500)},p=(t,e)=>{if(3===e.nodeType)return[e,t];var n=e.childNodes;let r=0,o=0,i=void 0;for(let e=0;e<n.length;e++){if(i=n[e],t<=(o+=i.textContent.length)){if(t-r>i.childNodes.length)return p(t-r,i);break}r+=i.textContent.length}return[i,t-r]},D=t=>{let n=0,r=0,o=!1;if("TEXTAREA"===t.nodeName)n=t.selectionStart,r=t.selectionEnd,o="backward"===t.selectionDirection;else{var i=void 0!==window.getSelection;if(i&&0!==window.getSelection().rangeCount){let e=getSelection();i=e.anchorNode.compareDocumentPosition(e.focusNode),o=!1,(!i&&e.anchorOffset>e.focusOffset||i===Node.DOCUMENT_POSITION_PRECEDING)&&(o=!0);const a=window.getSelection().getRangeAt(0),l=a.cloneRange(),s=(l.selectNodeContents(t),l.setEnd(a.startContainer,a.startOffset),n=l.toString().length,a.cloneRange());s.selectNodeContents(t),s.setEnd(a.endContainer,a.endOffset),r=s.toString().length}}return o?[r,n]:[n,r]},L=()=>(y=C.querySelector(".input").querySelector(".input-carets"),Array.from(y.querySelectorAll(".caret"))),l=()=>{let e=window.getComputedStyle(document.documentElement),t=e.getPropertyValue("--font-size");return parseFloat(t.substring(0,t.length-2))},M=e=>{if(e.hasOwnProperty("charWidth")&&e.charWidth)return e.charWidth;let t=document.createElement("span");t.innerText="0",t.style.opacity="0",e.appendChild(t);var n=t.getBoundingClientRect().width;return t.remove(),e.charWidth=n},k=(e=0)=>{0===e&&(e=l());let t=window.getComputedStyle(document.documentElement);return e*parseFloat(t.getPropertyValue("--line-height-ratio"))},c=(t,n,e=!1)=>{var r=Array.from(y.children);let o;for(let e=0;e<r.length;e++)if($caretAux=r[e],parseInt($caretAux.style.getPropertyValue("--pos-char"))===t&&parseInt($caretAux.style.getPropertyValue("--pos-line"))===n){o=$caretAux;break}return!o||e?((o=document.createElement("span")).classList.add("caret"),e=parseInt(o.style.getPropertyValue("--pos-char"))||0,e=Math.max(t,e),o.style.setProperty("--max-pos-char",e),o.style.setProperty("--pos-char",t),o.style.setProperty("--pos-line",n),y.appendChild(o)):(y.removeChild(o),o=void 0),o},u=t=>{var n=k(),r=A.getBoundingClientRect();i.innerHTML="";for(let e=0;e<t.length;e++){var o=t[e];($caretSelection=document.createElement("span")).classList.add("caret-selection"),$caretSelection.style.setProperty("--pos-x",o.x-r.x),$caretSelection.style.setProperty("--pos-y",o.y-r.y),$caretSelection.style.setProperty("--size-width",o.width),$caretSelection.style.setProperty("--size-height",n),i.append($caretSelection)}},o=(n,r,o=void 0)=>{if(0===n&&0===r){let e=document.createRange(),t=window.getSelection();t.removeAllRanges(),e.setStart(o,n),e.setEnd(o,r),t.addRange(e)}else{n=Math.min(o.innerText.length,n),r=Math.min(o.innerText.length,r);var[i,n]=p(n,o),[a,r]=p(r,o);n=Math.min(o.innerText.length,n),r=Math.min(o.innerText.length,r);let e=document.createRange(),t=window.getSelection();t.removeAllRanges(),r<n?(e.setStart(a,r),e.setEnd(i,n),e.collapse(!1),t.addRange(e),t.extend(a,r)):(e.setStart(i,n),e.setEnd(a,r),t.addRange(e))}},T=(e,t,n,r)=>{var[e,t]=((e,t,n,r)=>{let o=document,i,a,l=null;var s;return void 0!==o.caretPositionFromPoint?(i=o.caretPositionFromPoint(e,t),a=o.caretPositionFromPoint(n,r),(l=o.createRange()).setStart(i.offsetNode,i.offset),l.setEnd(a.offsetNode,a.offset)):void 0!==o.caretRangeFromPoint&&(i=o.caretRangeFromPoint(e,t),a=o.caretRangeFromPoint(n,r),(l=o.createRange()).setStart(i.startContainer,i.startOffset),l.setEnd(a.startContainer,a.startOffset)),null!==l&&void 0!==window.getSelection?((s=window.getSelection()).removeAllRanges(),s.addRange(l)):void 0!==o.body.createTextRange&&((l=o.body.createTextRange()).moveToPoint(e,t),(s=l.duplicate()).moveToPoint(n,r),l.setEndPoint("EndToEnd",s),l.select()),D(b)})(e,t,n,r);return n=e,r=t,o(n,r,$toNode=A),[e,t]},I=()=>{var e=window.getSelection().getRangeAt(0).getClientRects()[0];return{x:e.x,y:e.y}},f=(e,t)=>{var n=l(),r=k(n),n=([n=0]=[n],0===n&&(n=l()),a.hasOwnProperty(n)||(a[n]=M(b)),a[n]),o=A.getBoundingClientRect();return caretPosX=n*e+o.x,caretPosY=r*t+o.y,[caretPosX,caretPosY]},B=(C.querySelector(".input").addEventListener("blur",e=>{C.querySelector(".input").editing||(y.classList.add("nofocus"),i.classList.add("nofocus"))}),C.querySelector(".input").addEventListener("focus",e=>{y.classList.remove("nofocus"),i.classList.remove("nofocus")}),()=>{var e,t,n,r=A.getBoundingClientRect();let o=window.getSelection(),i=(o.selectAllChildren(b),Array.from(o.getRangeAt(0).getClientRects())),a=(o.removeAllRanges(),i=i.sort((e,t)=>e.y-t.y),window.selRects=[],window.newLines={},0===i.length&&i.push({bottom:r.bottom,height:r.height,left:r.left,right:r.left,top:r.top,width:0,x:r.x,y:r.y}),i[0].y),l={bottom:0,height:0,left:1/0,right:0,top:1/0,width:0,x:1/0,y:0};for(s in i){var s=parseInt(s),d=i[s];d.y>a&&(a=d.y,l.width=l.right-l.left,l.height=l.bottom-l.top,window.selRects.push(l),l={bottom:0,height:0,left:1/0,right:0,top:1/0,width:0,x:1/0,y:0}),l={bottom:Math.max(d.bottom,l.bottom),left:Math.min(d.left,l.left),right:Math.max(d.right,l.right),top:Math.min(d.top,l.top),x:Math.min(d.x,l.x),y:Math.max(d.y,l.y)},s>=i.length-1&&(l.width=l.right-l.left,l.height=l.bottom-l.top,window.selRects.push(l))}for(e of window.selRects)e.y-=r.y,e.x-=r.x,e.top-=r.top,e.bottom=e.height+e.top,e.left-=r.left,e.right=e.width+e.left;if("\n\n"===A.textContent.slice(-2)&&(t=window.selRects[window.selRects.length-1],n=window.selRects[0],window.selRects.push({bottom:t.bottom+n.top+t.height,height:t.height,left:t.left,right:t.left,top:t.bottom+n.top,width:0,x:t.x,y:t.bottom+n.top})),void 0!==g){g.innerHTML="";for(var c of window.selRects){let e=document.createElement("span");e.style.width=c.width+"px",e.style.height=c.height+"px",e.style.left=c.left+"px",e.style.top=c.top+"px",e.style.position="absolute",e.style.background="#0000ff1f",e.classList.add("boxSel"),g.appendChild(e)}}}),O=(e,t=!1)=>{window.hasOwnProperty("selRects")||(window.selRects=[]),0===window.selRects.length&&B();let n;for(var r in window.selRects)e>=(r=window.selRects[r]).y&&(n=r);return n&&(n=Object.keys(n).reduce((e,t)=>(e[t]=n[t],e),{}),t&&(t=A.getBoundingClientRect(),n.y+=t.y,n.x+=t.x,n.top+=t.top,n.bottom+=t.top,n.left+=t.left,n.right+=t.left)),n},r=(e,t=void 0,n=!1,r=!1)=>{var o,i,a=A.getBoundingClientRect();return void 0!==(a=(e.x,e.y,e={x:e.x-a.x,y:e.y-a.y},O(e.y)))&&(e={x:Math.min(e.x,a.x+a.width),y:a.y+a.height/2},a=void 0===t,i=M(b),o=k(),o=parseInt(e.y/o),i=Math.round(e.x/i),void 0===t&&(n||r||(y.innerHTML=""),t=c(i,o,r),r&&(t.classList.add("drag"),A.dragCaret=t)),void 0!==t&&(n=parseInt(t.style.getPropertyValue("--pos-char"))||0,n=Math.max(i,n),t.style.setProperty("--max-pos-char",n),t.style.setProperty("--pos-char",i),t.style.setProperty("--pos-line",o),a?(t.style.setProperty("--fpos-char",i),t.style.setProperty("--fpos-line",o)):r||V())),e},V=()=>{var t=Array.from(y.children),n=k();let r,o=[];for(let e=0;e<t.length;e++){r=t[e];var i=parseInt(r.style.getPropertyValue("--fpos-line")),a=parseInt(r.style.getPropertyValue("--pos-line")),[l,s]=f(parseInt(r.style.getPropertyValue("--fpos-char")),i),[d,c]=f(parseInt(r.style.getPropertyValue("--pos-char")),a);if(a!==i){let e=!1;a<i&&(e=!0);var g=O(i*n+n/2,absolutePos=!0),p=O(a*n+n/2,absolutePos=!0);if(g&&p&&(e?(o.push({top:s,bottom:s+n,height:n,width:l-g.left,left:g.left,right:l,x:g.left,y:s}),o.push({bottom:p.bottom,top:p.top,height:n,width:p.right-d,left:d,right:p.right,x:d,y:p.y})):(o.push({top:g.top,bottom:g.bottom,height:n,width:g.right-l,left:l,right:g.right,x:l,y:g.y}),o.push({top:p.top,bottom:p.bottom,height:n,width:d-p.left,left:p.left,right:d,x:p.x,y:p.y}))),0<Math.abs(a-i))for(let e=Math.min(i,a)+1;e<Math.max(i,a);e++){var h=O(e*n+n/2,absolutePos=!0);h&&o.push(h)}}else{p=d<l;o.push({top:c,bottom:c+n,height:n,width:Math.abs(d-l),left:p?d:l,right:p?l:d,x:p?d:l,y:c})}}u(o)},$=(b.addEventListener("mousedown",e=>{S(),A.selecting=!0,r({x:e.clientX,y:e.clientY},$caret=void 0,ctrlKey=e.ctrlKey)},!0),b.addEventListener("mousemove",e=>{var t;A.hasOwnProperty("selecting")||1!==e.which||(A.selecting=!1),A.selecting&&(t=Array.from(y.children),r({x:e.clientX,y:e.clientY},$caret=t[t.length-1],ctrlKey=e.ctrlKey))},!0),b.addEventListener("mouseup",e=>{A.selecting=!1},!0),b.addEventListener("dragstart",function(e){A.selecting=!1,A.dragging=!0,A.internalDrag=!0},!1),b.addEventListener("dragover",function(e){e.preventDefault(),A.hasOwnProperty("dragging")||(A.dragging=!1),A.dragging&&(A.dragCaretPos={x:e.clientX,y:e.clientY},A.dragCaretPos=r(A.dragCaretPos,$caret=A.dragCaret,firstCaret=!1,dragStyle=!0))},!1),b.addEventListener("dragenter",function(e){var t=b.getBoundingClientRect();(e=e.target.getBoundingClientRect()).left>=t.left&&e.right<=t.right&&e.top>=t.top&&e.bottom<=t.bottom&&!A.dragging&&(A.dragging=!0)},!1),C.addEventListener("dragleave",function(e){var t=b.getBoundingClientRect();(e=e.target.getBoundingClientRect()).left>=t.left&&e.right<=t.right&&e.top>=t.top&&e.bottom<=t.bottom||A.dragging&&A.dragCaret&&(y.contains(A.dragCaret)&&y.removeChild(A.dragCaret),A.dragging=!1,A.dragCaret=void 0)},!1),b.addEventListener("drop",function(e){e.preventDefault(),customZActions=0,A.internalDrag&&(Z(A.ownerDocument,["delete"],!1,null,keepZAction=!1,customZActions=0),customZActions++);var t,n,e=e.dataTransfer.getData("Text"),r=A.dragCaret.getBoundingClientRect(),[r,e]=(T(r.x,r.y,r.x,r.y),Z(A.ownerDocument,["insertHTML"],!1,e,keepZAction=!0,customZActions+=1,nameZAction="DroppedElement"),D(A));e=r=(o(r,e,$toNode=b),I()),r=M(b),t=k(),n=A.getBoundingClientRect(),t=parseInt((e.y-n.y)/t),e=Math.round((e.x-n.x)/r),c(e,t),y.contains(A.dragCaret)&&y.removeChild(A.dragCaret),A.dragging=!1,A.dragCaret=void 0,A.internalDrag=!1},!1),(t,n=!1,r=null)=>{if(0<d){for(let e=0;e<s[d].zActions;e++)t.execCommand("undo",n,r);--d}}),N=(t,n=!1,r=null)=>{if(d<s.length-1){d+=1;for(let e=0;e<s[d].zActions;e++)t.execCommand("redo",n,r)}},Z=(e,t,n=!1,r=null,o=!0,i=0,a="")=>{for(var l of t){if("undo"===l)return $(e,n,r);if("redo"===l)return N(e,n,r);e.execCommand(l,n,r)}0===i&&(i=t.length),""===a&&(a=t.join("_")),o&&(d+=1,s.push({date:Date.now(),zActions:i,name:a}))},q=(e,t,n,r=!1,o=null,i=!0,a=0,l="")=>{let s=t.ownerDocument;t.ownerDocument.defaultView;let d=s.getSelection(),c=d.getRangeAt(0);[t,e]=p(e,t),c.setStart(t,e),c.setEnd(t,e),d.removeAllRanges(),d.addRange(c),Z(s,n,r,o,noZAction,i,a,l)},h=(t,e)=>{var n=M(b),r=k();if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","End","Home","PageUp","PageDown"].includes(t.key)){if(e!==A){S();var a=t;a.preventDefault();var l,s=L();for(l in s){let o=s[l],i=parseInt(o.style.getPropertyValue("--max-pos-char"));var d=parseInt(o.style.getPropertyValue("--pos-char")),c=parseInt(o.style.getPropertyValue("--pos-line"));if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(a.key)){let e={ArrowLeft:(e,t)=>(--e<0&&(e=1/0,--t),[e,t]),ArrowRight:(e,t)=>[e+1,t],ArrowUp:(e,t)=>[e=Math.max(e,i),t-1],ArrowDown:(e,t)=>[e=Math.max(e,i),t+1]};var[g,p]=e[a.key](d,c);let[t,n,r]=((e,t)=>{var n=M(b),r=k(),o=(0===window.selRects.length&&B(),window.selRects.length-1);let i=o<t?o:t;if(i=Math.max(i,0),!(r=O(i*r+r/2)))return[e,1/0,t];t=Math.round((r.x+r.width)/n);let a=Math.min(e,t);return e!==1/0&&t<e&&i!=o&&(i+=1,a=0),[a,t,i]})(g,p);n===1/0&&(t=d,r=c,limitCaretChar),["ArrowLeft","ArrowRight"].includes(a.key)&&o.style.setProperty("--max-pos-char",t),o.style.setProperty("--pos-char",t),o.style.setProperty("--pos-line",r),a.shiftKey||(o.style.setProperty("--fpos-char",t),o.style.setProperty("--fpos-line",r))}else["End","Home","PageUp","PageDown"].includes(a.key)}V()}}else if(t.ctrlKey){var o=t;if("Z"===o.key.toUpperCase()&&(o.preventDefault(),(o.shiftKey?N:$)(A.ownerDocument)),"A"===o.key.toUpperCase()){o.preventDefault();let e=window.getSelection();e.selectAllChildren(b)}}else if(S(),e!==A){C.querySelector(".input").editing=!0;var i,h=L();for(i in h){let e=h[i];var y=parseInt(e.style.getPropertyValue("--pos-char")),u=parseInt(e.style.getPropertyValue("--pos-line")),f=parseFloat(e.style.getPropertyValue("--fpos-char")),m=parseFloat(e.style.getPropertyValue("--fpos-line")),f={x:f*n+(v=A.getBoundingClientRect()).x,y:m*r+v.y},m={x:y*n+v.x,y:u*r+v.y},w=(T(f.x,f.y,m.x,m.y),P=x=R=f=v=void 0,t);if(window.selRects=[],w.target,"Tab"===w.key){w.preventDefault();var[v,f]=D(A);if(w.shiftKey)if(v===f)"\t"===A.innerText[v-1]&&Z(A.ownerDocument,["delete"],!1,null);else{let e=[];var x,P,R=A.innerText.slice(0,Math.min(v,f)).lastIndexOf("\n");0<R&&"\t"===A.innerText[R-1]&&e.push(R);let t=A.innerText.slice(Math.min(v,f),Math.max(v,f)),n=0;for(x of t.split("\n"))""!==x?("\t"===x[1]&&e.push(n),n+=x):n+=1;let r=0;for(P of e)r<e.length?q(P,A,["delete"],keepZAction=!1):q(P,A,["delete"],keepZAction=!0,customZActions=e.length,nameZAction="outdent multiple lines"),r+=1}else v===f&&Z(A.ownerDocument,["insertHTML"],!1,"\t")}else"Enter"===w.key?Z(A.ownerDocument,["insertHTML"],!1,"\n"):"Backspace"===w.key?Z(A.ownerDocument,["delete"],!1):"Delete"===w.key?Z(A.ownerDocument,["forwardDelete"],!1):1==w.key.length&&(Z(A.ownerDocument,["insertHTML"],!1,w.key),w.preventDefault());[y,u]=(R=I(),f=w=v=void 0,v=M(b),f=k(),w=A.getBoundingClientRect(),f=parseInt((R.y-w.y)/f),[Math.round((R.x-w.x)/v),f]),e.style.setProperty("--pos-char",y),e.style.setProperty("--pos-line",u),e.style.setProperty("--fpos-char",y),e.style.setProperty("--fpos-line",u),V()}}e!==A&&(window.getSelection().removeAllRanges(),E.focus(),E.editing=!1)},m=(A.addEventListener("change",e=>{window.selRects=[]}),E.addEventListener("keydown",e=>{h(e,e.target)}),document.addEventListener("keydown",e=>{!e.ctrlKey||"Z"!==e.key.toUpperCase()&&"Y"!==e.key.toUpperCase()||e.preventDefault()}),new ResizeObserver(e=>{window.selRects=[]}));m.observe(t)}return{onInput:n.onInput}}