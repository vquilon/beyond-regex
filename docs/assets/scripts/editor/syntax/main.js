function EditorSyntaxis(e={}){let s=[{date:Date.now(),zActions:1,name:"init"}],d=0,C=e.$containerEditor,l=C.querySelector(".input-carets"),P=e.$inputRegex,A=e.$syntaxRegex,E=l.parentElement,t=C.querySelector("#editor-input");var n=RegexHighlighter(P,A);let u=!1,y=void 0;e.hasOwnProperty("debugInputClass")&&(u=!0,(y=document.createElement("div")).classList.add(e.debugInputClass),E.appendChild(y));{const S=()=>{l.classList.remove("blink"),l.timeoutBlink&&clearTimeout(l.timeoutBlink),l.timeoutBlink=window.setTimeout(()=>{l.classList.add("blink")},500)},g=(t,e)=>{if(3===e.nodeType)return[e,t];var n=e.childNodes;let r=0,o=0,i=void 0;for(let e=0;e<n.length;e++){if(i=n[e],t<=(o+=i.textContent.length)){if(t-r>i.childNodes.length)return g(t-r,i);break}r+=i.textContent.length}return[i,t-r]},b=t=>{let n=0,r=0,o=!1;if("TEXTAREA"===t.nodeName)n=t.selectionStart,r=t.selectionEnd,o="backward"===t.selectionDirection;else{var i=void 0!==window.getSelection;if(i&&0!==window.getSelection().rangeCount){let e=getSelection();i=e.anchorNode.compareDocumentPosition(e.focusNode),o=!1,(!i&&e.anchorOffset>e.focusOffset||i===Node.DOCUMENT_POSITION_PRECEDING)&&(o=!0);const a=window.getSelection().getRangeAt(0),l=a.cloneRange(),s=(l.selectNodeContents(t),l.setEnd(a.startContainer,a.startOffset),n=l.toString().length,a.cloneRange());s.selectNodeContents(t),s.setEnd(a.endContainer,a.endOffset),r=s.toString().length}}return o?[r,n]:[n,r]},D=()=>(l=C.querySelector(".input").querySelector(".input-carets"),Array.from(l.querySelectorAll(".caret"))),r=()=>{let e=window.getComputedStyle(document.documentElement),t=e.getPropertyValue("--font-size");return parseFloat(t.substring(0,t.length-2))},M=(e=0)=>{if(P.hasOwnProperty("fontSize")&&P.fontSize)return P.fontSize;0===e&&(e=r());let t=window.getComputedStyle(document.documentElement);return e*parseFloat(t.getPropertyValue("--line-height-ratio"))},c=(t,n,e=!1)=>{var r=Array.from(l.children);let o;for(let e=0;e<r.length;e++)if($caretAux=r[e],parseInt($caretAux.style.getPropertyValue("--pos-char"))===t&&parseInt($caretAux.style.getPropertyValue("--pos-line"))===n){o=$caretAux;break}return!o||e?((o=document.createElement("span")).classList.add("caret"),e=parseInt(o.style.getPropertyValue("--pos-char"))||0,e=Math.max(t,e),o.style.setProperty("--max-pos-char",e),o.style.setProperty("--pos-char",t),o.style.setProperty("--pos-line",n),l.appendChild(o)):(l.removeChild(o),o=void 0),o},f=(e,t,n,r)=>{let o=document,i,a,l=null;var s;return void 0!==o.caretPositionFromPoint?(i=o.caretPositionFromPoint(e,t),a=o.caretPositionFromPoint(n,r),(l=o.createRange()).setStart(i.offsetNode,i.offset),l.setEnd(a.offsetNode,a.offset)):void 0!==o.caretRangeFromPoint&&(i=o.caretRangeFromPoint(e,t),a=o.caretRangeFromPoint(n,r),(l=o.createRange()).setStart(i.startContainer,i.startOffset),l.setEnd(a.startContainer,a.startOffset)),null!==l&&void 0!==window.getSelection?((s=window.getSelection()).removeAllRanges(),s.addRange(l)):void 0!==o.body.createTextRange&&((l=o.body.createTextRange()).moveToPoint(e,t),(s=l.duplicate()).moveToPoint(n,r),l.setEndPoint("EndToEnd",s),l.select()),b(A)},o=(n,r,o=void 0)=>{if(0===n&&0===r){let e=document.createRange(),t=window.getSelection();t.removeAllRanges(),e.setStart(o,n),e.setEnd(o,r),t.addRange(e)}else{n=Math.min(o.innerText.length,n),r=Math.min(o.innerText.length,r);var[i,n]=g(n,o),[a,r]=g(r,o);n=Math.min(o.innerText.length,n),r=Math.min(o.innerText.length,r);let e=document.createRange(),t=window.getSelection();t.removeAllRanges(),r<n?(e.setStart(a,r),e.setEnd(i,n),e.collapse(!1),t.addRange(e),t.extend(a,r)):(e.setStart(i,n),e.setEnd(a,r),t.addRange(e))}},T=(e,t,n,r)=>{var[e,t]=f(e,t,n,r);return n=e,r=t,o(n,r,$toNode=P),[e,t]},L=()=>{var e=window.getSelection().getRangeAt(0).getClientRects()[0];return{x:e.x,y:e.y}},k=e=>{if(e.hasOwnProperty("charWidth")&&e.charWidth)return e.charWidth;let t=document.createElement("span");t.innerText="0",t.style.opacity="0",e.appendChild(t);var n=t.getBoundingClientRect().width;return t.remove(),e.charWidth=n},I=(C.querySelector(".input").addEventListener("blur",e=>{C.querySelector(".input").editing||(C.querySelector(".input").querySelector(".input-carets").innerHTML="")}),()=>{var t,e,n,r,o=P.getBoundingClientRect();let i=window.getSelection(),a=(i.selectAllChildren(A),Array.from(i.getRangeAt(0).getClientRects())),l=(i.removeAllRanges(),a=a.sort((e,t)=>e.y-t.y),window.selRects=[],window.newLines={},0===a.length&&a.push({bottom:o.bottom,height:o.height,left:o.left,right:o.left,top:o.top,width:0,x:o.x,y:o.y}),a[0].y),s={bottom:0,height:0,left:1/0,right:0,top:1/0,width:0,x:1/0,y:0};for(d in a){var d=parseInt(d),c=a[d];c.y>l&&(l=c.y,s.width=s.right-s.left,s.height=s.bottom-s.top,window.selRects.push(s),s={bottom:0,height:0,left:1/0,right:0,top:1/0,width:0,x:1/0,y:0}),s={bottom:Math.max(c.bottom,s.bottom),left:Math.min(c.left,s.left),right:Math.max(c.right,s.right),top:Math.min(c.top,s.top),x:Math.min(c.x,s.x),y:Math.max(c.y,s.y)},d>=a.length-1&&(s.width=s.right-s.left,s.height=s.bottom-s.top,window.selRects.push(s))}for(t of window.selRects.sort((e,t)=>e.y-t.y)){var g=(t.top+t.bottom)/2,[g,p]=f(t.left+1,g,t.right,g);let e=!1;"\n"===P.innerText[p+1]&&(e=!0),u&&console.log("LINE",g,p,e),window.getSelection().removeAllRanges()}for(e of window.selRects)e.y-=o.y,e.x-=o.x,e.top-=o.top,e.bottom=e.height+e.top,e.left-=o.left,e.right=e.width+e.left;if("\n\n"===P.textContent.slice(-2)&&(n=window.selRects[window.selRects.length-1],r=window.selRects[0],window.selRects.push({bottom:n.bottom+r.top+n.height,height:n.height,left:n.left,right:n.left,top:n.bottom+r.top,width:0,x:n.x,y:n.bottom+r.top})),void 0!==y){y.innerHTML="";for(var h of window.selRects){let e=document.createElement("span");e.style.width=h.width+"px",e.style.height=h.height+"px",e.style.left=h.left+"px",e.style.top=h.top+"px",e.style.position="absolute",e.style.background="#0000ff1f",e.classList.add("boxSel"),y.appendChild(e)}}}),O=e=>{window.hasOwnProperty("selRects")||(window.selRects=[]),0===window.selRects.length&&I();let t;for(var n in window.selRects)e>=(n=window.selRects[n]).y&&(t=n);return t},i=(e,t=void 0,n=!1,r=!1)=>{var o,i,a=P.getBoundingClientRect();return e.x,e.y,e={x:e.x-a.x,y:e.y-a.y},void 0!==(a=O(e.y))&&(e={x:Math.min(e.x,a.x+a.width),y:a.y+a.height/2},a=void 0===t,i=k(A),o=M(),o=parseInt(e.y/o),i=Math.round(e.x/i),void 0===t&&(n||r||(l.innerHTML=""),t=c(i,o,r),r&&(P.dragCaret=t)),void 0!==t&&(n=parseInt(t.style.getPropertyValue("--pos-char"))||0,r=Math.max(i,n),t.style.setProperty("--max-pos-char",r),t.style.setProperty("--pos-char",i),t.style.setProperty("--pos-line",o),a&&(t.style.setProperty("--fpos-char",i),t.style.setProperty("--fpos-line",o)))),e},N=(A.addEventListener("mousedown",e=>{S(),P.selecting=!0,i({x:e.clientX,y:e.clientY},$caret=void 0,ctrlKey=e.ctrlKey)},!0),A.addEventListener("mousemove",e=>{var t;P.hasOwnProperty("selecting")||(P.selecting=!1),P.selecting&&(t=Array.from(l.children),i({x:e.clientX,y:e.clientY},$caret=t[t.length-1],ctrlKey=e.ctrlKey))},!0),A.addEventListener("mouseup",e=>{P.selecting=!1},!0),A.addEventListener("dragstart",function(e){P.selecting=!1,P.dragging=!0,P.internalDrag=!0},!1),A.addEventListener("dragover",function(e){e.preventDefault(),P.hasOwnProperty("dragging")||(P.dragging=!1),P.dragging&&(P.dragCaretPos={x:e.clientX,y:e.clientY},P.dragCaretPos=i(P.dragCaretPos,firstCaret=!1,dragStyle=!0),P.dragCaret.classList.add("drag"))},!1),A.addEventListener("dragenter",function(e){var t=A.getBoundingClientRect();(e=e.target.getBoundingClientRect()).left>=t.left&&e.right<=t.right&&e.top>=t.top&&e.bottom<=t.bottom&&!P.dragging&&(P.dragging=!0)},!1),C.addEventListener("dragleave",function(e){var t=A.getBoundingClientRect();(e=e.target.getBoundingClientRect()).left>=t.left&&e.right<=t.right&&e.top>=t.top&&e.bottom<=t.bottom||P.dragging&&P.dragCaret&&(l.contains(P.dragCaret)&&l.removeChild(P.dragCaret),P.dragging=!1,P.dragCaret=void 0)},!1),A.addEventListener("drop",function(e){e.preventDefault(),customZActions=0,P.internalDrag&&(V(P.ownerDocument,["delete"],!1,null,keepZAction=!1,customZActions=0),customZActions++);var t,n,e=e.dataTransfer.getData("Text"),r=P.dragCaret.getBoundingClientRect(),[r,e]=(T(r.x,r.y,r.x,r.y),V(P.ownerDocument,["insertHTML"],!1,e,keepZAction=!0,customZActions+=1,nameZAction="DroppedElement"),b(P));o(r,e,$toNode=A),e=r=L(),r=k(A),t=M(),n=P.getBoundingClientRect(),t=parseInt((e.y-n.y)/t),e=Math.round((e.x-n.x)/r),c(e,t),l.contains(P.dragCaret)&&l.removeChild(P.dragCaret),P.dragging=!1,P.dragCaret=void 0,P.internalDrag=!1},!1),(t,n=!1,r=null)=>{if(0<d){for(let e=0;e<s[d].zActions;e++)t.execCommand("undo",n,r);--d}}),B=(t,n=!1,r=null)=>{if(d<s.length-1){d+=1;for(let e=0;e<s[d].zActions;e++)t.execCommand("redo",n,r)}},V=(e,t,n=!1,r=null,o=!0,i=0,a="")=>{for(var l of t){if("undo"===l)return N(e,n,r);if("redo"===l)return B(e,n,r);e.execCommand(l,n,r)}0===i&&(i=t.length),""===a&&(a=t.join("_")),o&&(d+=1,s.push({date:Date.now(),zActions:i,name:a}))},Z=(e,t,n,r=!1,o=null,i=!0,a=0,l="")=>{let s=t.ownerDocument,d=(t.ownerDocument.defaultView,s.getSelection()),c=d.getRangeAt(0);[t,e]=g(e,t),c.setStart(t,e),c.setEnd(t,e),d.removeAllRanges(),d.addRange(c),V(s,n,r,o,noZAction,i,a,l)},a=(t,e)=>{var n,r=k(A),o=M();if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","End","Home","PageUp","PageDown"].includes(t.key)){if(e!==P){S();var a=t;a.preventDefault();var l,s=D();for(l in s){let o=s[l],i=parseInt(o.style.getPropertyValue("--max-pos-char"));var d=parseInt(o.style.getPropertyValue("--pos-char")),c=parseInt(o.style.getPropertyValue("--pos-line"));if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(a.key)){let e={ArrowLeft:(e,t)=>(--e<0&&(e=1/0,--t),[e,t]),ArrowRight:(e,t)=>[e+1,t],ArrowUp:(e,t)=>[e=Math.max(e,i),t-1],ArrowDown:(e,t)=>[e=Math.max(e,i),t+1]};var[g,p]=e[a.key](d,c);let[t,n,r]=((e,t)=>{var n=k(A),r=M(),o=(0===window.selRects.length&&I(),window.selRects.length-1);let i=o<t?o:t;if(i=Math.max(i,0),!(r=O(i*r+r/2)))return[e,1/0,t];t=Math.round((r.x+r.width)/n);let a=Math.min(e,t);return e!==1/0&&t<e&&i!=o&&(i+=1,a=0),[a,t,i]})(g,p);n===1/0&&(t=d,r=c,limitCaretChar),["ArrowLeft","ArrowRight"].includes(a.key)&&o.style.setProperty("--max-pos-char",t),o.style.setProperty("--pos-char",t),o.style.setProperty("--pos-line",r),a.shiftKey||(o.style.setProperty("--fpos-char",t),o.style.setProperty("--fpos-line",r))}else["End","Home","PageUp","PageDown"].includes(a.key)}}}else if(t.ctrlKey)(n=t).preventDefault(),"Z"===n.key.toUpperCase()&&(n.shiftKey?B:N)(P.ownerDocument);else if(S(),e!==P){C.querySelector(".input").editing=!0;var i,h=D();for(i in h){let e=h[i];var u=parseInt(e.style.getPropertyValue("--pos-char")),y=parseInt(e.style.getPropertyValue("--pos-line")),f=parseFloat(e.style.getPropertyValue("--fpos-char")),m=parseFloat(e.style.getPropertyValue("--fpos-line")),f={x:f*r+(v=P.getBoundingClientRect()).x,y:m*o+v.y},m={x:u*r+v.x,y:y*o+v.y},w=(T(f.x,f.y,m.x,m.y),R=x=m=f=v=void 0,t);if(window.selRects=[],w.target,"Tab"===w.key){w.preventDefault();var[v,f]=b(P);if(w.shiftKey)if(v===f)"\t"===P.innerText[v-1]&&V(P.ownerDocument,["delete"],!1,null);else{let e=[];var x,R,m=P.innerText.slice(0,Math.min(v,f)).lastIndexOf("\n");0<m&&"\t"===P.innerText[m-1]&&e.push(m);let t=P.innerText.slice(Math.min(v,f),Math.max(v,f)),n=0;for(x of t.split("\n"))""!==x?("\t"===x[1]&&e.push(n),n+=x):n+=1;let r=0;for(R of e)r<e.length?Z(R,P,["delete"],keepZAction=!1):Z(R,P,["delete"],keepZAction=!0,customZActions=e.length,nameZAction="outdent multiple lines"),r+=1}else v===f&&V(P.ownerDocument,["insertHTML"],!1,"\t")}else"Enter"===w.key?V(P.ownerDocument,["insertHTML"],!1,"\n"):"Backspace"===w.key?V(P.ownerDocument,["delete"],!1):"Delete"===w.key?V(P.ownerDocument,["forwardDelete"],!1):1==w.key.length&&(V(P.ownerDocument,["insertHTML"],!1,w.key),w.preventDefault());[u,y]=(m=L(),f=w=v=void 0,v=k(A),f=M(),w=P.getBoundingClientRect(),f=parseInt((m.y-w.y)/f),[Math.round((m.x-w.x)/v),f]),e.style.setProperty("--pos-char",u),e.style.setProperty("--pos-line",y),e.style.setProperty("--fpos-char",u),e.style.setProperty("--fpos-line",y)}}e!==P&&(window.getSelection().removeAllRanges(),E.focus(),E.editing=!1)},p=(P.addEventListener("change",e=>{window.selRects=[]}),E.addEventListener("keydown",e=>{a(e,e.target)}),document.addEventListener("keydown",e=>{!e.ctrlKey||"Z"!==e.key.toUpperCase()&&"Y"!==e.key.toUpperCase()||e.preventDefault()}),new ResizeObserver(e=>{window.selRects=[]}));p.observe(t)}return{onInput:n.onInput}}