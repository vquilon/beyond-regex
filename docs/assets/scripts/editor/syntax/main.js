function EditorSyntaxis(e={}){let c=[{date:Date.now(),zActions:1,name:"init"}],S=0,D=e.$containerEditor,L=D.querySelector(".input-carets"),M=D.querySelector(".input-selects"),k=e.$inputRegex,T=e.$syntaxRegex,I=L.parentElement,$=D.querySelector("#editor-input");var t=RegexHighlighter(k,T);let B=void 0;e.hasOwnProperty("debugInputClass")&&(B=document.createElement("div"),B.classList.add(e.debugInputClass),I.appendChild(B));let O={};return(()=>{const p=()=>{L.classList.remove("blink"),L.timeoutBlink&&clearTimeout(L.timeoutBlink),L.timeoutBlink=window.setTimeout(()=>{L.classList.add("blink")},500)},g=(t,e)=>{if(3===e.nodeType)return[e,t];var n=e.childNodes;let o=0,r=0,i=void 0;for(let e=0;e<n.length;e++){if(i=n[e],r+=i.textContent.length,t<=r){if(t-o>i.childNodes.length)return g(t-o,i);break}o+=i.textContent.length}return[i,t-o]},h=e=>{let t=0,n=0,o=!1;if("TEXTAREA"===e.nodeName)t=e.selectionStart,n=e.selectionEnd,o="backward"===e.selectionDirection;else if(void 0!==window.getSelection){const i=window.getSelection();if(0!==i.rangeCount){var r=i.anchorNode.compareDocumentPosition(i.focusNode);o=!1,(!r&&i.anchorOffset>i.focusOffset||r===Node.DOCUMENT_POSITION_PRECEDING)&&(o=!0);const l=i.getRangeAt(0),s=l.cloneRange();s.selectNodeContents(e),s.setEnd(l.startContainer,l.startOffset),t=s.toString().length;const a=l.cloneRange();a.selectNodeContents(e),a.setEnd(l.endContainer,l.endOffset),n=a.toString().length}}return o?[n,t]:[t,n]},y=()=>{return L=D.querySelector(".input").querySelector(".input-carets"),Array.from(L.querySelectorAll(".caret"))},i=()=>{let e=window.getComputedStyle(document.documentElement),t=e.getPropertyValue("--font-size");return parseFloat(t.substring(0,t.length-2))};const u=e=>{if(e.hasOwnProperty("charWidth")&&e.charWidth)return e.charWidth;let t=document.createElement("span");t.innerText="0",t.style.opacity="0",e.appendChild(t);var n=t.getBoundingClientRect().width;return t.remove(),e.charWidth=n},f=(e=0)=>{0===e&&(e=i());let t=window.getComputedStyle(document.documentElement);return e*parseFloat(t.getPropertyValue("--line-height-ratio"))},s=(t,n,e=!1)=>{var o=Array.from(L.children);let r;for(let e=0;e<o.length;e++)if($caretAux=o[e],parseInt($caretAux.style.getPropertyValue("--pos-char"))===t&&parseInt($caretAux.style.getPropertyValue("--pos-line"))===n){r=$caretAux;break}return!r||e?(r=document.createElement("span"),r.classList.add("caret"),e=parseInt(r.style.getPropertyValue("--pos-char"))||0,e=Math.max(t,e),r.style.setProperty("--max-pos-char",e),r.style.setProperty("--pos-char",t),r.style.setProperty("--pos-line",n),L.appendChild(r)):(L.removeChild(r),r=void 0),r},e=t=>{var n=f(),o=k.getBoundingClientRect();M.innerHTML="";for(let e=0;e<t.length;e++){var r=t[e];$caretSelection=document.createElement("span"),$caretSelection.classList.add("caret-selection"),$caretSelection.style.setProperty("--pos-x",r.x-o.x),$caretSelection.style.setProperty("--pos-y",r.y-o.y),$caretSelection.style.setProperty("--size-width",r.width),$caretSelection.style.setProperty("--size-height",n),M.append($caretSelection)}},r=(e,t,n,o)=>{let r=document,i,l,s=null;var a;return void 0!==r.caretPositionFromPoint?(i=r.caretPositionFromPoint(e,t),l=r.caretPositionFromPoint(n,o),s=r.createRange(),s.setStart(i.offsetNode,i.offset),s.setEnd(l.offsetNode,l.offset)):void 0!==r.caretRangeFromPoint&&(i=r.caretRangeFromPoint(e,t),l=r.caretRangeFromPoint(n,o),s=r.createRange(),s.setStart(i.startContainer,i.startOffset),s.setEnd(l.startContainer,l.startOffset)),null!==s&&void 0!==window.getSelection?((a=window.getSelection()).removeAllRanges(),a.addRange(s)):void 0!==r.body.createTextRange&&(s=r.body.createTextRange(),s.moveToPoint(e,t),(t=s.duplicate()).moveToPoint(n,o),s.setEndPoint("EndToEnd",t),s.select()),h(T)},l=(n,o,r=void 0)=>{if(0===n&&0===o){let e=document.createRange(),t=window.getSelection();t.removeAllRanges(),e.setStart(r,n),e.setEnd(r,o),t.addRange(e)}else{n=Math.min(r.innerText.length,n),o=Math.min(r.innerText.length,o);var[i,n]=g(n,r),[l,o]=g(o,r);n=Math.min(r.innerText.length,n),o=Math.min(r.innerText.length,o);let e=document.createRange(),t=window.getSelection();t.removeAllRanges(),o<n?(e.setStart(l,o),e.setEnd(i,n),e.collapse(!1),t.addRange(e),t.extend(l,o)):(e.setStart(i,n),e.setEnd(l,o),t.addRange(e))}},a=(e,t)=>{l(e,t,$toNode=k)},w=(e,t,n,o)=>{var[n,o]=r(e,t,n,o);return a(n,o),[n,o]},m=()=>{var e=window.getSelection().getRangeAt(0).getClientRects();let t={x:0,y:0};return t=0===e.length?(l=>{let s={x:0,y:0},e=false;if(l.nodeName==="TEXTAREA"){prePosition=l.selectionStart;postPosition=l.selectionEnd;e=l.selectionDirection==="backward"}else{const t=typeof window.getSelection!=="undefined";if(t){const a=window.getSelection();if(a.rangeCount!==0){const d=a.getRangeAt(0);let[e,t]=h(l);let[n,o]=g(e,l);let[r,i]=g(t,l);d.setStart(n,o);d.setEnd(r,i);s=d.getClientRects()[0]}}}return{x:s.x,y:s.y}})(k):{x:e[0].x,y:e[0].y},t};const x=(e,t)=>{var n=i(),o=f(n),n=([r=0]=[n],0===r&&(r=i()),O.hasOwnProperty(r)||(O[r]=u(T)),O[r]),r=k.getBoundingClientRect();return caretPosX=n*e+r.x,caretPosY=o*t+r.y,[caretPosX,caretPosY]};D.querySelector(".input").addEventListener("blur",e=>{D.querySelector(".input").editing||(L.classList.add("nofocus"),M.classList.add("nofocus"))}),D.querySelector(".input").addEventListener("focus",e=>{L.classList.remove("nofocus"),M.classList.remove("nofocus")});const d=()=>{var e,t,n,o,r=k.getBoundingClientRect();let i=window.getSelection();i.selectAllChildren(T);let l=Array.from(i.getRangeAt(0).getClientRects());i.removeAllRanges(),l=l.sort((e,t)=>e.y-t.y),window.selRects=[],window.newLines={},0===l.length&&l.push({bottom:r.bottom,height:r.height,left:r.left,right:r.left,top:r.top,width:0,x:r.x,y:r.y});let s=l[0].y,a={bottom:0,height:0,left:1/0,right:0,top:1/0,width:0,x:1/0,y:0};for(e in l){e=parseInt(e);var d=l[e];d.y>s&&(s=d.y,a.width=a.right-a.left,a.height=a.bottom-a.top,window.selRects.push(a),a={bottom:0,height:0,left:1/0,right:0,top:1/0,width:0,x:1/0,y:0}),a={bottom:Math.max(d.bottom,a.bottom),left:Math.min(d.left,a.left),right:Math.max(d.right,a.right),top:Math.min(d.top,a.top),x:Math.min(d.x,a.x),y:Math.max(d.y,a.y)},e>=l.length-1&&(a.width=a.right-a.left,a.height=a.bottom-a.top,window.selRects.push(a))}for(t of window.selRects)t.y-=r.y,t.x-=r.x,t.top-=r.top,t.bottom=t.height+t.top,t.left-=r.left,t.right=t.width+t.left;if("\n\n"===k.textContent.slice(-2)&&(n=window.selRects[window.selRects.length-1],o=window.selRects[0],window.selRects.push({bottom:n.bottom+o.top+n.height,height:n.height,left:n.left,right:n.left,top:n.bottom+o.top,width:0,x:n.x,y:n.bottom+o.top})),void 0!==B){B.innerHTML="";for(var c of window.selRects){let e=document.createElement("span");e.style.width=`${c.width}px`,e.style.height=`${c.height}px`,e.style.left=`${c.left}px`,e.style.top=`${c.top}px`,e.style.position="absolute",e.style.background="#0000ff1f",e.classList.add("boxSel"),B.appendChild(e)}}},v=(e,t=!1)=>{window.hasOwnProperty("selRects")||(window.selRects=[]),0===window.selRects.length&&d();let n;for(var o in window.selRects){o=window.selRects[o];e>=o.y&&(n=o)}return n&&(n=Object.keys(n).reduce((e,t)=>(e[t]=n[t],e),{}),t&&(t=k.getBoundingClientRect(),n.y+=t.y,n.x+=t.x,n.top+=t.top,n.bottom+=t.top,n.left+=t.left,n.right+=t.left)),n},P=(e,t)=>{var n=u(T),o=f(),r=(0===window.selRects.length&&d(),window.selRects.length-1);let i=r<t?r:t;i=Math.max(i,0);o=v(i*o+o/2);if(!o)return[e,1/0,t];n=Math.round((o.x+o.width)/n);let l=Math.min(e,n);return e!==1/0&&n<e&&i!=r&&(i+=1,l=0),[l,n,i]},n=(e,t=void 0,n=!1,o=!1)=>{var r=k.getBoundingClientRect();e.x,e.y;e={x:e.x-r.x,y:e.y-r.y};var i,l=v(e.y);return void 0!==l&&(e={x:Math.min(e.x,l.x+l.width),y:l.y+l.height/2},i=void 0===t,r=u(T),l=f(),l=parseInt(e.y/l),r=Math.round(e.x/r),void 0===t&&(n||o||(L.innerHTML=""),t=s(r,l,o),o&&(t.classList.add("drag"),k.dragCaret=t)),void 0!==t&&(n=parseInt(t.style.getPropertyValue("--pos-char"))||0,n=Math.max(r,n),t.style.setProperty("--max-pos-char",n),t.style.setProperty("--pos-char",r),t.style.setProperty("--pos-line",l),i?(t.style.setProperty("--fpos-char",r),t.style.setProperty("--fpos-line",l)):o||R())),e},R=()=>{var t=Array.from(L.children),n=f();let o,r=[];for(let e=0;e<t.length;e++){o=t[e];var i=parseInt(o.style.getPropertyValue("--fpos-line")),l=parseInt(o.style.getPropertyValue("--pos-line")),[s,a]=x(parseInt(o.style.getPropertyValue("--fpos-char")),i),[d,c]=x(parseInt(o.style.getPropertyValue("--pos-char")),l);if(l!==i){let e=!1;l<i&&(e=!0);var g=v(i*n+n/2,absolutePos=!0),p=v(l*n+n/2,absolutePos=!0);if(g&&p&&(e?(r.push({top:a,bottom:a+n,height:n,width:s-g.left,left:g.left,right:s,x:g.left,y:a}),r.push({bottom:p.bottom,top:p.top,height:n,width:p.right-d,left:d,right:p.right,x:d,y:p.y})):(r.push({top:g.top,bottom:g.bottom,height:n,width:g.right-s,left:s,right:g.right,x:s,y:g.y}),r.push({top:p.top,bottom:p.bottom,height:n,width:d-p.left,left:p.left,right:d,x:p.x,y:p.y}))),0<Math.abs(l-i))for(let e=Math.min(i,l)+1;e<Math.max(i,l);e++){var h=v(e*n+n/2,absolutePos=!0);h&&r.push(h)}}else{let e=d<s?!0:!1;r.push({top:c,bottom:c+n,height:n,width:Math.abs(d-s),left:e?d:s,right:e?s:d,x:e?d:s,y:c})}}e(r)};T.addEventListener("mousedown",e=>{p(),k.selecting=!0,n({x:e.clientX,y:e.clientY},$caret=void 0,ctrlKey=e.ctrlKey)},!0),T.addEventListener("mousemove",e=>{var t;k.hasOwnProperty("selecting")||1!==e.which||(k.selecting=!1),k.selecting&&(t=Array.from(L.children),n({x:e.clientX,y:e.clientY},$caret=t[t.length-1],ctrlKey=e.ctrlKey))},!0),T.addEventListener("mouseup",e=>{k.selecting=!1},!0),T.addEventListener("dragstart",function(e){k.selecting=!1,k.dragging=!0,k.internalDrag=!0},!1),T.addEventListener("dragover",function(e){e.preventDefault(),k.hasOwnProperty("dragging")||(k.dragging=!1),k.dragging&&(k.dragCaretPos={x:e.clientX,y:e.clientY},k.dragCaretPos=n(k.dragCaretPos,$caret=k.dragCaret,firstCaret=!1,dragStyle=!0))},!1),T.addEventListener("dragenter",function(e){var t=T.getBoundingClientRect(),e=e.target.getBoundingClientRect();e.left>=t.left&&e.right<=t.right&&e.top>=t.top&&e.bottom<=t.bottom&&(k.dragging||(k.dragging=!0))},!1),D.addEventListener("dragleave",function(e){var t=T.getBoundingClientRect(),e=e.target.getBoundingClientRect();e.left>=t.left&&e.right<=t.right&&e.top>=t.top&&e.bottom<=t.bottom||k.dragging&&k.dragCaret&&(L.contains(k.dragCaret)&&L.removeChild(k.dragCaret),k.dragging=!1,k.dragCaret=void 0)},!1),T.addEventListener("drop",function(e){e.preventDefault(),customZActions=0,k.internalDrag&&(b(k.ownerDocument,["delete"],!1,null,keepZAction=!1,customZActions=0),customZActions++);var t=e.dataTransfer.getData("Text"),n=k.dragCaret.getBoundingClientRect();w(n.x,n.y,n.x,n.y),b(k.ownerDocument,["insertHTML"],!1,t,keepZAction=!0,customZActions+=1,nameZAction="DroppedElement");var[o,e]=h(k);n=o,t=e,l(n,t,$toNode=T);o=m();e=o,n=u(T),t=f(),o=k.getBoundingClientRect(),t=parseInt((e.y-o.y)/t),n=Math.round((e.x-o.x)/n),s(n,t),L.contains(k.dragCaret)&&L.removeChild(k.dragCaret),k.dragging=!1,k.dragCaret=void 0,k.internalDrag=!1},!1);const C=(t,n=!1,o=null)=>{if(0<S){for(let e=0;e<c[S].zActions;e++)t.execCommand("undo",n,o);--S}},A=(t,n=!1,o=null)=>{if(S<c.length-1){S+=1;for(let e=0;e<c[S].zActions;e++)t.execCommand("redo",n,o)}},b=(e,t,n=!1,o=null,r=!0,i=0,l="")=>{for(var s of t){if("undo"===s)return C(e,n,o);if("redo"===s)return A(e,n,o);e.execCommand(s,n,o)}0===i&&(i=t.length),""===l&&(l=t.join("_")),r&&(S+=1,c.push({date:Date.now(),zActions:i,name:l}))},E=(e,t,n,o=!1,r=null,i=!0,l=0,s="")=>{let a=t.ownerDocument;t.ownerDocument.defaultView;let d=a.getSelection(),c=d.getRangeAt(0);[t,e]=g(e,t),c.setStart(t,e),c.setEnd(t,e),d.removeAllRanges(),d.addRange(c),b(a,n,o,r,noZAction,i,l,s)};const t=(t,e)=>{window.scrollY=0,window.scrollX=0;var n=u(T),o=f();if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","End","Home","PageUp","PageDown"].includes(t.key))e!==k&&(p(),(l=>{l.preventDefault();var e,t=y();for(e in t){let r=t[e],i=parseInt(r.style.getPropertyValue("--max-pos-char"));var s=parseInt(r.style.getPropertyValue("--pos-char")),a=parseInt(r.style.getPropertyValue("--pos-line"));if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(l.key)){let e={ArrowLeft:(e,t)=>(--e<0&&(e=1/0,--t),[e,t]),ArrowRight:(e,t)=>[e+1,t],ArrowUp:(e,t)=>[e=Math.max(e,i),t-1],ArrowDown:(e,t)=>[e=Math.max(e,i),t+1]};var[d,c]=e[l.key](s,a);let[t,n,o]=P(d,c);n===1/0&&(t=s,o=a,limitCaretChar),["ArrowLeft","ArrowRight"].includes(l.key)&&r.style.setProperty("--max-pos-char",t),r.style.setProperty("--pos-char",t),r.style.setProperty("--pos-line",o),l.shiftKey||(r.style.setProperty("--fpos-char",t),r.style.setProperty("--fpos-line",o))}else["End","Home","PageUp","PageDown"].includes(l.key)}R()})(t));else if(t.ctrlKey)(t=>{if("Z"===t.key.toUpperCase()&&(t.preventDefault(),(t.shiftKey?A:C)(k.ownerDocument)),"A"===t.key.toUpperCase()){t.preventDefault();let e=window.getSelection();e.selectAllChildren(T)}})(t);else if(p(),e!==k){D.querySelector(".input").editing=!0;var r,i=y();for(r in i){let e=i[r];var l=parseInt(e.style.getPropertyValue("--pos-char")),s=parseInt(e.style.getPropertyValue("--pos-line")),a=parseFloat(e.style.getPropertyValue("--fpos-char")),d=parseFloat(e.style.getPropertyValue("--fpos-line")),c=k.getBoundingClientRect(),g={x:a*n+c.x-window.scrollX,y:d*o+c.y-window.scrollY},a={x:l*n+c.x-window.scrollX,y:s*o+c.y-window.scrollY};w(g.x,g.y,a.x,a.y),(e=>{window.selRects=[];e.target;if("Tab"===e.key){e.preventDefault();var[r,i]=h(k);if(e.shiftKey)if(r===i)"\t"===k.innerText[r-1]&&b(k.ownerDocument,["delete"],!1,null);else{let e=[];var l,s,a=k.innerText.slice(0,Math.min(r,i)).lastIndexOf("\n");0<a&&"\t"===k.innerText[a-1]&&e.push(a);let t=k.innerText.slice(Math.min(r,i),Math.max(r,i)),n=0;for(l of t.split("\n"))""!==l?("\t"===l[1]&&e.push(n),n+=l):n+=1;let o=0;for(s of e)o<e.length?E(s,k,["delete"],keepZAction=!1):E(s,k,["delete"],keepZAction=!0,customZActions=e.length,nameZAction="outdent multiple lines"),o+=1}else r===i&&b(k.ownerDocument,["insertHTML"],!1,"\t")}else"Enter"===e.key?b(k.ownerDocument,["insertHTML"],!1,"\n"):"Backspace"===e.key?b(k.ownerDocument,["delete"],!1):"Delete"===e.key?b(k.ownerDocument,["forwardDelete"],!1):1==e.key.length&&(b(k.ownerDocument,["insertHTML"],!1,e.key),e.preventDefault())})(t),a=m(),[l,s]=(d=a,g=a=g=c=void 0,c=u(T),g=f(),a=k.getBoundingClientRect(),g=parseInt((d.y-a.y)/g),[Math.round((d.x-a.x)/c),g]),e.style.setProperty("--pos-char",l),e.style.setProperty("--pos-line",s),e.style.setProperty("--fpos-char",l),e.style.setProperty("--fpos-line",s),R()}}e!==k&&(window.getSelection().removeAllRanges(),I.focus(),I.editing=!1)};k.addEventListener("change",e=>{window.selRects=[]}),I.addEventListener("keydown",e=>{t(e,e.target)}),document.addEventListener("keydown",e=>{e.ctrlKey&&("Z"!==e.key.toUpperCase()&&"Y"!==e.key.toUpperCase()||e.preventDefault())});const o=new ResizeObserver(e=>{window.selRects=[]});o.observe($)})(),{onInput:t.onInput}}